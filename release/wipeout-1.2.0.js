// WipeoutJs v1.2.0
// (c) Shane Connon 2015
// http://www.opensource.org/licenses/mit-license.php
(function(){var n={};var b=function(o){var p=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");p.onreadystatechange=function(){if(p.readyState==XMLHttpRequest.DONE){if((p.status==200||p.status==0)&&o.success){o.success(p)}else{if(o.error){o.error(p)}}}};p.open(o.type||"GET",o.url||document.location.href,o.async!==undefined?o.async:true);p.send();return p};var g=function(q,o,p){if(!q){return}p=p||window;for(var r=0,s=q.length;r<s;r++){o.call(p,q[r],r)}};var h=function(q,o,p){if(!q){return}p=p||window;if(q==null){return}for(var r in q){o.call(p,q[r],r)}};var c=function(q,p,o){var r=e("wipeout.bindings."+q,o);ko.bindingHandlers[q]={init:r.init,update:r.update};if(p){ko.virtualElements.allowedBindings[q]=true}};var e=function(p,o){p=p.split(".");var q=p.splice(0,p.length-1);var r={};r[p[p.length-1]]=o();i(q.join("."),r);return r[p[p.length-1]]};var i=function(q,p){q=q.split(".");if(q[0]!=="wipeout"){throw'Root must be "wipeout".'}q.splice(0,1);var o=n;g(q,function(r){o=o[r]||(o[r]={})});if(p&&p instanceof Function){p=p()}h(p,function(s,r){o[r]=s})};var a=/^\s+|\s+$/g;var l=function(o){return o?o.replace(a,""):o};var m=function(o){return o?l(o).toLowerCase():o};var k=function(o){if(o==null){return false}o=m(o);return !!(o&&o!=="false"&&o!=="0")};var d=function(p){if(!p){return p}var q=/\-/,o;while((o=p.search(q))!==-1){if(o===p.length-1){return p.substr(0,o)}else{p=p.substr(0,o)+p[o+1].toUpperCase()+p.substr(o+2)}}return p};e("wipeout.utils.obj",function(){var r=function(v,w){if(!w){w=window}var u=v.split(".");for(var x=0,y=u.length;x<y;x++){w=w[u[x]];if(w==null){return null}}return w};var p=function(v,w){var u=r(v,w);if(u instanceof Function){var x=new u();if(x instanceof n.viewModels.view&&f){x.__woBag.constructedViewType=v}return x}throw v+" is not a valid function."};var o=function(w){var x=[];for(var u=0,v=w.length;u<v;u++){x.push(w[u])}return x};var q=function(v,u){return v.indexOf(u,v.length-u.length)!==-1};var t=function(u){return Math.floor(Math.random()*u)};var s=function s(){};s.camelCase=d;s.ajax=b;s.parseBool=k;s.trimToLower=m;s.trim=l;s.enumerateArr=g;s.enumerateObj=h;s.getObject=r;s.createObject=p;s.copyArray=o;s.random=t;s.endsWith=q;return s});e("wipeout.base.object",function(){var p=function p(){};var o={parents:[],children:[]};p.clearVirtualCache=function(r){if(!r){o.parents.length=0;o.children.length=0;return}for(var s=0,t=o.children.length;s<t;s++){if(o.children[s]===r||o.parents[s]===r){o.children.splice(s,1);o.parents.splice(s,1)}}};p.useVirtualCache=true;p.prototype._super=function(){var t=arguments.callee.caller;var r=null;if(p.useVirtualCache){var z=o.children.indexOf(t);if(z!==-1){r=o.parents[z]}}if(!r){var w=[];var s=this.constructor.prototype;while(s){w.push(s);s=Object.getPrototypeOf(s)}w.reverse();for(var u=0,v=w.length;u<v;u++){if(w[u]===t.prototype){r=w[u-1].constructor}else{for(var y in w[u]){if(w[u][y]===t){for(var x=u-1;x>=0;x--){if(w[x][y]!==t){r=w[x][y];break}}}if(r){break}}}if(r){if(p.useVirtualCache){o.children.push(t);o.parents.push(r)}break}}if(!r){throw"Could not find method in parent class"}}return r.apply(this,arguments)};var q=/^[a-zA-Z_][a-zA-Z_0-9]*$/;p.extend=function(s){if(s.constructor===Function){var r=s;s={constructor:r,statics:{}};for(var u in s.constructor){s.statics[t]=s.constructor[t]}for(var u in s.constructor.prototype){s[t]=s.constructor.prototype[t]}}else{if(s.constructor===Object){s.constructor=function(){this._super.apply(this,arguments)}}else{if(!s.constructor||s.constructor.constructor!==Function){throw'the property "constructor" must be a function'}}}for(var w in this){if(this.hasOwnProperty(w)&&this[w]&&this[w].constructor===Function&&this[w]!==p.clearVirtualCache&&s.constructor[w]===undefined){s.constructor[w]=this[w]}}var x=function(){this.constructor=s.constructor};x.prototype=this.prototype;s.constructor.prototype=new x();for(var t in s){if(t==="constructor"){continue}if(t==="statics"){for(var v in s[t]){s.constructor[v]=s[t][v]}continue}s.constructor.prototype[t]=s[t]}return s.constructor};return p});e("wipeout.template.templatePart",function(){function o(q,p){this.value=q;this.escaped=p;this.nextChars=[]}o.prototype.indexOf=function(r,q){if(this.value instanceof RegExp){if(q){r=r.substr(q)}var p=r.search(this.value);if(p===-1){return null}return{index:q+p,length:r.match(this.value)[0].length}}else{var s=r.indexOf(this.value,q);return s==-1?null:{index:s,length:this.value.length}}};return o});e("wipeout.utils.domManipulationWorkerBase",function(){var o=n.base.object.extend(function o(){this._super();this._mutations=[]});o.prototype.finish=function(){for(var p=0;p<this._mutations.length;p++){if(!document.body.contains(this._mutations[p])){n.utils.html.cleanNode(this._mutations.splice(p,1)[0]);p--}}g(this._mutations,function(q){g(n.bindings.bindingBase.getBindings(q,n.bindings.render),function(r){r.hasMoved()})});this._mutations.length=0};return o});e("wipeout.base.disposable",function(){var o=n.base.object.extend(function o(p){this._super();this.disposeFunction=p||function(){}});o.prototype.dispose=function(){if(this.disposeFunction){this.disposeFunction()}delete this.disposeFunction};return o});e("wipeout.viewModels.visual",function(){var p=n.base.object.extend(function p(q){this._super();this.shareParentScope=false;this.templateItems={};this.templateId=ko.observable(q||p.getDefaultTemplateId());this.__woBag={disposed:n.events.event(),disposables:{},createdByWipeout:false,rootHtmlElement:null,routedEventSubscriptions:[],nodes:[]}});p.getDefaultTemplateId=(function(){var q=null;return function(){if(!q){q=n.viewModels.contentControl.createAnonymousTemplate("<span>No template has been specified</span>")}return q}})();p.getBlankTemplateId=(function(){var q=null;return function(){if(!q){q=n.viewModels.contentControl.createAnonymousTemplate("")}return q}})();p.visualGraph=function(s,q){if(!s){return[]}q=q||function(){return typeof arguments[0]};var r=[];n.utils.obj.enumerateArr(n.utils.html.getAllChildren(s),function(u){n.utils.obj.enumerateArr(p.visualGraph(u),r.push,r)});var t=n.utils.domData.get(s,n.bindings.wipeout.utils.wipeoutKey);if(t){return[{viewModel:t,display:q(t),children:r}]}return r};p.prototype.entireViewModelHtml=function(){if(this.__woBag.rootHtmlElement){if(this.__woBag.rootHtmlElement.nodeType===1){return[this.__woBag.rootHtmlElement]}else{if(n.utils.ko.isVirtual(this.__woBag.rootHtmlElement)){var r=[this.__woBag.rootHtmlElement];n.utils.ko.enumerateOverChildren(this.__woBag.rootHtmlElement,function(s){r.push(s);if(n.utils.ko.isVirtual(s)){r.push(n.utils.ko.getClosingTag(s))}});var q=r[r.length-1].nextSibling;if(!n.utils.ko.isVirtualClosing(q)){throw"Could not compile view model html"}r.push(q);return r}}}return[]};p.prototype.disposeOf=function(q){if(this.__woBag.disposables[q]){this.__woBag.disposables[q]();delete this.__woBag.disposables[q]}};p.prototype.disposeOfAll=function(){for(var q in this.__woBag.disposables){this.disposeOf(q)}};p.prototype.registerDisposeCallback=(function(){var q=0;return function(r){if(!r||r.constructor!==Function){throw"The dispose function must be a Function"}var s=(++q).toString();this.__woBag.disposables[s]=r;return s}})();p.prototype.registerDisposable=function(q){if(!q){throw"Invalid disposeable object"}if(q.constructor===Function&&!q.dispose){q=q.call(this)}if(!q||!(q.dispose instanceof Function)){throw"The disposable object must have a dispose(...) function"}return this.registerDisposeCallback(function(){q.dispose()})};p.prototype.getRootHtmlElement=function(){return this.__woBag.rootHtmlElement};p.prototype.dispose=function(){for(var q in this){if(ko.isObservable(this[q])&&this[q].dispose instanceof Function){this[q].dispose()}}g(this.__woBag.routedEventSubscriptions.splice(0,this.__woBag.routedEventSubscriptions.length),function(r){r.dispose()});this.__woBag.disposed.trigger()};p.prototype.getParents=function(r){var q=this.getParent(r);var s=[];while(q){s.push(q);q=q.getParent(r)}return s};p.prototype.getParent=function(q){var s;var r=!this.__woBag.rootHtmlElement||!(s=n.utils.ko.parentElement(this.__woBag.rootHtmlElement))?null:n.utils.html.getViewModel(s);return q||!r||!r.shareParentScope?r:r.getParent(q)};p.prototype.unRegisterRoutedEvent=function(u,q,r){for(var s=0,t=this.__woBag.routedEventSubscriptions.length;s<t;s++){if(this.__woBag.routedEventSubscriptions[s].routedEvent===u){this.__woBag.routedEventSubscriptions[s].event.unRegister(q,r);return true}}return false};p.prototype.registerRoutedEvent=function(w,q,r,u){var v;for(var s=0,t=this.__woBag.routedEventSubscriptions.length;s<t;s++){if(this.__woBag.routedEventSubscriptions[s].routedEvent===w){v=this.__woBag.routedEventSubscriptions[s];break}}if(!v){v=new n.events.routedEventRegistration(w);this.__woBag.routedEventSubscriptions.push(v)}return v.event.register(q,r,u)};p.prototype.triggerRoutedEvent=function(u,q){if(!(q instanceof n.events.routedEventArgs)){q=new n.events.routedEventArgs(q,this)}for(var r=0,s=this.__woBag.routedEventSubscriptions.length;r<s;r++){if(q.handled){return}if(this.__woBag.routedEventSubscriptions[r].routedEvent===u){this.__woBag.routedEventSubscriptions[r].event.trigger(q)}}if(q.handled){return}if(this.model() instanceof n.events.routedEventModel){this.model().routedEventTriggered(u,q)}if(q.handled){return}var t=this.getParent();if(t){t.triggerRoutedEvent(u,q)}};p.prototype.onRendered=function(r,q){};p.prototype.onUnrendered=function(){};p.prototype.onApplicationInitialized=function(){};var o=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","head","header","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"];p.reservedTags={};g(o,function(q){p.reservedTags[q]=true});return p});e("wipeout.viewModels.view",function(){var o="wipeout.viewModels.view.modelRoutedEvents";var p=n.viewModels.visual.extend(function p(s,r){this._super(s);if(r===undefined){r=null}this.model=ko.observable(r);var q=this.model.subscribe(function(t){try{this._onModelChanged(r,t)}finally{r=t}},this);this.registerDisposable(q);this.__woBag.bindings={}});p.setObservable=function(q,r,s){if(ko.isObservable(q[r])){q[r](ko.utils.unwrapObservable(s))}else{q[r]=ko.utils.unwrapObservable(s)}};p.prototype.dispose=function(){this._super();if(this.__woBag[o]){this.disposeOf(this.__woBag[o]);delete this.__woBag[o]}for(var q in this.__woBag.bindings){for(var r=0,s=this.__woBag.bindings[q].length;r<s;r++){this.__woBag.bindings[q][r].dispose()}delete this.__woBag.bindings[q]}};p.prototype.onInitialized=function(){};p.prototype.bind=function(s,z,w){if(w&&(!ko.isObservable(this[s])||!ko.isObservable(z()))){throw"Two way bindings must be between 2 observables"}var v=ko.dependentObservable({read:function(){return ko.utils.unwrapObservable(z())},write:w?function(){var A=z();if(A){A(arguments[0])}}:undefined});var x=false;var y=false;p.setObservable(this,s,v.peek());var t=v.subscribe(function(A){if(!x){try{y=true;p.setObservable(this,s,A)}finally{y=false}}},this);var u=w?this[s].subscribe(function(A){if(!y){try{x=true;p.setObservable({x:v},"x",A)}finally{x=false}}},this):null;var q=this;var r=new n.base.disposable(function(){if(t){t.dispose();t=null}if(u){u.dispose();u=null}if(v){v.dispose();v=null}if(r){var A;if(q.__woBag.bindings[s]&&(A=q.__woBag.bindings[s].indexOf(r))!==-1){q.__woBag.bindings[s].splice(A,1);if(!q.__woBag.bindings[s].length){delete q.__woBag.bindings[s]}}r=null}});if(!this.__woBag.bindings[s]){this.__woBag.bindings[s]=[r]}else{this.__woBag.bindings[s].push(r)}return r};p._elementHasModelBinding=function(q){if(q.attributes.model||q.attributes["model-tw"]){return true}for(var r=0,s=q.length;r<s;r++){if(q[r].constructor===n.template.templateElement&&q[r].name==="model"){return true}}return false};p.reservedPropertyNames=["constructor","id"];p.prototype._initialize=function(t,r){if(this.__woBag.initialized){throw"Cannot call initialize item twice"}this.__woBag.initialized=true;if(!t){return}if(t.attributes.id){this.id=t.attributes.id.value}var s=t.attributes.shareParentScope||t.attributes["share-parent-scope"];if(s){this.shareParentScope=k(s.value)}if(!p._elementHasModelBinding(t)&&n.utils.ko.peek(this.model)==null){this.bind("model",r.$data.model)}var q=this.shareParentScope?r:r.createChildContext(this);h(t.attributes,function(u,v){var w="";if(v.length>3&&v.substr(v.length-3)==="-tw"){v=v.substr(0,v.length-3);w=",\n\t\t\tfunction(val) {\n\t\t\t\tif(!ko.isObservable("+u.value+"))\n\t\t\t\t\tthrow 'Two way bindings must be between 2 observables';\n\t\t\t\t"+u.value+"(val);\n\t\t\t}"}v=d(v);if(p.reservedPropertyNames.indexOf(v)!==-1){return}try{q.__$woCurrent=this;n.template.engine.createJavaScriptEvaluatorFunction("(function() {\n\t\t\t__$woCurrent.bind('"+v+"', function() {\n\t\t\t\treturn "+u.value+";\n\t\t\t}"+w+");\n\n\t\t\treturn '';\n\t\t})()")(q)}finally{delete q.__$woCurrent}},this);g(t,function(u,v){var z=d(u.name);if(u.constructor!==n.template.templateElement||p.reservedPropertyNames.indexOf(z)!==-1){return}var A="string";for(var x in u.attributes){if(x==="constructor"&&u.attributes[x].value){A=d(u.attributes[x].value);break}}if(p.objectParser[m(A)]){var w=[];for(var x=0,y=u.length;x<y;x++){w.push(u[x].serialize())}var B=p.objectParser[m(A)](w.join(""));p.setObservable(this,z,B)}else{var B=n.utils.obj.createObject(A);if(B instanceof n.viewModels.view){B.__woBag.createdByWipeout=true;B._initialize(u,q)}p.setObservable(this,z,B)}},this)};p.objectParser={json:function(q){return JSON.parse(q)},string:function(q){return q},bool:function(r){var q=m(r);return q?q!=="false"&&q!=="0":false},"int":function(q){return parseInt(l(q))},"float":function(q){return parseFloat(l(q))},regexp:function(q){return new RegExp(l(q))},date:function(q){return new Date(l(q))}};p.prototype._onModelChanged=function(s,r){if(s!==r){this.disposeOf(this.__woBag[o]);delete this.__woBag[o];if(r instanceof n.events.routedEventModel){var q=r.__triggerRoutedEventOnVM.register(this._onModelRoutedEvent,this);this.__woBag[o]=this.registerDisposable(q)}}this.onModelChanged(s,r)};p.prototype.onModelChanged=function(r,q){};p.prototype._onModelRoutedEvent=function(q){if(!(q.routedEvent instanceof n.events.routedEvent)){throw"Invaid routed event"}this.triggerRoutedEvent(q.routedEvent,q.eventArgs)};return p});e("wipeout.events.routedEvent",function(){var o=function o(){if(!(this instanceof o)){return new o()}};o.prototype.trigger=function(q,p){q.triggerRoutedEvent(this,new n.events.routedEventArgs(p,q))};o.prototype.unRegister=function(p,r,q){return r.unRegisterRoutedEvent(this,p,q)};o.prototype.register=function(p,r,q){return r.registerRoutedEvent(this,p,q)};return o});e("wipeout.events.routedEventArgs",function(){var o=function o(p,q){this.handled=false;this.data=p;this.originator=q};return o});e("wipeout.events.routedEventRegistration",function(){var o=function o(p){this.routedEvent=p;this.event=new n.events.event()};o.prototype.dispose=function(){this.event.dispose()};return o});e("wipeout.debug",function(){var o=function(){if(!window.jQuery){throw"This debug tool requires jQuery"}};return{renderedItems:function(r,q){var s=[],t;var p=function(u){if(u){switch(u.nodeType){case 1:g(u.childNodes,p);case 8:if((t=n.utils.html.getViewModel(u))&&s.indexOf(t)===-1&&(!q||t.constructor===q)){s.push(t)}}}};p(r||document.getElementsByTagName("body")[0]);return s}}});e("wipeout.settings",function(){function o(p){h(n.settings,function(q,r){delete n.settings[r]});h(p,function(r,q){n.settings[q]=r})}o.suppressWarnings=false;o.asynchronousTemplates=true;o.htmlAsyncTimeout=10000;return o});e("wipeout.bindings.bindingBase",function(){var o=n.base.disposable.extend(function o(q){this._super();if(!q){throw"ArgumnetNullException"}this.bindingId=n.bindings.bindingBase.uniqueId();this.bindingMeta={};this.element=q;if(!this.getParentElement()){throw'Cannot apply a "wipeout.bindings.bindingBase" binding on an element without a parent node.'}var p=n.utils.domData.get(this.element,n.bindings.bindingBase.dataKey);if(!p){p=n.utils.domData.set(this.element,n.bindings.bindingBase.dataKey,[])}g(p,function(r){if(r.bindingMeta.controlsDescendantBindings){throw"There is already a binding on this element which controls children."}});p.push(this);n.bindings.bindingBase.registered[this.bindingId]=this;this.parentElement=this.getParentElement();this.moved(null,this.parentElement)});o.getParentElement=function(p){return p.parentElement||p.parentNode};o.prototype.getParentElement=function(){return o.getParentElement(this.element)};o.prototype.dispose=function(){this._super();this.moved(this.parentElement,null);var q;var p=n.utils.domData.get(this.element,n.bindings.bindingBase.dataKey);while((q=p.indexOf(this))!==-1){p.splice(q,1)}delete this.element;delete this.parentElement;delete n.bindings.bindingBase.registered[this.bindingId]};o.prototype.checkHasMoved=function(){return this.getParentElement()!==this.parentElement};o.prototype.hasMoved=function(){if(this.checkHasMoved()){this.moved(this.parentElement,this.getParentElement());this.parentElement=this.getParentElement()}};o.prototype.moved=function(q,p){};o.registered={};o.uniqueId=(function(){var p=Math.floor(Math.random()*1000000000);return function(){return"binding-"+(++p)}})();o.getBindings=function(r,q){if(q&&!(q instanceof Function)){throw"Invalid binding type"}var s=false;var p=[];g(n.utils.domData.get(r,n.bindings.bindingBase.dataKey),function(t){if(!q||t instanceof q){p.push(t);s|=t.bindingMeta.controlsDescendantBindings}});if(!s){n.utils.ko.enumerateOverChildren(r,function(t){g(n.bindings.bindingBase.getBindings(t,q),function(u){p.push(u)})})}return p};o.dataKey="wipeout.bindings.bindingBase";return o});c("itemsControl",true,function(){var p="";var q=null;var r=function(){if(q){return}var v="<!-- ko ic-render: null";if(f){v+=", wipeout-type: 'items[' + wipeout.utils.ko.peek($index) + ']'"}v+=" --><!-- /ko -->";if(q){return}q=n.viewModels.contentControl.createAnonymousTemplate(v)};var s=function(w){var v=n.utils.ko.peek(w);if(v&&!(v instanceof n.viewModels.itemsControl)){throw"This binding can only be used on an itemsControl"}};var o=function(x,y,v,z,w){s(z);r();return ko.bindingHandlers.template.init.call(this,x,u.createAccessor(z),v,z,w)};var t=function(x,y,v,z,w){s(z);return ko.bindingHandlers.template.update.call(this,x,u.createAccessor(z),v,z,w)};var u={createAccessor:function(v){v=n.utils.ko.peek(v);return function(){return{name:q,foreach:v.items,templateEngine:n.template.engine.instance}}}};return{init:o,update:t,utils:u}});c("ic-render",true,function(){return{init:function(r,s,o,t,q){var p=new n.bindings.render(r,q.$data,o,q.$parentContext.extend({$index:q.$index}));p.render(n.utils.ko.peek(q.$data))}}});c("render",true,function(){var o=n.bindings.bindingBase.extend(function o(r,t,p,q){this._super(r);this.bindingMeta=ko.bindingHandlers.template.init(this.element,n.bindings.render.createValueAccessor(t),p,null,q);this.allBindingsAccessor=p;this.bindingContext=q;if(ko.isObservable(t)){var s=t.peek();this.subscribed=t.subscribe(function(u){if(u===s){return}try{this.reRender(u)}finally{s=u}},this)}});o.prototype.moved=function(s,r){this._super(s,r);if(f&&!n.settings.suppressWarnings&&this.value){for(var p=0,q=this.value.__woBag.nodes.length;p<q;p++){if(n.utils.ko.parentElement(this.value.__woBag.nodes[p])!==this.value.__woBag.rootHtmlElement){console.warn("Only part of this view model was moved. Un moved nodes will be deleted or orphaned with their bindings cleared when this view model is re-rendered or disposed.");break}}}};o.prototype.dispose=function(){this.unRender();this._super();if(this.subscribed){this.subscribed.dispose();delete this.subscribed}};o.prototype.reRender=function(p){this.unRender();this.render(p)};o.prototype.unTemplate=function(){if(!this.value){return}h(this.value.templateItems,function(s,r){delete this.value.templateItems[r]},this);var q,p=ko.virtualElements.firstChild(this.element);while(p){q=p;p=ko.virtualElements.nextSibling(p);n.utils.html.cleanNode(q);n.bindings.bindingBase.getParentElement(q).removeChild(q)}this.value.__woBag.nodes.length=0};o.prototype.unRender=function(){if(!this.value){return}this.unTemplate();this.value.onUnrendered();if(this.value.__woBag.rootHtmlElement){n.utils.domData.set(this.value.__woBag.rootHtmlElement,n.bindings.wipeout.utils.wipeoutKey,undefined);delete this.value.__woBag.rootHtmlElement}if(this.templateChangedSubscription){this.value.disposeOf(this.templateChangedSubscription)}this.value.disposeOf(this.onDisposeEventSubscription);delete this.onDisposeEventSubscription;delete this.value;delete this.templateChangedSubscription};o.prototype.render=function(p){if(this.value||this.templateChangedSubscription){throw"This binding is already rendering a visual. Call unRender before rendering again."}if(!(this.value=p)){return}if(!(this.value instanceof n.viewModels.visual)){throw"This binding can only be used to render a wo.visual within the context of a wo.visual"}if(this.value.__woBag.rootHtmlElement){throw"This visual has already been rendered. Call its unRender() function before rendering again."}n.utils.domData.set(this.element,n.bindings.wipeout.utils.wipeoutKey,this.value);this.value.__woBag.rootHtmlElement=this.element;var q=this.value.__woBag.disposed.register(this.unRender,this);this.onDisposeEventSubscription=this.value.registerDisposable(q);var r=this.value.templateId.subscribe(this.onTemplateChanged,this);this.templateChangedSubscription=this.value.registerDisposable(r);this.onTemplateChanged(this.value.templateId.peek())};o.prototype.onTemplateChanged=function(q){var p=this;function r(){if(p.value&&p.value.templateId.peek()!==q){return}p.doRendering()}this.unTemplate();if(q&&n.settings.asynchronousTemplates){ko.virtualElements.prepend(this.element,n.utils.html.createTemplatePlaceholder(this.value));n.template.asyncLoader.instance.load(q,r)}else{r()}};o.prototype.doRendering=function(){ko.bindingHandlers.template.update(this.element,n.bindings.render.createValueAccessor(this.value),this.allBindingsAccessor,null,this.bindingContext);var p=this.allBindingsAccessor();if(p["wipeout-type"]){n.bindings["wipeout-type"].utils.comment(this.element,p["wipeout-type"])}};o.init=function(s,t,p,u,r){var q=new n.bindings.render(s,t(),p,r);q.render(n.utils.ko.peek(t()));return q.bindingMeta};o.createValueAccessor=function(p){return function(){p=n.utils.ko.peek(p);if(!(p instanceof n.viewModels.visual)){return{name:n.viewModels.visual.getBlankTemplateId()}}var q={templateEngine:n.template.engine.instance,name:p.templateId.peek(),afterRender:function(s,r){var t=[];g(p.__woBag.nodes,function(u){t.push(u)});p.__woBag.nodes.length=0;g(s||[],function(u){p.__woBag.nodes.push(u)});p.onRendered(t,s)}};if(!p.shareParentScope){q.data=p}return q}};return o});c("wipeout-type",true,function(){var o="wipeout-type";return{init:function(){},utils:{comment:function(p,r){r=n.utils.ko.peek(r);if(p.nodeType===1){if(p.childNodes.length){p.insertBefore(document.createComment(r),p.childNodes[0])}else{p.appendChild(document.createComment(r))}}else{if(p.nodeType===8){var q;if(!(q=ko.utils.domData.get(p,o))){ko.utils.domData.set(p,o,q=p.textContent)}p.textContent=q+" wipeout-type: "+r}}}}}});c("wipeout",true,function(){var o=n.bindings.render.extend(function p(s,t,q,u,r){if(!(t instanceof Function)){throw"Invalid view type"}this.renderedView=new t();if(!(this.renderedView instanceof n.viewModels.view)){throw"Invalid view type"}this._super(s,this.renderedView,q,r);if(this.renderedView.shareParentScope){throw"The root of an application cannot share its parents scope"}this.renderedView.model(u);this.render(this.renderedView);this.render=function(){throw"Cannont render this binding a second time, use the render binding instead"};this.renderedView.onApplicationInitialized()});o.prototype.dispose=function(){this._super();this.renderedView.dispose()};o.init=function(s,t,q,u,r){return new n.bindings.wipeout(s,t(),q,u,r).bindingMeta};o.utils={wipeoutKey:"__wipeout"};return o});c("wo",true,function(){var o=n.bindings.render.extend(function o(s,t,p,q){var u=o.create(t);this._super(s,u,p,q);u.__woBag.createdByWipeout=true;u._initialize(n.template.engine.xmlCache[t.initXml],q);if(t.id){var r=q;while(r.$data.shareParentScope){r=r.$parentContext}r.$data.templateItems[t.id]=u}this.render(u);this.render=function(){throw"Cannot render this binding a second time, use the render binding instead"}});o.prototype.dispose=function(){this.removeFromParentTemplateItems();var p=this.value;this._super();p.dispose()};o.prototype.removeFromParentTemplateItems=function(){if(this.parentElement&&this.value.id){n.bindings.wo.removeFromParentTemplateItems(this.parentElement,this.value.id)}};o.init=function(r,s,p,t,q){return new n.bindings.wo(r,s(),p,q).bindingMeta};o.removeFromParentTemplateItems=function(r,p){var q=n.utils.html.getViewModel(r);while(q&&q.shareParentScope){q=q.getParent()}if(q){return delete q.templateItems[p]}return false};o.create=function(p){if(!p.type){throw'Cannot create an instance of "'+p.name+'"'}return new p.type()};return o});var n=n||{};n.base=n.base||{};e("wipeout.events.eventRegistration",function(){return n.base.disposable.extend(function o(p,q,r){this._super(r);this.callback=p;this.context=q})});e("wipeout.events.event",function(){var o=function o(){if(!(this instanceof o)){return new o()}this._registrations=[]};o.prototype.trigger=function(p){for(var q=0,r=this._registrations.length;q<r;q++){if(p instanceof n.events.routedEventArgs&&p.handled){return}this._registrations[q].callback.call(this._registrations[q].context,p)}};o.prototype.unRegister=function(p,q){q=q==null?window:q;for(var r=0;r<this._registrations.length;r++){if(this._registrations[r].callback===p&&this._registrations[r].context===q){this._registrations.splice(r,1);r--}}};o.prototype.dispose=function(){this._registrations.length=0};o.prototype.register=function(p,q,u){if(!(p instanceof Function)){throw"Invalid event callback"}if(u&&!(u instanceof Number)){throw"Invalid event priority"}var v=this._registrations;var r={priority:u||0,callback:p,context:q==null?window:q,dispose:function(){var w=v.indexOf(r);if(w>=0){v.splice(w,1)}}};for(var s=0,t=this._registrations.length;s<t;s++){if(r.priority<this._registrations[s].priority){this._registrations.splice(s,0,r);break}}if(s===t){this._registrations.push(r)}return new n.events.eventRegistration(r.callback,r.context,r.dispose,r.priority)};return o});e("wipeout.events.routedEventModel",function(){var o=n.base.object.extend(function o(){this.__triggerRoutedEventOnVM=new n.events.event();this.__routedEventSubscriptions=[]});o.prototype.triggerRoutedEvent=function(q,p){this.__triggerRoutedEventOnVM.trigger({routedEvent:q,eventArgs:p})};o.prototype.routedEventTriggered=function(s,p){for(var q=0,r=this.__routedEventSubscriptions.length;q<r;q++){if(p.handled){return}if(this.__routedEventSubscriptions[q].routedEvent===s){this.__routedEventSubscriptions[q].event.trigger(p)}}};o.prototype.registerRoutedEvent=function(v,p,q,t){var u;for(var r=0,s=this.__routedEventSubscriptions.length;r<s;r++){if(this.__routedEventSubscriptions[r].routedEvent===v){u=this.__routedEventSubscriptions[r];break}}if(!u){u=new n.events.routedEventRegistration(v);this.__routedEventSubscriptions.push(u)}return u.event.register(p,q,t)};o.prototype.unRegisterRoutedEvent=function(t,p,q){for(var r=0,s=this.__routedEventSubscriptions.length;r<s;r++){if(this.__routedEventSubscriptions[r].routedEvent===t){this.__routedEventSubscriptions[r].event.unRegister(p,q);return true}}return false};return o});e("wipeout.polyfills.Array",function(){var o=function(){};o.prototype.indexOf=function(s,p){for(var q=p||0,r=this.length;q<r;q++){if(this[q]===s){return q}}return -1};h(o.prototype,function(q,p){if(!Array.prototype[p]){Array.prototype[p]=q}});return o});e("wipeout.profile.highlightVM",function(){var o=n.base.object.extend(function o(q,p){this.vm=q;this.cssClass=p;this.nodes=q.entireViewModelHtml();n.utils.obj.enumerateArr(this.nodes,function(r){if(r.classList){r.classList.add(this.cssClass)}},this)});o.prototype.dispose=function(){n.utils.obj.enumerateArr(this.nodes,function(p){if(p.classList){p.classList.remove(this.cssClass)}},this)};return o});e("wipeout.profile.highlighter",function(){o.newId=(function(){var p=0;return function(){return ++p}})();o.generateColour=function(){var r=Math.floor((n.utils.obj.random(255)+255)/2);var q=Math.floor((n.utils.obj.random(255)+255)/2);var p=Math.floor((n.utils.obj.random(255)+255)/2);return r.toString(16)+q.toString(16)+p.toString(16)};function o(){this.style=document.createElement("style");this.index=0;this.styles=["wipeout-profiler-"+o.newId(),"wipeout-profiler-"+o.newId(),"wipeout-profiler-"+o.newId(),"wipeout-profiler-"+o.newId(),"wipeout-profiler-"+o.newId()];for(var q=0,r=this.styles.length;q<r;q++){this.style.innerHTML+=" ."+this.styles[q]+" {background-color:#"+o.generateColour()+" !important; cursor: pointer !important}"}document.head.appendChild(this.style);this.currentHighlighter={dispose:function(){}};var p=this;this.eventHandler=function(s){p.highlightVM(s)};window.addEventListener("mousemove",this.eventHandler,false)}o.prototype.nextStyle=function(){if(this.index>=this.styles.length-1){this.index=0}else{this.index++}return this.styles[this.index]};o.prototype.highlightVM=function(q){var r=document.elementFromPoint(q.clientX,q.clientY);if(r===this.currentElement){return}this.currentElement=r;var t=n.utils.html.getViewModel(this.currentElement);if(!t||t===this.currentHighlighter.vm){return}var s=this.__timeoutToken={};var p=this;setTimeout(function(){if(p.__timeoutToken!==s){return}p.currentHighlighter.dispose();p.currentHighlighter=new n.profile.highlightVM(t,p.nextStyle())},100)};o.prototype.dispose=function(){if(this.style.parentElement){this.style.parentElement.removeChild(this.style)}delete this.__timeoutToken;window.removeEventListener("mousemove",this.eventHandler);this.currentHighlighter.dispose()};return o});e("wipeout.profile.profile",function(){var q,o,u,t;var s=function s(w){if(arguments.length===0){w=true}if((w&&t)||(!w&&!t)){return}q=q||n.bindings.render.prototype.doRendering;o=o||n.viewModels.view.prototype._initialize;u=u||n.template.engine.prototype.rewriteTemplate;if(w){t={highlighter:new n.profile.highlighter(),infoBox:n.utils.html.createElement('<div style="position: fixed; top: 10px; right: 10px; background-color: white; padding: 10px; border: 2px solid gray; display: none; max-height: 500px; overflow-y: scroll; z-index: 10000"></div>'),eventHandler:function(x){if(!x.ctrlKey){return}x.stopPropagation();x.preventDefault();var B=wo.html.getViewModel(x.target);if(!B){return}var C=B.getParents();C.splice(0,0,B);t.infoBox.innerHTML='<span style="float: right; margin-left: 10px; cursor: pointer;">x</span><br/>Open a console window and click on a class to debug it<br/>If view models do not have names, you can <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name">name them</a><br/>If view models have odd names ensure you are not using a minifier';t.infoBox.firstChild.addEventListener("click",function(){t.infoBox.style.display="none"});var y=[];for(var z=0,A=C.length;z<A;z++){t.infoBox.appendChild(p(C[z]).element)}t.infoBox.style.display="block"},dispose:function(){t.highlighter.dispose();if(t.infoBox.parentElement){t.infoBox.parentElement.removeChild(t.infoBox)}document.body.removeEventListener("click",t.eventHandler);n.bindings.render.prototype.doRendering=q;n.viewModels.view.prototype._initialize=o;n.template.engine.prototype.rewriteTemplate=u}};n.bindings.render.prototype.doRendering=function(){var x=new Date();q.apply(this,arguments);var z=new Date()-x;if(!this.value.__woBag.profiler){this.value.__woBag.profiler={}}this.value.__woBag.profiler["Render time"]=z;var y=document.getElementById(this.value.templateId());if(y){this.value.__woBag.profiler["Template compile time"]=n.utils.domData.get(y,"rewriteTemplateTime")}};n.viewModels.view.prototype._initialize=function(){var x=new Date();o.apply(this,arguments);var y=new Date()-x;if(!this.__woBag.profiler){this.__woBag.profiler={}}this.__woBag.profiler["Initialize time"]=y};n.template.engine.prototype.rewriteTemplate=function(A){var x=new Date();u.apply(this,arguments);var B=new Date()-x;var z=document.getElementById(A);if(z instanceof HTMLElement){var y=n.utils.domData.get(z,"rewriteTemplateTime");if(y instanceof Number){B+=y}n.utils.domData.set(z,"rewriteTemplateTime",B)}};document.body.appendChild(t.infoBox);document.body.addEventListener("click",t.eventHandler,false)}else{t.dispose();t=null}return};var v=new Function("viewModel","model","//Use your browser's debugger to inspect the model and view model\ndebugger;");var r=/^function\s*([^\s(]+)/;var p=function(C){var w=document.createElement("div");n.utils.domData.set(w,n.bindings.wipeout.utils.wipeoutKey,C);var B;var x=C.constructor.name?C.constructor.name:((B=C.constructor.toString().match(r))?B[1]:"unknown vm type");var z=["<h4 style='cursor: pointer; margin-bottom: 5px;'>"+x+(C.id?(" #"+C.id):"")+"</h4>"];if(C.__woBag.profiler){for(var y in C.__woBag.profiler){z.push("<label>"+y+":</label> "+C.__woBag.profiler[y])}}w.innerHTML+=z.join("<br />");function A(){v(C,C.model())}w.firstChild.addEventListener("click",A,false);return{element:w,dispsoe:function(){w.firstChild.removeEventListener("click",A);n.utils.domData.clear(w)}}};return s});e("wipeout.template.asyncLoader",function(){var o=function o(){this.pending={}};o.prototype.load=function(r,q){if(!this.pending[r]){this.pending[r]=new p(r)}this.pending[r].add(q||function(){})};function p(r){this._success=n.viewModels.contentControl.templateExists(r);this._callbacks=this._success?null:[];this.templateName=r;if(!this._success){var q=this;n.utils.obj.ajax({type:"GET",url:r,success:function(v){n.viewModels.contentControl.createTemplate(r,v.responseText);q._success=true;var s=q._callbacks;delete q._callbacks;for(var t=0,u=s.length;t<u;t++){s[t]()}},error:function(){delete q._callbacks;q._success=false;throw'Could not locate template "'+r+'"'}})}}p.prototype.add=function(q){if(this._callbacks){this._callbacks.push(q)}else{if(this._success){q()}else{throw'Could not load template "'+this.templateName+'"'}}};o.instance=new o();return o});e("wipeout.template.engine",function(){var r=function r(){};r.prototype=new ko.templateEngine();var p=/\$find/;var o=/\$call/;var q=/\$findAndCall/;r.createJavaScriptEvaluatorFunction=function(w){var u=p.test(w)?"\n\tvar $find = wipeout.utils.find.create(bindingContext);":"";var v=q.test(w)?"\n\tvar $findAndCall = wipeout.utils.findAndCall.create($find);":"";var t=o.test(w)?"\n\tvar $call = wipeout.utils.call.create();":"";return new Function("bindingContext","with(bindingContext) {"+u+v+t+"\n\twith($data) {\n\t\treturn "+w+";\n\t}\n}")};r.createJavaScriptEvaluatorBlock=function(t){var u=r.newScriptId();if(t instanceof Function){r.scriptCache[u]=t}else{r.scriptCache[u]=r.createJavaScriptEvaluatorFunction(t)}return r.openCodeTag+u+r.closeCodeTag};r.prototype.createJavaScriptEvaluatorBlock=function(t){return r.createJavaScriptEvaluatorBlock(t)};r.prototype.rewriteTemplate=function(v,t,w){var u=document.getElementById(v);if(u instanceof HTMLElement){if(!r.scriptHasBeenReWritten.test(u.text)){ko.templateEngine.prototype.rewriteTemplate.call(this,v,t,w)}else{this.makeTemplateSource(v,w).data("isRewritten",true)}this.wipeoutRewrite(u,t)}else{ko.templateEngine.prototype.rewriteTemplate.call(this,v,t,w)}};r.wipeoutRewrite=function(A,y){if(n.viewModels.visual.reservedTags[n.utils.obj.trimToLower(A.name)]){for(var t=0;t<A.length;t++){if(A[t] instanceof n.template.templateElement){r.wipeoutRewrite(A[t],y)}}}else{var w=r.newScriptId();r.xmlCache[w]=A;var z="<!-- ko";if(f){z+=" wipeout-type: '"+A.name+"',"}var u="null";if(A.attributes.id){u="'"+A.attributes.id.value+"'"}z+=" wo: { type: "+d(A.name)+", id: "+u+", name: '"+A.name+"', initXml: '"+w+"'} --><!-- /ko -->";z=n.template.templateParser(y(z));var x=A.getParentElement();var v=x.indexOf(A);x.splice(v,1);while(z.length){x.splice(v,0,z.splice(z.length-1,1)[0])}}};r.prototype.wipeoutRewrite=function(v,u){var x=n.template.templateParser(v.text);var w=[];for(var t=0;t<x.length;t++){if(x[t] instanceof n.template.templateElement){r.wipeoutRewrite(x[t],u)}w.push(x[t].serialize())}v.text=w.join("")};r.prototype.renderTemplateSource=function(x,t,v){if(!(t.$data instanceof n.viewModels.view)){return[]}var u=x.data("precompiled");if(!u){u=new n.template.htmlBuilder(x.text());x.data("precompiled",u)}var w;ko.dependentObservable(function(){w=u.render(t)},this).dispose();return w};if(f){var s=function(t){r.prototype[t]=function(){ko.templateEngine.prototype[t].apply(this,arguments)}};s("isTemplateRewritten");s("makeTemplateSource");s("renderTemplate")}r.newScriptId=(function(){var t=Math.floor(Math.random()*10000);return function(){return(++t).toString()}})();r.xmlCache={};r.scriptCache={};r.openCodeTag="<!-- wipeout_code: {";r.closeCodeTag="} -->";r.scriptHasBeenReWritten=RegExp(r.openCodeTag.replace("{","{")+"[0-9]+"+r.closeCodeTag.replace("}","}"));r.instance=new r();return r});e("wipeout.template.htmlBuilder",function(){var o=function o(p){this.preRendered=[];this.generatePreRender(p)};o.prototype.render=function(p){var q=[];var v=[];for(var s=0,t=this.preRendered.length;s<t;s++){if(this.preRendered[s] instanceof Function){var u=this.preRendered[s](p);v.push(u)}else{v.push(this.preRendered[s])}}var r=n.utils.html.createElements(v.join(""));h(o.getTemplateIds({childNodes:r}),function(x,w){p.$data.templateItems[w]=x});if(p.$data instanceof n.viewModels.view){p.$data.onInitialized()}return r};o.prototype.generatePreRender=function(t){var r=n.template.engine.openCodeTag;var p=n.template.engine.closeCodeTag;this.preRendered.length=0;var s,q;while((s=t.indexOf(r))!==-1){this.preRendered.push(t.substr(0,s));t=t.substr(s);q=t.indexOf(p);if(q===-1){throw"Invalid wipeout_code tag."}this.preRendered.push((function(u){return n.template.engine.scriptCache[u]})(t.substr(r.length,q-r.length)));t=t.substr(q+p.length)}this.preRendered.push(t)};o.getTemplateIds=function(p){var q={};g(p.childNodes,function(t){if(t.nodeType===1){for(var r=0,s=t.attributes.length;r<s;r++){if(t.attributes[r].nodeName==="id"){q[t.attributes[r].nodeValue]=t;break}}h(o.getTemplateIds(t),function(u,v){q[v]=u})}});return q};return o});var j=function(){if(this._parentElement){if(this._parentElement.indexOf(this)===-1){delete this._parentElement}}return this._parentElement};e("wipeout.template.templateElementBase",function(){var o=n.base.object.extend.call(Array,function o(){this._super()});o.extend=n.base.object.extend;o.prototype._super=n.base.object.prototype._super;o.prototype.push=function(p){if(p.getParentElement!==j){throw"Invalid template node"}if(p.getParentElement()){throw"This node already has a parent element"}var q=this._super(p);p._parentElement=this;return q};o.prototype.splice=function(){for(var p=2,q=arguments.length;p<q;p++){if(!arguments[p].getParentElement){throw"Invalid template node"}if(arguments[p].getParentElement()){throw"This node already has a parent element"}}var r=this._super.apply(this,arguments);for(var p=2,q=arguments.length;p<q;p++){arguments[p]._parentElement=this}return r};o.prototype.serializeChildren=function(){var p=[];n.utils.obj.enumerateArr(this,function(q){p.push(q.serialize())});return p.join("")};return o});e("wipeout.template.rootTemplateElement",function(){var o=n.template.templateElementBase.extend(function o(){this._super()});return o});e("wipeout.template.templateElement",function(){var o=n.template.templateElementBase.extend(function o(q,p){this._super();this.name=q;this.attributes={};this.inline=!!p;this.nodeType=1});o.prototype.getParentElement=j;o.prototype.serialize=function(){var s=[];s.splice(0,0,"<",this.name);var r=2;for(var q in this.attributes){s.splice(r,0," ",q,this.attributes[q].serializeValue());r+=3}var p=this.serializeChildren();if(!p.length&&this.inline){s.push(" />")}else{s.push(">");s.push(p);s.push("</"+this.name+">")}return s.join("")};return o});e("wipeout.template.templateAttribute",function(){function o(q,p){this.value=q;this.surrounding=p;this.nodeType=2}o.prototype.serializeValue=function(){if(!this.value&&!this.surrounding){return""}if(!this.surrounding){return"="+this.value}return"="+this.surrounding+this.value+this.surrounding};return o});e("wipeout.template.templateComment",function(){var o=function o(p){this.commentText=p;this.nodeType=8};o.prototype.serialize=function(){return"<!--"+this.commentText+"-->"};o.prototype.getParentElement=j;return o});e("wipeout.template.templateString",function(){var o=function o(p){this.text=p;this.nodeType=3};o.prototype.serialize=function(){return this.text};o.prototype.getParentElement=j;return o});e("wipeout.template.templateParser",function(){function B(F){var D=B.preParse(F);var E=new n.template.rootTemplateElement();B._parseTheEther(D,E,0);return E}B.specialTags={};var C=B.specialTags.whiteSpace=new n.template.templatePart(/\s+/,false);var t=B.specialTags.equals=new n.template.templatePart(/\s*=\s*/,false);var y=B.specialTags.openSQuote=new n.template.templatePart("'",false);var q=B.specialTags.closeSQuote=new n.template.templatePart("'","\\");var x=B.specialTags.openDQuote=new n.template.templatePart('"',false);var p=B.specialTags.closeDQuote=new n.template.templatePart('"',"\\");var z=B.specialTags.openTag1=new n.template.templatePart("<",false);var A=B.specialTags.openTag2=new n.template.templatePart("</",false);var r=B.specialTags.closeTag1=new n.template.templatePart(">",false);var s=B.specialTags.closeTag2=new n.template.templatePart("/>",false);var w=B.specialTags.openComment=new n.template.templatePart("<!--",false);var o=B.specialTags.closeComment=new n.template.templatePart("-->",false);var u=[y,x,r,s,t,C];var v=[w,A,z];g(u,function(D){C.nextChars.push(D)});g(u,function(D){t.nextChars.push(D)});y.nextChars.push(q);g(u,function(D){q.nextChars.push(D)});x.nextChars.push(p);g(u,function(D){p.nextChars.push(D)});g(u,function(D){z.nextChars.push(D)});A.nextChars.push(r);g(v,function(D){r.nextChars.push(D)});g(v,function(D){s.nextChars.push(D)});w.nextChars.push(o);g(v,function(D){o.nextChars.push(D)});B.findFirstInstance=function(F,J,G){var I,H,E,D;n.utils.obj.enumerateArr(G,function(K){if((I=K.indexOf(F,J))&&(!H||H.index>I.index)){if(K.escaped){D=0;var L=K.escaped.length;for(E=I.index-L;E>J;E-=L){if(E>=0&&F.substr(E,L)===K.escaped){D++}else{break}}if(D%2!=0){var M=B.findFirstInstance(F,I.index+1,[K]);if(M&&(!H||M.index<H.index)){H=M}return}}H={type:K,index:I.index,length:I.length}}});return H};B.preParse=function(E){var F={type:{nextChars:v}},D=0,G=[];while(true){F=B.findFirstInstance(E,D,F.type.nextChars);if(!F){if(E.length>D){G.push(E.substr(D))}break}else{if(F.index>D){G.push(E.substring(D,F.index))}G.push(F.type);D=F.index+F.length}}return G};B._createAttribute=function(F,G){var D=G;if(typeof F[D]!=="string"){throw {message:"Cannot create template attribute"}}var E=F[D];D++;if(F[D]===C||F[D]===r||F[D]===s){return{index:D,name:E,value:new n.template.templateAttribute(null,null)}}if(F[D]===t){D++;if(typeof F[D]==="string"){return{index:D+1,name:E,value:new n.template.templateAttribute(F[D],null)}}if(F[D]===x||F[D]===y){D++;if(typeof F[D]==="string"&&(F[D+1]===p||F[D+1]===q)){return{index:D+2,name:E,value:new n.template.templateAttribute(F[D],F[D+1]===p?'"':"'")}}if(F[D]===p||F[D]===q){return{index:D+1,name:E,value:new n.template.templateAttribute("",F[D]===p?'"':"'")}}}}throw {message:"Cannot create template attribute"}};B._createHtmlElement=function(I,J,H){var F=J;if(I[F]!==z){throw {message:"Cannot create template element"}}F++;if(I[F]===C){F++}if(typeof I[F]!=="string"||!I[F].length){throw {message:"Cannot create template element"}}var E=new n.template.templateElement(I[F],H);H.push(E);F++;for(var G=I.length;F<G;F++){if(I[F]===r||I[F]===s||(I[F]===C&&(I[F+1]===r||I[F+1]===s))){if(I[F]===C){F++}E.inline=I[F]===s;F++;return E.inline?F:B._parseTheEther(I,E,F)}if(I[F]!==C){throw {message:"Cannot create template element"}}var D=B._createAttribute(I,F+1);F=D.index-1;E.attributes[D.name]=D.value}return F};B._parseTheEther=function(F,G,H){for(var D=H,E=F.length;D<E;D++){if(typeof F[D]==="string"){G.push(new n.template.templateString(F[D]))}else{if(F[D]===w){if(F[D+1]===o){G.push(new n.template.templateComment(""));D++}else{if(typeof F[D+1]==="string"&&F[D+2]===o){G.push(new n.template.templateComment(F[D+1]));D+=2}else{throw {message:"Cannot find closing comment tag"}}}}else{if(F[D]===z){D=B._createHtmlElement(F,D,G)-1}else{if(F[D]===A){if(G.name&&typeof F[D+1]==="string"&&F[D+2]===r){if(G.name===n.utils.obj.trim(F[D+1])){return D+3}throw {message:"Invalid closing tag"}}else{throw {message:"Invalid closing tag"}}}else{throw {message:"Invalid template"}}}}}}return D};return B});e("wipeout.utils.bindingDomManipulationWorker",function(){var o=n.utils.domManipulationWorkerBase.extend(function o(){this._super()});o.prototype.finish=function(){h(n.bindings.bindingBase.registered,function(p){if(p.checkHasMoved()&&this._mutations.indexOf(p.element)===-1){this._mutations.push(p.element)}},this);this._super()};return o});e("wipeout.utils.call",function(){var o=n.base.object.extend(function o(){this._super()});o.prototype.call=function(s){if(!s){throw"Could not find an object to call function on."}var q=[];var p=null;var r=function(){var u=s;var v=null;if(q.length>0){for(var w=0,x=q.length-1;w<x&&u;w++){u=ko.utils.unwrapObservable(u[q[w]])}if(!u){var y="Could not find the object "+q[w-1]}if(!u[q[w]]){throw'Could not find function :"'+q[w]+'" on this object.'}v=u[q[w]]}else{if(s.constructor!==Function){throw"Cannot call an object like a function"}v=s}if(p){var t=n.utils.obj.copyArray(p);g(arguments,function(z){t.push(z)});return v.apply(u,t)}else{return v.apply(u,arguments)}};r.dot=function(t){q.push(t);return r};r.args=function(){p=n.utils.obj.copyArray(arguments);return r};return r};o.create=function(){var p=new n.utils.call();return function(q){return p.call(q)}};return o});e("wipeout.utils.domData",function(){var p="__wipeout_domData";function o(){}function q(r){if(!r){throw"Invalid html element"}return r[p]=r[p]||{}}o.get=function(r,s){return arguments.length>1?q(r)[s]:q(r)};o.set=function(r,s,t){return q(r)[s]=t};o.clear=function(r,s){if(s){delete q(r)[s]}else{delete r[p]}};return o});e("wipeout.utils.find",function(){var o=n.base.object.extend(function o(p){this._super();this.bindingContext=p});o.prototype.find=function(s,p){var t={};if(p){for(var r in p){t[r]=p[r]}}p=t;if(!p.$number){p.$number=0}if(s&&s.constructor===Function){p.$instanceOf=s}else{if(s&&s.constructor!==String){for(var r in s){p[r]=s[r]}}else{p.$ancestry=n.utils.obj.trim(s)}}if(!p.$number&&p.$n){p.$number=p.$n}if(!p.$instanceOf&&p.$i){p.$instanceOf=p.$i}if(!p.$instanceOf&&p.$instanceof){p.$instanceOf=p.$instanceof}if(!p.$ancestry&&p.$a){p.$ancestry=p.$a}if(!p.$type&&p.$t){p.$type=p.$t}var q=p.$m||p.$model;delete p.$m;delete p.$model;delete p.$n;delete p.$instanceof;delete p.$i;delete p.$a;delete p.$t;return this._find(p,q)};o.prototype._find=function(r,t){if(!this.bindingContext||!this.bindingContext.$parentContext){return null}var s=t?function(w){return w&&w.$data instanceof wo.view?w.$data.model():null}:function(w){return w?w.$data:null};var q,p=this.bindingContext;for(var v=r.$number;v>=0&&p;v--){var u=0;p=p.$parentContext;while(!n.utils.find.is(q=s(p),r,u)&&p){p=p.$parentContext;u++}}return q};o.create=function(p){var q=new n.utils.find(p);return function(s,r){return q.find(s,r)}};o.regex={ancestors:/^(great)*(grand){0,1}parent$/,great:/great/g,grand:/grand/g};o.$type=function(p,r,q){return p&&p.constructor===r};o.$ancestry=function(p,s,r){s=(s||"").toLowerCase();if(s.indexOf("greatparent")!==-1){return false}var t=0;var q=s.match(n.utils.find.regex.great);if(q){t+=q.length}q=s.match(n.utils.find.regex.grand);if(q){t+=q.length}return t===r};o.$instanceOf=function(p,r,q){if(!p||!r||r.constructor!==Function){return false}return p instanceof r};o.is=function(s,p,r){if(!s){return false}for(var q in p){if(q==="$number"){continue}if(q[0]==="$"){if(!n.utils.find[q](s,p[q],r)){return false}}else{if(ko.utils.unwrapObservable(p[q])!==ko.utils.unwrapObservable(s[q])){return false}}}return true};return o});e("wipeout.utils.findAndCall",function(){var p=n.utils.call.extend(function o(q){this._super();this.find=q});p.prototype.call=function(r,q){return this._super(this.find(r,q))};p.create=function(r){var q=new n.utils.findAndCall(r);return function(t,s){return q.call(t,s)}};return p});e("wipeout.utils.html",function(){var B=function(H){if(!H){return null}if(H.constructor===HTMLHtmlElement){throw"Cannot serialize a Html element using outerHTML"}var I=H.nodeType===1?(D[H.tagName.toLowerCase()]||"div"):"div";var G=document.createElement(I);G.appendChild(H.cloneNode(true));return G.innerHTML};var F=/[a-zA-Z0-9]/;var w=function(I){I=I.replace(/^\s+|\s+$/g,"");if(!I||I[0]!=="<"){throw"Invalid html tag"}I=I.substring(1).replace(/^\s+|\s+$/g,"");for(var G=0,H=I.length;G<H;G++){if(!F.test(I[G])){break}}return I.substring(0,G)};var E=/<\!--[^>]*-->/g;var v=function(G){G=G.replace(E,"").replace(/^\s+|\s+$/g,"");var H=0;if((H=G.indexOf("<"))===-1){return null}return w(G.substring(H))};var D={area:"map",base:"head",basefont:"head",body:"html",caption:"table",col:"colgroup",colgroup:"table",command:"menu",frame:"frameset",frameset:"html",head:"html",keygen:"form",li:"ul",optgroup:"select",option:"select",rp:"rt",rt:"ruby",source:"audio",tbody:"table",td:"tr",tfoot:"table",th:"tr",thead:"table",tr:"tbody"};var o={html:true,basefont:true,base:true,body:true,frame:true,frameset:true,head:true};function t(K,H){for(var I=0,J=K.childNodes.length;I<J;I++){var G=K.childNodes[I];if(G.nodeType===1&&n.utils.obj.trimToLower(G.tagName)===n.utils.obj.trimToLower(H)){return G}}}var z={audio:true,col:true,colgroup:true,frameset:true,head:true,rp:true,rt:true,ruby:true,select:true,style:true,table:true,tbody:true,tfooy:true,thead:true,title:true,tr:true};var C={keygen:"select"};var q=function(H){var K=n.utils.obj.trimToLower(w(H));if(o[K]){throw'Cannot create an instance of the "'+K+'" tag.'}var J=D[K]||"div";if(ko.utils.ieVersion&&z[J]){return t(q("<"+J+">"+H+"</"+J+">"),K)}var I=document.createElement(J);I.innerHTML=H;function G(O){if(!O){return null}for(var M=0,N=I.childNodes.length;M<N;M++){if(I.childNodes[M].nodeType===1&&I.childNodes[M].tagName.toLowerCase()===O){var L=I.childNodes[M];I.removeChild(L);return L}}return null}return G(K)||G(C[K])};var r=function(H){if(H==null){return[]}var K=v(H)||"div";var J=D[w("<"+K+"/>")]||"div";if(ko.utils.ieVersion&&z[J]){var G=q("<"+J+">"+H+"</"+J+">");var I=[];while(G.firstChild){I.push(G.firstChild);G.removeChild(G.firstChild)}return I}H="<"+K+"></"+K+">"+H+"<"+K+"></"+K+">";var G=document.createElement(J);G.innerHTML=H;var I=[];while(G.firstChild){I.push(G.firstChild);G.removeChild(G.firstChild)}I.splice(0,1);I.splice(I.length-1,1);return I};var u=function(I){var G=[];if(n.utils.ko.isVirtual(I)){var M=n.utils.ko.parentElement(I);for(var J=0,K=M.childNodes.length;J<K;J++){if(M.childNodes[J]===I){break}}J++;for(var K=M.childNodes.length;J<K;J++){G.push(M.childNodes[J])}}else{G=I.childNodes}var L=[];var H=0;for(var J=0,K=G.length;J<K;J++){if(n.utils.ko.isVirtualClosing(G[J])){H--;if(H<0){return L}continue}if(H>0){continue}L.push(G[J]);if(n.utils.ko.isVirtual(G[J])){H++}}return L};var x=function(G){var I=n.utils.domData.get(G,n.bindings.wipeout.utils.wipeoutKey);if(I){return I}var H=n.utils.ko.parentElement(G);if(H){return x(H)}return null};var s=function(G){return q("<span>Loading template</span>")};var A=function(G){n.template.asyncLoader.instance.load(G)};var p=function(J){var G=n.utils.domData.get(J,n.bindings.bindingBase.dataKey);var I=false;g(G,function(K){I|=K.bindingMeta.controlsDescendantBindings});if(!I){var H=ko.virtualElements.firstChild(J);while(H){p(H);H=ko.virtualElements.nextSibling(H)}}g(G,function(K){K.dispose()});n.utils.domData.clear(J,n.bindings.bindingBase.dataKey);ko.cleanNode(J)};var y=function y(G){n.utils.htmlAsync(function(H){G();H()})};y.cleanNode=p;y.cannotCreateTags=o;y.createTemplatePlaceholder=s;y.specialTags=D;y.getFirstTagName=v;y.getTagName=w;y.getAllChildren=u;y.outerHTML=B;y.createElement=q;y.createElements=r;y.getViewModel=x;return y});e("wipeout.utils.htmlAsync",function(){var o=(function(){var q=[];var s=[];var u=null;function t(){if(u||!q.length){return}u=window.MutationObserver?new n.utils.mutationObserverDomManipulationWorker():new n.utils.bindingDomManipulationWorker();var v=function(){if(v===null){return}v=null;setTimeout(function(){r()},1)};q.splice(0,1)[0](v);setTimeout(function(){if(!v){return}if(!n.settings.suppressWarnings){console.error("Cleanup callback for async move method was not called. Cleanup has been automatically called, which may cause undesired behaviour.")}v()},n.settings.htmlAsyncTimeout>0?n.settings.htmlAsyncTimeout:10000)}function r(){u.finish();u=null;t()}return{add:function(v){q.push(v);t()}}}());var p=function p(q){if(!(q instanceof Function)){throw"Invalid move functionality"}o.add(q)};return p});e("wipeout.utils.ko",function(){var o=function o(){};o.version=function(){if(!ko||!ko.version){return null}var u=ko.version.split(".");for(var s=0,t=u.length;s<t;s++){u[s]=parseInt(u[s])}return u};o.peek=function(s){if(ko.isObservable(s)){return s.peek()}else{return s}};o.array={diff:{added:"added",deleted:"deleted",retained:"retained"}};o.parentElement=function(u){var t=0;var s=u.previousSibling;while(s){if(o.isVirtual(s)){if(t<0){t++}else{return s}}else{if(o.isVirtualClosing(s)){t--}}s=s.previousSibling}return u.parentNode};var p=document&&document.createComment("test").text==="<!--test-->";var r=p?/^<!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*-->$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/;var q=p?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/;o.isVirtual=function(s){return s&&(s.nodeType==8)&&(p?s.text:s.nodeValue).match(r)};o.isVirtualClosing=function(s){return s&&(s.nodeType==8)&&(p?s.text:s.nodeValue).match(q)};o.getClosingTag=function(t){if(!o.isVirtual(t)){throw"Invalid virtual element"}var s=1;while(t&&s>0){t=t.nextSibling;if(o.isVirtual(t)){s++}if(o.isVirtualClosing(t)){s--}}if(!t){throw"Could not find closing tag for element."}return t};o.enumerateOverChildren=function(t,s){t=ko.virtualElements.firstChild(t);while(t){s(t);t=ko.virtualElements.nextSibling(t)}};return o});e("wipeout.utils.mutationObserverDomManipulationWorker",function(){var o=n.utils.domManipulationWorkerBase.extend(function o(){this._super();var p=this;this._observer=new MutationObserver(function(q){p.appendRemovedNodes(q)});this._observer.observe(document.body,{childList:true,subtree:true})});o.prototype.appendRemovedNodes=function(p){g(p,function(q){g(q.removedNodes,function(r){if(this._mutations.indexOf(r)===-1){this._mutations.push(r)}},this)},this)};o.prototype.finish=function(){this._observer.disconnect();delete this._observer;this._super()};return o});e("wipeout.viewModels.contentControl",function(){var o=n.viewModels.view.extend(function o(s,r){this._super(s||n.viewModels.visual.getBlankTemplateId(),r);this.template=o.createTemplatePropertyFor(this.templateId,this)});o.createTemplatePropertyFor=function(t,s){var r=ko.dependentObservable({read:function(){var u=document.getElementById(t());return u?u.text:""},write:function(u){t(n.viewModels.contentControl.createAnonymousTemplate(u))},owner:s});if(s instanceof n.viewModels.visual){s.registerDisposable(r)}return r};var p="data-templatehash";var q=(function(){var r=(function(){var t=null;return function(){if(!t){t=n.utils.html.createElement("<div style='display: none'></div>");document.body.appendChild(t)}return t}})();var s=Math.floor(Math.random()*1000000000);return{create:function(z,t){var y=r();z=l(z||"");var u=o.hashCode(z).toString();if(!t){for(var w=0,x=y.childNodes.length;w<x;w++){if(y.childNodes[w].nodeType===1&&y.childNodes[w].nodeName==="SCRIPT"&&y.childNodes[w].id&&y.childNodes[w].attributes[p]&&y.childNodes[w].attributes[p].value===u&&n.utils.domData.get(y.childNodes[w],"rawTemplate")===z){return y.childNodes[w].id}}}var v="AnonymousTemplate"+(++s);o.createTemplate(v,z,u);return v},del:function(v){var u=r();for(var t=0;t<u.childNodes.length;t++){if(u.childNodes[t].nodeType===1&&u.childNodes[t].nodeName==="SCRIPT"&&u.childNodes[t].id===v){u.removeChild(u.childNodes[t]);t--}}},createTemplate:function(A,x,z){if(o.templateExists(A)){throw'Template: "'+A+'" already exists'}var y=r();var w=document.createElement("script");var t=document.createAttribute("type");t.value="text/xml";w.setAttributeNode(t);var u=document.createAttribute("id");u.value=A;w.setAttributeNode(u);z=z||o.hashCode(l(x)||"").toString();var v=document.createAttribute(p);v.value=z;w.setAttributeNode(v);w.text=x;y.appendChild(w);n.utils.domData.set(w,"rawTemplate",x)}}})();o.createAnonymousTemplate=q.create;o.deleteAnonymousTemplate=q.del;o.createTemplate=q.createTemplate;o.templateExists=function(r){return !!document.getElementById(r)};o.hashCode=function(v){var s=0;for(var t=0,u=v.length;t<u;t++){var r=v.charCodeAt(t);s=((s<<5)-s)+r;s=s&s}return s};return o});e("wipeout.viewModels.if",function(){var p=true;var q=function(){if(!p){return}p=false;o.blankTemplateId=n.viewModels.contentControl.createAnonymousTemplate("",true)};var o=n.viewModels.contentControl.extend(function o(v,u){q();this._super(v,u);this.shareParentScope=true;this.condition=ko.observable();this.elseTemplateId=ko.observable(o.blankTemplateId);var r=this.elseTemplateId.subscribe(this.elseTemplateChanged,this);this.registerDisposable(r);this.elseTemplate=n.viewModels.contentControl.createTemplatePropertyFor(this.elseTemplateId,this);this.__cachedTemplateId=this.templateId();var s=this.condition.subscribe(this.onConditionChanged,this);this.registerDisposable(s);var t=this.templateId.subscribe(this.copyTemplateId,this);this.registerDisposable(t);this.copyTemplateId(this.templateId())});o.prototype.elseTemplateChanged=function(r){if(!this.condition()){this.templateId(r)}};o.prototype.onConditionChanged=function(r){if(this.__oldConditionVal&&!r){this.templateId(this.elseTemplateId())}else{if(!this.__oldConditionVal&&r){this.templateId(this.__cachedTemplateId)}}this.__oldConditionVal=!!r};o.prototype.copyTemplateId=function(r){if(r!==this.elseTemplateId()){this.__cachedTemplateId=r}if(!this.condition()&&r!==this.elseTemplateId()){this.templateId(this.elseTemplateId())}};return o});e("wipeout.viewModels.itemsControl",function(){var o;var q=function(){if(o){return}o=n.viewModels.contentControl.createAnonymousTemplate("<div data-bind='itemsControl: null'></div>")};var p=n.viewModels.contentControl.extend(function p(v,t,u){q();this._super(v||o,u);this.itemTemplateId=ko.observable(t);this.itemTemplate=n.viewModels.contentControl.createTemplatePropertyFor(this.itemTemplateId,this);this.itemSource=ko.observableArray([]);this.items=ko.observableArray([]);if(n.utils.ko.version()[0]<3){p._subscribeV2.call(this)}else{p._subscribeV3.call(this)}var r=this.items.subscribe(this._syncModelsAndViewModels,this);this.registerDisposable(r);t=this.itemTemplateId.peek();var s=this.itemTemplateId.subscribe(function(w){if(t!==w){try{this.reDrawItems()}finally{t=w}}},this);this.registerDisposable(s);this.registerRoutedEvent(p.removeItem,this._removeItem,this)});p._subscribeV2=function(){var u=this.itemSource.peek();var r=this.itemSource.subscribe(function(){try{if(this._modelsAndViewModelsAreSynched()){return}this._itemSourceChanged(ko.utils.compareArrays(u,arguments[0]||[]))}finally{u=n.utils.obj.copyArray(arguments[0]||[])}},this);this.registerDisposable(r);var t=this.items.peek();var s=this.items.subscribe(function(){try{this._itemsChanged(ko.utils.compareArrays(t,arguments[0]||[]))}finally{t=n.utils.obj.copyArray(arguments[0]||[])}},this);this.registerDisposable(s)};p.removeItem=n.events.routedEvent();p._subscribeV3=function(){var r=this.itemSource.subscribe(this._itemSourceChanged,this,"arrayChange");this.registerDisposable(r);var s=this.items.subscribe(this._itemsChanged,this,"arrayChange");this.registerDisposable(s)};p.prototype._removeItem=function(r){if(this.itemSource.indexOf(r.data)!==-1){this.removeItem(r.data);r.handled=true}};p.prototype.removeItem=function(r){this.itemSource.remove(r)};p.prototype._initialize=function(t,r){if(t){var s=t.attributes.shareParentScope||t.attributes["share-parent-scope"];if(s&&k(s.value)){throw"A wo.itemsControl cannot share it's parents scope."}}this._super(t,r)};p.prototype._syncModelsAndViewModels=function(){var r=false,u=false;var v=this.itemSource();if(v==null){u=true;v=[]}var w=this.items();if(v.length!==w.length){r=true;v.length=w.length}for(var s=0,t=w.length;s<t;s++){if(w[s].model()!==v[s]){v[s]=w[s].model();r=true}}if(r){if(u){this.itemSource(v)}else{this.itemSource.valueHasMutated()}}};p.prototype._modelsAndViewModelsAreSynched=function(){var t=this.itemSource()||[];var u=this.items()||[];if(t.length!==u.length){return false}for(var r=0,s=t.length;r<s;r++){if(t[r]!==u[r].model()){return false}}return true};p.prototype._itemsChanged=function(r){g(r,function(s){if(s.status===n.utils.ko.array.diff.deleted&&s.moved==null){this.onItemDeleted(s.value)}else{if(s.status===n.utils.ko.array.diff.added&&s.moved==null){this.onItemRendered(s.value)}}},this)};p.prototype._itemSourceChanged=function(s){var x=this.items();var t=[],r=[],y={},u=0;for(var v=0,w=s.length;v<w;v++){if(s[v].status===n.utils.ko.array.diff.retained){continue}else{if(s[v].status===n.utils.ko.array.diff.deleted){t.push((function(z){return function(){var A=x.splice(z.index+u,1)[0];if(z.moved!=null){y[z.moved+"."+z.index]=A}u--}})(s[v]))}else{if(s[v].status===n.utils.ko.array.diff.added){r.push((function(z){return function(){var A=z.moved!=null?y[z.index+"."+z.moved]:this._createItem(z.value);x.splice(z.index,0,A)}})(s[v]))}else{throw"Unsupported status"}}}}for(v=0,w=t.length;v<w;v++){t[v].call(this)}for(v=0,w=r.length;v<w;v++){r[v].call(this)}this.items.valueHasMutated()};p.prototype.onItemRendered=function(r){};p.prototype.dispose=function(){g(this.items(),function(r){r.dispose()});this._super()};p.prototype.onItemDeleted=function(r){r.dispose()};p.prototype._createItem=function(s){var r=this.createItem(s);r.__woBag.createdByWipeout=true;return r};p.prototype.createItem=function(r){return new n.viewModels.view(this.itemTemplateId(),r)};p.prototype.reDrawItems=function(){var t=this.itemSource()||[];var u=this.items();u.length=t.length;for(var r=0,s=t.length;r<s;r++){u[r]=this._createItem(t[r])}this.items.valueHasMutated()};return p});window.wipeout=n;window.wo={};h(n.base,function(p,o){window.wo[o]=p});h(n.events,function(p,o){window.wo[o]=p});h(n.viewModels,function(p,o){window.wo[o]=p});h(n.utils,function(p,o){window.wo[o]=p});var f=wo.DEBUG=false})();