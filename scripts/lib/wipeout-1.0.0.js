// WipeoutJs v1.0.0
// (c) Shane Connon 2014
// http://www.opensource.org/licenses/mit-license.php
(function(){var l={};var b=function(m){var n=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){if((n.status==200||n.status==0)&&m.success){m.success(n)}else{if(m.error){m.error(n)}}}};n.open(m.type||"GET",m.url||document.location.href,m.async!==undefined?m.async:true);n.send();return n};var f=function(o,m,n){n=n||window;if(o==null){return}if(o instanceof Array||o instanceof HTMLCollection||o instanceof NodeList||(window.NamedNodeMap&&o instanceof NamedNodeMap)||(window.MozNamedAttrMap&&o instanceof MozNamedAttrMap)){for(var p=0,q=o.length;p<q;p++){m.call(n,o[p],p)}}else{for(var p in o){m.call(n,o[p],p)}}};var g=function(o,m,n){n=n||window;if(o==null){return}if(o instanceof Array||o instanceof HTMLCollection||o instanceof NodeList||(window.NamedNodeMap&&o instanceof NamedNodeMap)||(window.MozNamedAttrMap&&o instanceof MozNamedAttrMap)){for(var p=o.length-1;p>=0;p--){m.call(n,o[p],p)}}else{var q=[];for(var p in o){q.push(p)}for(var p=q.length-1;p>=0;p--){m.call(n,o[q[p]],q[p])}}};var c=function(o,n,m){var p=d("wipeout.bindings."+o,m);ko.bindingHandlers[o]={init:p.init,update:p.update};if(n){ko.virtualElements.allowedBindings[o]=true}};var d=function(n,m){n=n.split(".");var o=n.splice(0,n.length-1);var p={};p[n[n.length-1]]=m();h(o.join("."),p);return p[n[n.length-1]]};var h=function(o,n){o=o.split(".");if(o[0]!=="wipeout"){throw'Root must be "wipeout".'}o.splice(0,1);var m=l;f(o,function(p){m=m[p]||(m[p]={})});if(n&&n instanceof Function){n=n()}f(n,function(q,p){m[p]=q})};var a=/^\s+|\s+$/g;var j=function(m){return m?m.replace(a,""):m};var k=function(m){return m?j(m).toLowerCase():m};var i=function(m){if(m==null){return false}m=k(m);return !!(m&&m!=="false"&&m!=="0")};d("wipeout.utils.obj",function(){var p=function(t,u){if(!u){u=window}var s=t.split(".");for(var v=0,w=s.length;v<w;v++){u=u[s[v]];if(u==null){return null}}return u};var n=function(t,u){var s=p(t,u);if(s instanceof Function){var v=new s();if(v instanceof l.base.view&&e){v.__woBag.constructedViewType=t}return v}throw t+" is not a valid function."};var m=function(u){var v=[];for(var s=0,t=u.length;s<t;s++){v.push(u[s])}return v};var o=function(t,s){return t.indexOf(s,t.length-s.length)!==-1};var r=function(s){return Math.floor(Math.random()*s)};var q=function q(){};q.ajax=b;q.parseBool=i;q.trimToLower=k;q.trim=j;q.enumerate=f;q.enumerateDesc=g;q.getObject=p;q.createObject=n;q.copyArray=m;q.random=r;q.endsWith=o;return q});d("wipeout.base.object",function(){var n=function n(){};var m={parents:[],children:[]};n.clearVirtualCache=function(p){if(!p){m.parents.length=0;m.children.length=0;return}for(var q=0,r=m.children.length;q<r;q++){if(m.children[q]===p||m.parents[q]===p){m.children.splice(q,1);m.parents.splice(q,1)}}};n.useVirtualCache=true;n.prototype._super=function(){var r=arguments.callee.caller;var p=null;if(n.useVirtualCache){var x=m.children.indexOf(r);if(x!==-1){p=m.parents[x]}}if(!p){var u=[];var q=this.constructor.prototype;while(q){u.push(q);q=Object.getPrototypeOf(q)}u.reverse();for(var s=0,t=u.length;s<t;s++){if(u[s]===r.prototype){p=u[s-1].constructor}else{for(var w in u[s]){if(u[s][w]===r){for(var v=s-1;v>=0;v--){if(u[v][w]!==r){p=u[v][w];break}}}if(p){break}}}if(p){if(n.useVirtualCache){m.children.push(r);m.parents.push(p)}break}}if(!p){throw"Could not find method in parent class"}}return p.apply(this,arguments)};var o=/^[a-zA-Z_][a-zA-Z_0-9]*$/;n.extend=function(r){if(r.constructor===Function){var q=r;r={constructor:q,statics:{}};for(var t in r.constructor){r.statics[s]=r.constructor[s]}for(var t in r.constructor.prototype){r[s]=r.constructor.prototype[s]}}else{if(r.constructor===Object){r.constructor=function(){this._super.apply(this,arguments)}}else{if(!r.constructor||r.constructor.constructor!==Function){throw'the property "constructor" must be a function'}}}for(var v in this){if(this.hasOwnProperty(v)&&this[v]&&this[v].constructor===Function&&this[v]!==n.clearVirtualCache&&r.constructor[v]===undefined){r.constructor[v]=this[v]}}var w=function(){this.constructor=r.constructor};w.prototype=this.prototype;r.constructor.prototype=new w();for(var s in r){if(s==="constructor"){continue}if(s==="statics"){for(var u in r[s]){r.constructor[u]=r[s][u]}continue}r.constructor.prototype[s]=r[s]}return r.constructor};return n});d("wipeout.utils.domManipulationWorkerBase",function(){var m=l.base.object.extend(function m(){this._super();this._mutations=[]});m.prototype.finish=function(){for(var n=0;n<this._mutations.length;n++){if(!document.body.contains(this._mutations[n])){l.utils.html.cleanNode(this._mutations.splice(n,1)[0]);n--}}f(this._mutations,function(o){f(l.bindings.bindingBase.getBindings(o,l.bindings.render),function(p){p.hasMoved()})});this._mutations.length=0};return m});d("wipeout.base.disposable",function(){var m=l.base.object.extend(function m(n){this._super();this.disposeFunction=n||function(){}});m.prototype.dispose=function(){if(this.disposeFunction){this.disposeFunction()}delete this.disposeFunction};return m});d("wipeout.base.visual",function(){var n=l.base.object.extend(function n(o){this._super();this.shareParentScope=false;this.templateItems={};this.templateId=ko.observable(o||n.getDefaultTemplateId());this.__woBag={disposed:l.base.event(),disposables:{},createdByWipeout:false,rootHtmlElement:null,routedEventSubscriptions:[],nodes:[]}});n.getDefaultTemplateId=(function(){var o=null;return function(){if(!o){o=l.base.contentControl.createAnonymousTemplate("<span>No template has been specified</span>")}return o}})();n.getBlankTemplateId=(function(){var o=null;return function(){if(!o){o=l.base.contentControl.createAnonymousTemplate("")}return o}})();n.visualGraph=function(q,o){if(!q){return[]}o=o||function(){return typeof arguments[0]};var p=[];l.utils.obj.enumerate(l.utils.html.getAllChildren(q),function(s){l.utils.obj.enumerate(n.visualGraph(s),p.push,p)});var r=l.utils.domData.get(q,l.bindings.wipeout.utils.wipeoutKey);if(r){return[{viewModel:r,display:o(r),children:p}]}return p};n.prototype.entireViewModelHtml=function(){if(this.__woBag.rootHtmlElement){if(this.__woBag.rootHtmlElement.nodeType===1){return[this.__woBag.rootHtmlElement]}else{if(l.utils.ko.isVirtual(this.__woBag.rootHtmlElement)){var p=[this.__woBag.rootHtmlElement];l.utils.ko.enumerateOverChildren(this.__woBag.rootHtmlElement,function(q){p.push(q);if(l.utils.ko.isVirtual(q)){p.push(l.utils.ko.getClosingTag(q))}});var o=p[p.length-1].nextSibling;if(!l.utils.ko.isVirtualClosing(o)){throw"Could not compile view model html"}p.push(o);return p}}}return[]};n.prototype.disposeOf=function(o){if(this.__woBag.disposables[o]){this.__woBag.disposables[o]();delete this.__woBag.disposables[o]}};n.prototype.disposeOfAll=function(){for(var o in this.__woBag.disposables){this.disposeOf(o)}};n.prototype.registerDisposeCallback=(function(){var o=0;return function(p){if(!p||p.constructor!==Function){throw"The dispose function must be a Function"}var q=(++o).toString();this.__woBag.disposables[q]=p;return q}})();n.prototype.registerDisposable=function(o){if(!o){throw"Invalid disposeable object"}if(o.constructor===Function&&!o.dispose){o=o.call(this)}if(!o||!(o.dispose instanceof Function)){throw"The disposable object must have a dispose(...) function"}return this.registerDisposeCallback(function(){o.dispose()})};n.prototype.getRootHtmlElement=function(){return this.__woBag.rootHtmlElement};n.prototype.dispose=function(){for(var o in this){if(ko.isObservable(this[o])&&this[o].dispose instanceof Function){this[o].dispose()}}f(this.__woBag.routedEventSubscriptions.splice(0,this.__woBag.routedEventSubscriptions.length),function(p){p.dispose()});this.__woBag.disposed.trigger()};n.prototype.getParents=function(p){var o=this.getParent(p);var q=[];while(o){q.push(o);o=o.getParent(p)}return q};n.prototype.getParent=function(o){var q;var p=!this.__woBag.rootHtmlElement||!(q=l.utils.ko.parentElement(this.__woBag.rootHtmlElement))?null:l.utils.html.getViewModel(q);return o||!p||!p.shareParentScope?p:p.getParent(o)};n.prototype.unRegisterRoutedEvent=function(s,o,p){for(var q=0,r=this.__woBag.routedEventSubscriptions.length;q<r;q++){if(this.__woBag.routedEventSubscriptions[q].routedEvent===s){this.__woBag.routedEventSubscriptions[q].event.unRegister(o,p);return true}}return false};n.prototype.registerRoutedEvent=function(u,o,p,s){var t;for(var q=0,r=this.__woBag.routedEventSubscriptions.length;q<r;q++){if(this.__woBag.routedEventSubscriptions[q].routedEvent===u){t=this.__woBag.routedEventSubscriptions[q];break}}if(!t){t=new l.base.routedEventRegistration(u);this.__woBag.routedEventSubscriptions.push(t)}return t.event.register(o,p,s)};n.prototype.triggerRoutedEvent=function(s,o){if(!(o instanceof l.base.routedEventArgs)){o=new l.base.routedEventArgs(o,this)}for(var p=0,q=this.__woBag.routedEventSubscriptions.length;p<q;p++){if(o.handled){return}if(this.__woBag.routedEventSubscriptions[p].routedEvent===s){this.__woBag.routedEventSubscriptions[p].event.trigger(o)}}if(o.handled){return}if(this.model() instanceof l.base.routedEventModel){this.model().routedEventTriggered(s,o)}if(o.handled){return}var r=this.getParent();if(r){r.triggerRoutedEvent(s,o)}};n.prototype.onRendered=function(p,o){};n.prototype.onUnrendered=function(){};n.prototype.onApplicationInitialized=function(){};var m=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","head","header","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"];n.reservedTags={};f(m,function(o){n.reservedTags[o]=true});return n});d("wipeout.base.view",function(){var m="wipeout.base.view.modelRoutedEvents";var n=l.base.visual.extend(function n(q,p){this._super(q);if(p===undefined){p=null}this.model=ko.observable(p);var o=this.model.subscribe(function(r){try{this._onModelChanged(p,r)}finally{p=r}},this);this.registerDisposable(o);this.__woBag.bindings={}});n.setObservable=function(o,p,q){if(ko.isObservable(o[p])){o[p](ko.utils.unwrapObservable(q))}else{o[p]=ko.utils.unwrapObservable(q)}};n.prototype.disposeOfBinding=function(o){if(this.__woBag.bindings[o]){this.__woBag.bindings[o].dispose()}};n.prototype.dispose=function(){this._super();if(this.__woBag[m]){this.disposeOf(this.__woBag[m]);delete this.__woBag[m]}for(var o in this.__woBag.bindings){this.disposeOfBinding(o)}};n.prototype.onInitialized=function(){};n.prototype.bind=function(p,w,t){if(t&&(!ko.isObservable(this[p])||!ko.isObservable(w()))){throw"Two way bindings must be between 2 observables"}this.disposeOfBinding(p);var s=ko.dependentObservable({read:function(){return ko.utils.unwrapObservable(w())},write:t?function(){var x=w();if(x){x(arguments[0])}}:undefined});var u=false;var v=false;n.setObservable(this,p,s.peek());var q=s.subscribe(function(x){if(!u){try{v=true;n.setObservable(this,p,x)}finally{v=false}}},this);var r=t?this[p].subscribe(function(x){if(!v){try{u=true;n.setObservable({x:s},"x",x)}finally{u=false}}},this):null;var o=this;return this.__woBag.bindings[p]=new l.base.disposable(function(){if(q){q.dispose();q=null}if(r){r.dispose();r=null}if(s){s.dispose();s=null}delete o.__woBag.bindings[p]})};n._elementHasModelBinding=function(o){for(var p=0,q=o.attributes.length;p<q;p++){if(o.attributes[p].nodeName==="model"||o.attributes[p].nodeName==="model-tw"){return true}}for(var p=0,q=o.childNodes.length;p<q;p++){if(o.childNodes[p].nodeType===1&&o.childNodes[p].nodeName==="model"){return true}}return false};n.reservedPropertyNames=["constructor","constructor-tw","id","id-tw"];n.prototype._initialize=function(r,p){if(this.__woBag.initialized){throw"Cannot call initialize item twice"}this.__woBag.initialized=true;if(!r){return}this.__woBag.type=r.nodeName;var q=r.getAttribute("id");if(q){this.id=q}q=r.getAttribute("shareParentScope");if(q){this.shareParentScope=i(q)}if(!n._elementHasModelBinding(r)&&l.utils.ko.peek(this.model)==null){this.bind("model",p.$data.model)}var o=this.shareParentScope?p:p.createChildContext(this);f(r.attributes,function(s){if(n.reservedPropertyNames.indexOf(s.nodeName)!==-1){return}var t=s.nodeName,u="";if(s.nodeName.length>3&&t.indexOf("-tw")===s.nodeName.length-3){t=t.substr(0,t.length-3);u=",\n\t\t\tfunction(val) {\n\t\t\t\tif(!ko.isObservable("+s.value+"))\n\t\t\t\t\tthrow 'Two way bindings must be between 2 observables';\n\t\t\t\t"+s.value+"(val);\n\t\t\t}"}try{o.__$woCurrent=this;l.template.engine.createJavaScriptEvaluatorFunction("(function() {\n\t\t\t__$woCurrent.bind('"+t+"', function() {\n\t\t\t\treturn "+s.value+";\n\t\t\t}"+u+");\n\n\t\t\treturn '';\n\t\t})()")(o)}finally{delete o.__$woCurrent}},this);f(r.childNodes,function(s,t){if(s.nodeType!==1||n.reservedPropertyNames.indexOf(s.nodeName)!==-1){return}var y="string";for(var v=0,w=s.attributes.length;v<w;v++){if(s.attributes[v].nodeName==="constructor"&&s.attributes[v].nodeValue){y=s.attributes[v].nodeValue;break}}if(n.objectParser[k(y)]){var u=[];var x=x||new XMLSerializer();for(var v=0,w=s.childNodes.length;v<w;v++){if(s.childNodes[v].nodeType==3){u.push(s.childNodes[v].nodeValue)}else{u.push(x.serializeToString(s.childNodes[v]))}}var z=n.objectParser[k(y)](u.join(""));n.setObservable(this,s.nodeName,z)}else{var z=l.utils.obj.createObject(y);if(z instanceof l.base.view){z.__woBag.createdByWipeout=true;z._initialize(s,o)}n.setObservable(this,s.nodeName,z)}},this)};n.objectParser={json:function(o){return JSON.parse(o)},string:function(o){return o},bool:function(p){var o=k(p);return o?o!=="false"&&o!=="0":false},"int":function(o){return parseInt(j(o))},"float":function(o){return parseFloat(j(o))},regexp:function(o){return new RegExp(j(o))},date:function(o){return new Date(j(o))}};n.prototype._onModelChanged=function(q,p){if(q!==p){this.disposeOf(this.__woBag[m]);delete this.__woBag[m];if(p instanceof l.base.routedEventModel){var o=p.__triggerRoutedEventOnVM.register(this._onModelRoutedEvent,this);this.__woBag[m]=this.registerDisposable(o)}}this.onModelChanged(q,p)};n.prototype.onModelChanged=function(p,o){};n.prototype._onModelRoutedEvent=function(o){if(!(o.routedEvent instanceof l.base.routedEvent)){throw"Invaid routed event"}this.triggerRoutedEvent(o.routedEvent,o.eventArgs)};return n});d("wipeout.base.routedEvent",function(){var m=function m(){if(!(this instanceof m)){return new m()}};m.prototype.trigger=function(o,n){o.triggerRoutedEvent(this,new l.base.routedEventArgs(n,o))};m.prototype.unRegister=function(n,p,o){return p.unRegisterRoutedEvent(this,n,o)};m.prototype.register=function(n,p,o){return p.registerRoutedEvent(this,n,o)};return m});d("wipeout.base.routedEventArgs",function(){var m=function m(n,o){this.handled=false;this.data=n;this.originator=o};return m});d("wipeout.base.routedEventRegistration",function(){var m=function m(n){this.routedEvent=n;this.event=new l.base.event()};m.prototype.dispose=function(){this.event.dispose()};return m});d("wipeout.debug",function(){var m=function(){if(!window.jQuery){throw"This debug tool requires jQuery"}};return{renderedItems:function(p,o){var q=[],r;var n=function(s){if(s){switch(s.nodeType){case 1:f(s.childNodes,n);case 8:if((r=l.utils.html.getViewModel(s))&&q.indexOf(r)===-1&&(!o||r.constructor===o)){q.push(r)}}}};n(p||document.getElementsByTagName("body")[0]);return q}}});d("wipeout.settings",function(){function m(n){f(l.settings,function(o,p){delete l.settings[p]});f(n,function(p,o){l.settings[o]=p})}m.suppressWarnings=false;m.asynchronousTemplates=true;m.htmlAsyncTimeout=10000;return m});d("wipeout.base.contentControl",function(){var m=l.base.view.extend(function m(q,p){this._super(q||l.base.visual.getBlankTemplateId(),p);this.template=m.createTemplatePropertyFor(this.templateId,this)});m.createTemplatePropertyFor=function(r,q){var p=ko.dependentObservable({read:function(){var s=document.getElementById(r());return s?s.textContent:""},write:function(s){r(l.base.contentControl.createAnonymousTemplate(s))},owner:q});if(q instanceof l.base.visual){q.registerDisposable(p)}return p};var n="data-templatehash";var o=(function(){var p=(function(){var r=null;return function(){if(!r){r=l.utils.html.createElement("<div style='display: none'></div>");document.body.appendChild(r)}return r}})();var q=Math.floor(Math.random()*1000000000);return{create:function(x,r){var w=p();x=j(x||"");var s=m.hashCode(x).toString();if(!r){for(var u=0,v=w.childNodes.length;u<v;u++){if(w.childNodes[u].nodeType===1&&w.childNodes[u].nodeName==="SCRIPT"&&w.childNodes[u].id&&w.childNodes[u].attributes[n]&&w.childNodes[u].attributes[n].value===s&&l.utils.domData.get(w.childNodes[u],"rawTemplate")===x){return w.childNodes[u].id}}}var t="AnonymousTemplate"+(++q);m.createTemplate(t,x,s);return t},del:function(t){var s=p();for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType===1&&s.childNodes[r].nodeName==="SCRIPT"&&s.childNodes[r].id===t){s.removeChild(s.childNodes[r]);r--}}},createTemplate:function(y,v,x){if(m.templateExists(y)){throw'Template: "'+y+'" already exists'}var w=p();var u=document.createElement("script");var r=document.createAttribute("type");r.value="text/xml";u.setAttributeNode(r);var s=document.createAttribute("id");s.value=y;u.setAttributeNode(s);x=x||m.hashCode(j(v)||"").toString();var t=document.createAttribute(n);t.value=x;u.setAttributeNode(t);u.textContent=v;w.appendChild(u);l.utils.domData.set(u,"rawTemplate",v)}}})();m.createAnonymousTemplate=o.create;m.deleteAnonymousTemplate=o.del;m.createTemplate=o.createTemplate;m.templateExists=function(p){return !!document.getElementById(p)};m.hashCode=function(t){var q=0;for(var r=0,s=t.length;r<s;r++){var p=t.charCodeAt(r);q=((q<<5)-q)+p;q=q&q}return q};return m});var l=l||{};l.base=l.base||{};d("wipeout.base.eventRegistration",function(){return l.base.disposable.extend(function m(n,o,p){this._super(p);this.callback=n;this.context=o})});d("wipeout.base.event",function(){var m=function m(){if(!(this instanceof m)){return new m()}this._registrations=[]};m.prototype.trigger=function(n){for(var o=0,p=this._registrations.length;o<p;o++){if(n instanceof l.base.routedEventArgs&&n.handled){return}this._registrations[o].callback.call(this._registrations[o].context,n)}};m.prototype.unRegister=function(n,o){o=o==null?window:o;for(var p=0;p<this._registrations.length;p++){if(this._registrations[p].callback===n&&this._registrations[p].context===o){this._registrations.splice(p,1);p--}}};m.prototype.dispose=function(){this._registrations.length=0};m.prototype.register=function(n,o,s){if(!(n instanceof Function)){throw"Invalid event callback"}if(s&&!(s instanceof Number)){throw"Invalid event priority"}var t=this._registrations;var p={priority:s||0,callback:n,context:o==null?window:o,dispose:function(){var u=t.indexOf(p);if(u>=0){t.splice(u,1)}}};for(var q=0,r=this._registrations.length;q<r;q++){if(p.priority<this._registrations[q].priority){this._registrations.splice(q,0,p);break}}if(q===r){this._registrations.push(p)}return new l.base.eventRegistration(p.callback,p.context,p.dispose,p.priority)};return m});d("wipeout.base.if",function(){var n=true;var o=function(){if(!n){return}n=false;m.blankTemplateId=l.base.contentControl.createAnonymousTemplate("",true)};var m=l.base.contentControl.extend(function m(t,s){o();this._super(t,s);this.shareParentScope=true;this.condition=ko.observable();this.elseTemplateId=ko.observable(m.blankTemplateId);var p=this.elseTemplateId.subscribe(this.elseTemplateChanged,this);this.registerDisposable(p);this.elseTemplate=l.base.contentControl.createTemplatePropertyFor(this.elseTemplateId,this);this.__cachedTemplateId=this.templateId();var q=this.condition.subscribe(this.onConditionChanged,this);this.registerDisposable(q);var r=this.templateId.subscribe(this.copyTemplateId,this);this.registerDisposable(r);this.copyTemplateId(this.templateId())});m.prototype.elseTemplateChanged=function(p){if(!this.condition()){this.templateId(p)}};m.prototype.onConditionChanged=function(p){if(this.__oldConditionVal&&!p){this.templateId(this.elseTemplateId())}else{if(!this.__oldConditionVal&&p){this.templateId(this.__cachedTemplateId)}}this.__oldConditionVal=!!p};m.prototype.copyTemplateId=function(p){if(p!==this.elseTemplateId()){this.__cachedTemplateId=p}if(!this.condition()&&p!==this.elseTemplateId()){this.templateId(this.elseTemplateId())}};return m});d("wipeout.base.itemsControl",function(){var m;var o=function(){if(m){return}m=l.base.contentControl.createAnonymousTemplate("<div data-bind='itemsControl: null'></div>")};var n=l.base.contentControl.extend(function n(t,r,s){o();this._super(t||m,s);this.itemTemplateId=ko.observable(r);this.itemTemplate=l.base.contentControl.createTemplatePropertyFor(this.itemTemplateId,this);this.itemSource=ko.observableArray([]);this.items=ko.observableArray([]);if(l.utils.ko.version()[0]<3){n._subscribeV2.call(this)}else{n._subscribeV3.call(this)}var p=this.items.subscribe(this._syncModelsAndViewModels,this);this.registerDisposable(p);r=this.itemTemplateId.peek();var q=this.itemTemplateId.subscribe(function(u){if(r!==u){try{this.reDrawItems()}finally{r=u}}},this);this.registerDisposable(q);this.registerRoutedEvent(n.removeItem,this._removeItem,this)});n._subscribeV2=function(){var s=this.itemSource.peek();var p=this.itemSource.subscribe(function(){try{if(this._modelsAndViewModelsAreSynched()){return}this._itemSourceChanged(ko.utils.compareArrays(s,arguments[0]||[]))}finally{s=l.utils.obj.copyArray(arguments[0]||[])}},this);this.registerDisposable(p);var r=this.items.peek();var q=this.items.subscribe(function(){try{this._itemsChanged(ko.utils.compareArrays(r,arguments[0]||[]))}finally{r=l.utils.obj.copyArray(arguments[0]||[])}},this);this.registerDisposable(q)};n.removeItem=l.base.routedEvent();n._subscribeV3=function(){var p=this.itemSource.subscribe(this._itemSourceChanged,this,"arrayChange");this.registerDisposable(p);var q=this.items.subscribe(this._itemsChanged,this,"arrayChange");this.registerDisposable(q)};n.prototype._removeItem=function(p){if(this.itemSource.indexOf(p.data)!==-1){this.removeItem(p.data);p.handled=true}};n.prototype.removeItem=function(p){this.itemSource.remove(p)};n.prototype._initialize=function(r,p){if(r){var q=r.getAttribute("shareParentScope");if(q&&i(q)){throw"A wo.itemsControl cannot share it's parents scope."}}this._super(r,p)};n.prototype._syncModelsAndViewModels=function(){var p=false,s=false;var t=this.itemSource();if(t==null){s=true;t=[]}var u=this.items();if(t.length!==u.length){p=true;t.length=u.length}for(var q=0,r=u.length;q<r;q++){if(u[q].model()!==t[q]){t[q]=u[q].model();p=true}}if(p){if(s){this.itemSource(t)}else{this.itemSource.valueHasMutated()}}};n.prototype._modelsAndViewModelsAreSynched=function(){var r=this.itemSource()||[];var s=this.items()||[];if(r.length!==s.length){return false}for(var p=0,q=r.length;p<q;p++){if(r[p]!==s[p].model()){return false}}return true};n.prototype._itemsChanged=function(p){f(p,function(q){if(q.status===l.utils.ko.array.diff.deleted&&q.moved==null){this.onItemDeleted(q.value)}else{if(q.status===l.utils.ko.array.diff.added&&q.moved==null){this.onItemRendered(q.value)}}},this)};n.prototype._itemSourceChanged=function(q){var v=this.items();var r=[],p=[],w={},s=0;for(var t=0,u=q.length;t<u;t++){if(q[t].status===l.utils.ko.array.diff.retained){continue}else{if(q[t].status===l.utils.ko.array.diff.deleted){r.push((function(x){return function(){var y=v.splice(x.index+s,1)[0];if(x.moved!=null){w[x.moved+"."+x.index]=y}s--}})(q[t]))}else{if(q[t].status===l.utils.ko.array.diff.added){p.push((function(x){return function(){var y=x.moved!=null?w[x.index+"."+x.moved]:this._createItem(x.value);v.splice(x.index,0,y)}})(q[t]))}else{throw"Unsupported status"}}}}for(t=0,u=r.length;t<u;t++){r[t].call(this)}for(t=0,u=p.length;t<u;t++){p[t].call(this)}this.items.valueHasMutated()};n.prototype.onItemRendered=function(p){};n.prototype.dispose=function(){f(this.items(),function(p){p.dispose()});this._super()};n.prototype.onItemDeleted=function(p){p.dispose()};n.prototype._createItem=function(q){var p=this.createItem(q);p.__woBag.createdByWipeout=true;return p};n.prototype.createItem=function(p){return new l.base.view(this.itemTemplateId(),p)};n.prototype.reDrawItems=function(){var r=this.itemSource()||[];var s=this.items();s.length=r.length;for(var p=0,q=r.length;p<q;p++){s[p]=this._createItem(r[p])}this.items.valueHasMutated()};return n});d("wipeout.base.routedEventModel",function(){var m=l.base.object.extend(function m(){this.__triggerRoutedEventOnVM=new l.base.event();this.__routedEventSubscriptions=[]});m.prototype.triggerRoutedEvent=function(o,n){this.__triggerRoutedEventOnVM.trigger({routedEvent:o,eventArgs:n})};m.prototype.routedEventTriggered=function(q,n){for(var o=0,p=this.__routedEventSubscriptions.length;o<p;o++){if(n.handled){return}if(this.__routedEventSubscriptions[o].routedEvent===q){this.__routedEventSubscriptions[o].event.trigger(n)}}};m.prototype.registerRoutedEvent=function(t,n,o,r){var s;for(var p=0,q=this.__routedEventSubscriptions.length;p<q;p++){if(this.__routedEventSubscriptions[p].routedEvent===t){s=this.__routedEventSubscriptions[p];break}}if(!s){s=new l.base.routedEventRegistration(t);this.__routedEventSubscriptions.push(s)}return s.event.register(n,o,r)};m.prototype.unRegisterRoutedEvent=function(r,n,o){for(var p=0,q=this.__routedEventSubscriptions.length;p<q;p++){if(this.__routedEventSubscriptions[p].routedEvent===r){this.__routedEventSubscriptions[p].event.unRegister(n,o);return true}}return false};return m});d("wipeout.bindings.bindingBase",function(){var m=l.base.disposable.extend(function m(o){this._super();if(!o){throw"ArgumnetNullException"}this.bindingId=l.bindings.bindingBase.uniqueId();this.bindingMeta={};this.element=o;if(!this.getParentElement()){throw'Cannot apply a "wipeout.bindings.bindingBase" binding on an element without a parent node.'}var n=l.utils.domData.get(this.element,l.bindings.bindingBase.dataKey);if(!n){n=l.utils.domData.set(this.element,l.bindings.bindingBase.dataKey,[])}f(n,function(p){if(p.bindingMeta.controlsDescendantBindings){throw"There is already a binding on this element which controls children."}});n.push(this);l.bindings.bindingBase.registered[this.bindingId]=this;this.parentElement=this.getParentElement();this.moved(null,this.parentElement)});m.getParentElement=function(n){return n.parentElement||n.parentNode};m.prototype.getParentElement=function(){return m.getParentElement(this.element)};m.prototype.dispose=function(){this._super();this.moved(this.parentElement,null);var o;var n=l.utils.domData.get(this.element,l.bindings.bindingBase.dataKey);while((o=n.indexOf(this))!==-1){n.splice(o,1)}delete this.element;delete this.parentElement;delete l.bindings.bindingBase.registered[this.bindingId]};m.prototype.checkHasMoved=function(){return this.getParentElement()!==this.parentElement};m.prototype.hasMoved=function(){if(this.checkHasMoved()){this.moved(this.parentElement,this.getParentElement());this.parentElement=this.getParentElement()}};m.prototype.moved=function(o,n){};m.registered={};m.uniqueId=(function(){var n=Math.floor(Math.random()*1000000000);return function(){return"binding-"+(++n)}})();m.getBindings=function(p,o){if(o&&!(o instanceof Function)){throw"Invalid binding type"}var q=false;var n=[];f(l.utils.domData.get(p,l.bindings.bindingBase.dataKey),function(r){if(!o||r instanceof o){n.push(r);q|=r.bindingMeta.controlsDescendantBindings}});if(!q){l.utils.ko.enumerateOverChildren(p,function(r){f(l.bindings.bindingBase.getBindings(r,o),function(s){n.push(s)})})}return n};m.dataKey="wipeout.bindings.bindingBase";return m});c("itemsControl",true,function(){var n="";var o=null;var p=function(){if(o){return}var t="<!-- ko ic-render: null";if(e){t+=", wipeout-type: 'items[' + wipeout.utils.ko.peek($index) + ']'"}t+=" --><!-- /ko -->";if(o){return}o=l.base.contentControl.createAnonymousTemplate(t)};var q=function(u){var t=l.utils.ko.peek(u);if(t&&!(t instanceof l.base.itemsControl)){throw"This binding can only be used on an itemsControl"}};var m=function(v,w,t,x,u){q(x);p();return ko.bindingHandlers.template.init.call(this,v,s.createAccessor(x),t,x,u)};var r=function(v,w,t,x,u){q(x);return ko.bindingHandlers.template.update.call(this,v,s.createAccessor(x),t,x,u)};var s={createAccessor:function(t){t=l.utils.ko.peek(t);return function(){return{name:o,foreach:t.items,templateEngine:l.template.engine.instance}}}};return{init:m,update:r,utils:s}});c("ic-render",true,function(){return{init:function(p,q,m,r,o){var n=new l.bindings.render(p,o.$data,m,o.$parentContext.extend({$index:o.$index}));n.render(l.utils.ko.peek(o.$data))}}});c("render",true,function(){var m=l.bindings.bindingBase.extend(function m(p,r,n,o){this._super(p);this.bindingMeta=ko.bindingHandlers.template.init(this.element,l.bindings.render.createValueAccessor(r),n,null,o);this.allBindingsAccessor=n;this.bindingContext=o;if(ko.isObservable(r)){var q=r.peek();this.subscribed=r.subscribe(function(s){if(s===q){return}try{this.reRender(s)}finally{q=s}},this)}});m.prototype.moved=function(q,p){this._super(q,p);if(e&&!l.settings.suppressWarnings&&this.value){for(var n=0,o=this.value.__woBag.nodes.length;n<o;n++){if(l.utils.ko.parentElement(this.value.__woBag.nodes[n])!==this.value.__woBag.rootHtmlElement){console.warn("Only part of this view model was moved. Un moved nodes will be deleted or orphaned with their bindings cleared when this view model is re-rendered or disposed.");break}}}};m.prototype.dispose=function(){this.unRender();this._super();if(this.subscribed){this.subscribed.dispose();delete this.subscribed}};m.prototype.reRender=function(n){this.unRender();this.render(n)};m.prototype.unTemplate=function(){if(!this.value){return}f(this.value.templateItems,function(q,p){delete this.value.templateItems[p]},this);var o,n=ko.virtualElements.firstChild(this.element);while(n){o=n;n=ko.virtualElements.nextSibling(n);l.utils.html.cleanNode(o);l.bindings.bindingBase.getParentElement(o).removeChild(o)}this.value.__woBag.nodes.length=0};m.prototype.unRender=function(){if(!this.value){return}this.unTemplate();this.value.onUnrendered();if(this.value.__woBag.rootHtmlElement){l.utils.domData.set(this.value.__woBag.rootHtmlElement,l.bindings.wipeout.utils.wipeoutKey,undefined);delete this.value.__woBag.rootHtmlElement}if(this.templateChangedSubscription){this.value.disposeOf(this.templateChangedSubscription)}this.value.disposeOf(this.onDisposeEventSubscription);delete this.onDisposeEventSubscription;delete this.value;delete this.templateChangedSubscription};m.prototype.render=function(n){if(this.value||this.templateChangedSubscription){throw"This binding is already rendering a visual. Call unRender before rendering again."}if(!(this.value=n)){return}if(!(this.value instanceof l.base.visual)){throw"This binding can only be used to render a wo.visual within the context of a wo.visual"}if(this.value.__woBag.rootHtmlElement){throw"This visual has already been rendered. Call its unRender() function before rendering again."}l.utils.domData.set(this.element,l.bindings.wipeout.utils.wipeoutKey,this.value);this.value.__woBag.rootHtmlElement=this.element;var o=this.value.__woBag.disposed.register(this.unRender,this);this.onDisposeEventSubscription=this.value.registerDisposable(o);var p=this.value.templateId.subscribe(this.onTemplateChanged,this);this.templateChangedSubscription=this.value.registerDisposable(p);this.onTemplateChanged(this.value.templateId.peek())};m.prototype.onTemplateChanged=function(o){var n=this;function p(){if(n.value&&n.value.templateId.peek()!==o){return}n.doRendering()}this.unTemplate();if(o&&l.settings.asynchronousTemplates){ko.virtualElements.prepend(this.element,l.utils.html.createTemplatePlaceholder(this.value));l.template.asyncLoader.instance.load(o,p)}else{p()}};m.prototype.doRendering=function(){ko.bindingHandlers.template.update(this.element,l.bindings.render.createValueAccessor(this.value),this.allBindingsAccessor,null,this.bindingContext);var n=this.allBindingsAccessor();if(n["wipeout-type"]){l.bindings["wipeout-type"].utils.comment(this.element,n["wipeout-type"])}};m.init=function(q,r,n,s,p){var o=new l.bindings.render(q,r(),n,p);o.render(l.utils.ko.peek(r()));return o.bindingMeta};m.createValueAccessor=function(n){return function(){n=l.utils.ko.peek(n);if(!(n instanceof l.base.visual)){return{name:l.base.visual.getBlankTemplateId()}}var o={templateEngine:l.template.engine.instance,name:n.templateId.peek(),afterRender:function(q,p){var r=[];f(n.__woBag.nodes,function(s){r.push(s)});n.__woBag.nodes.length=0;f(q||[],function(s){n.__woBag.nodes.push(s)});n.onRendered(r,q)}};if(!n.shareParentScope){o.data=n}return o}};return m});c("wipeout-type",true,function(){var m="wipeout-type";return{init:function(){},utils:{comment:function(n,p){p=l.utils.ko.peek(p);if(n.nodeType===1){if(n.childNodes.length){n.insertBefore(document.createComment(p),n.childNodes[0])}else{n.appendChild(document.createComment(p))}}else{if(n.nodeType===8){var o;if(!(o=ko.utils.domData.get(n,m))){ko.utils.domData.set(n,m,o=n.textContent)}n.textContent=o+" wipeout-type: "+p}}}}}});c("wipeout",true,function(){var m=l.bindings.render.extend(function n(q,r,o,s,p){if(!(r instanceof Function)){throw"Invalid view type"}this.renderedView=new r();if(!(this.renderedView instanceof l.base.view)){throw"Invalid view type"}this._super(q,this.renderedView,o,p);if(this.renderedView.shareParentScope){throw"The root of an application cannot share its parents scope"}this.renderedView.model(s);this.render(this.renderedView);this.render=function(){throw"Cannont render this binding a second time, use the render binding instead"};this.renderedView.onApplicationInitialized()});m.prototype.dispose=function(){this._super();this.renderedView.dispose()};m.init=function(q,r,o,s,p){return new l.bindings.wipeout(q,r(),o,s,p).bindingMeta};m.utils={wipeoutKey:"__wipeout"};return m});c("wo",true,function(){var m=l.bindings.render.extend(function m(q,r,n,o){var s=m.create(r);this._super(q,s,n,o);s.__woBag.createdByWipeout=true;s._initialize(l.template.engine.xmlCache[r.initXml],o);if(r.id){var p=o;while(p.$data.shareParentScope){p=p.$parentContext}p.$data.templateItems[r.id]=s}this.render(s);this.render=function(){throw"Cannot render this binding a second time, use the render binding instead"}});m.prototype.dispose=function(){this.removeFromParentTemplateItems();var n=this.value;this._super();n.dispose()};m.prototype.removeFromParentTemplateItems=function(){if(this.parentElement&&this.value.id){l.bindings.wo.removeFromParentTemplateItems(this.parentElement,this.value.id)}};m.init=function(p,q,n,r,o){return new l.bindings.wo(p,q(),n,o).bindingMeta};m.removeFromParentTemplateItems=function(p,n){var o=l.utils.html.getViewModel(p);while(o&&o.shareParentScope){o=o.getParent()}if(o){return delete o.templateItems[n]}return false};m.create=function(n){if(!n.type){throw'Cannot create an instance of "'+n.name+'"'}return new n.type()};return m});d("wipeout.profile.highlightVM",function(){var m=l.base.object.extend(function m(o,n){this.vm=o;this.cssClass=n;this.nodes=o.entireViewModelHtml();l.utils.obj.enumerate(this.nodes,function(p){if(p.classList){p.classList.add(this.cssClass)}},this)});m.prototype.dispose=function(){l.utils.obj.enumerate(this.nodes,function(n){if(n.classList){n.classList.remove(this.cssClass)}},this)};return m});d("wipeout.profile.highlighter",function(){m.newId=(function(){var n=0;return function(){return ++n}})();m.generateColour=function(){var p=Math.floor((l.utils.obj.random(255)+255)/2);var o=Math.floor((l.utils.obj.random(255)+255)/2);var n=Math.floor((l.utils.obj.random(255)+255)/2);return p.toString(16)+o.toString(16)+n.toString(16)};function m(){this.style=document.createElement("style");this.index=0;this.styles=["wipeout-profiler-"+m.newId(),"wipeout-profiler-"+m.newId(),"wipeout-profiler-"+m.newId(),"wipeout-profiler-"+m.newId(),"wipeout-profiler-"+m.newId()];for(var o=0,p=this.styles.length;o<p;o++){this.style.innerHTML+=" ."+this.styles[o]+" {background-color:#"+m.generateColour()+" !important; cursor: pointer !important}"}document.head.appendChild(this.style);this.currentHighlighter={dispose:function(){}};var n=this;this.eventHandler=function(q){n.highlightVM(q)};window.addEventListener("mousemove",this.eventHandler,false)}m.prototype.nextStyle=function(){if(this.index>=this.styles.length-1){this.index=0}else{this.index++}return this.styles[this.index]};m.prototype.highlightVM=function(o){var p=document.elementFromPoint(o.clientX,o.clientY);if(p===this.currentElement){return}this.currentElement=p;var r=l.utils.html.getViewModel(this.currentElement);if(!r||r===this.currentHighlighter.vm){return}var q=this.__timeoutToken={};var n=this;setTimeout(function(){if(n.__timeoutToken!==q){return}n.currentHighlighter.dispose();n.currentHighlighter=new l.profile.highlightVM(r,n.nextStyle())},100)};m.prototype.dispose=function(){if(this.style.parentElement){this.style.parentElement.removeChild(this.style)}delete this.__timeoutToken;window.removeEventListener("mousemove",this.eventHandler);this.currentHighlighter.dispose()};return m});d("wipeout.profile.profile",function(){var o,m,s,r;var q=function q(u){if(arguments.length===0){u=true}if((u&&r)||(!u&&!r)){return}o=o||l.bindings.render.prototype.doRendering;m=m||l.base.view.prototype._initialize;s=s||l.template.engine.prototype.rewriteTemplate;if(u){r={highlighter:new l.profile.highlighter(),infoBox:l.utils.html.createElement('<div style="position: fixed; top: 10px; right: 10px; background-color: white; padding: 10px; border: 2px solid gray; display: none; max-height: 500px; overflow-y: scroll; z-index: 10000"></div>'),eventHandler:function(v){if(!v.ctrlKey){return}v.stopPropagation();v.preventDefault();var z=wo.html.getViewModel(v.target);if(!z){return}var A=z.getParents();A.splice(0,0,z);r.infoBox.innerHTML='<span style="float: right; margin-left: 10px; cursor: pointer;">x</span><br/>Open a console window and click on a class to debug it<br/>If view models do not have names, you can <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/name">name them</a><br/>If view models have odd names ensure you are not using a minifier';r.infoBox.firstChild.addEventListener("click",function(){r.infoBox.style.display="none"});var w=[];for(var x=0,y=A.length;x<y;x++){r.infoBox.appendChild(n(A[x]).element)}r.infoBox.style.display="block"},dispose:function(){r.highlighter.dispose();if(r.infoBox.parentElement){r.infoBox.parentElement.removeChild(r.infoBox)}document.body.removeEventListener("click",r.eventHandler);l.bindings.render.prototype.doRendering=o;l.base.view.prototype._initialize=m;l.template.engine.prototype.rewriteTemplate=s}};l.bindings.render.prototype.doRendering=function(){var v=new Date();o.apply(this,arguments);var x=new Date()-v;if(!this.value.__woBag.profiler){this.value.__woBag.profiler={}}this.value.__woBag.profiler["Render time"]=x;var w=document.getElementById(this.value.templateId());if(w){this.value.__woBag.profiler["Template compile time"]=l.utils.domData.get(w,"rewriteTemplateTime")}};l.base.view.prototype._initialize=function(){var v=new Date();m.apply(this,arguments);var w=new Date()-v;if(!this.__woBag.profiler){this.__woBag.profiler={}}this.__woBag.profiler["Initialize time"]=w};l.template.engine.prototype.rewriteTemplate=function(y){var v=new Date();s.apply(this,arguments);var z=new Date()-v;var x=document.getElementById(y);if(x instanceof HTMLElement){var w=l.utils.domData.get(x,"rewriteTemplateTime");if(w instanceof Number){z+=w}l.utils.domData.set(x,"rewriteTemplateTime",z)}};document.body.appendChild(r.infoBox);document.body.addEventListener("click",r.eventHandler,false)}else{r.dispose();r=null}return};var t=new Function("viewModel","model","//Use your browser's debugger to inspect the model and view model\ndebugger;");var p=/^function\s*([^\s(]+)/;var n=function(A){var u=document.createElement("div");l.utils.domData.set(u,l.bindings.wipeout.utils.wipeoutKey,A);var z;var v=A.constructor.name?A.constructor.name:((z=A.constructor.toString().match(p))?z[1]:"unknown vm type");var x=["<h4 style='cursor: pointer; margin-bottom: 5px;'>"+v+(A.id?(" #"+A.id):"")+"</h4>"];if(A.__woBag.profiler){for(var w in A.__woBag.profiler){x.push("<label>"+w+":</label> "+A.__woBag.profiler[w])}}u.innerHTML+=x.join("<br />");function y(){t(A,A.model())}u.firstChild.addEventListener("click",y,false);return{element:u,dispsoe:function(){u.firstChild.removeEventListener("click",y);l.utils.domData.clear(u)}}};return q});d("wipeout.template.asyncLoader",function(){var m=function m(){this.pending={}};m.prototype.load=function(p,o){if(!this.pending[p]){this.pending[p]=new n(p)}this.pending[p].add(o||function(){})};function n(p){this._success=l.base.contentControl.templateExists(p);this._callbacks=this._success?null:[];this.templateName=p;if(!this._success){var o=this;l.utils.obj.ajax({type:"GET",url:p,success:function(t){l.base.contentControl.createTemplate(p,t.responseText);o._success=true;var q=o._callbacks;delete o._callbacks;for(var r=0,s=q.length;r<s;r++){q[r]()}},error:function(){delete o._callbacks;o._success=false;throw'Could not locate template "'+p+'"'}})}}n.prototype.add=function(o){if(this._callbacks){this._callbacks.push(o)}else{if(this._success){o()}else{throw'Could not load template "'+this.templateName+'"'}}};m.instance=new m();return m});d("wipeout.template.engine",function(){var p=function p(){};p.prototype=new ko.templateEngine();var n=/\$find/;var m=/\$call/;var o=/\$findAndCall/;p.createJavaScriptEvaluatorFunction=function(u){var s=n.test(u)?"\n\tvar $find = wipeout.utils.find.create(bindingContext);":"";var t=o.test(u)?"\n\tvar $findAndCall = wipeout.utils.findAndCall.create($find);":"";var r=m.test(u)?"\n\tvar $call = wipeout.utils.call.create();":"";return new Function("bindingContext","with(bindingContext) {"+s+t+r+"\n\twith($data) {\n\t\treturn "+u+";\n\t}\n}")};p.createJavaScriptEvaluatorBlock=function(r){var s=p.newScriptId();if(r instanceof Function){p.scriptCache[s]=r}else{p.scriptCache[s]=p.createJavaScriptEvaluatorFunction(r)}return p.openCodeTag+s+p.closeCodeTag};p.prototype.createJavaScriptEvaluatorBlock=function(r){return p.createJavaScriptEvaluatorBlock(r)};p.prototype.rewriteTemplate=function(t,r,u){var s=document.getElementById(t);if(s instanceof HTMLElement){if(!p.scriptHasBeenReWritten.test(s.textContent)){ko.templateEngine.prototype.rewriteTemplate.call(this,t,r,u)}else{this.makeTemplateSource(t,u).data("isRewritten",true)}this.wipeoutRewrite(s,r)}else{ko.templateEngine.prototype.rewriteTemplate.call(this,t,r,u)}};p.wipeoutRewrite=function(y,w){if(l.base.visual.reservedTags[y.nodeName]){for(var r=0;r<y.childNodes.length;r++){if(y.childNodes[r].nodeType===1){p.wipeoutRewrite(y.childNodes[r],w)}}}else{var t=p.newScriptId();p.xmlCache[t]=y;var x="<!-- ko";if(e){x+=" wipeout-type: '"+y.nodeName+"',"}var s=p.getId(y);if(s){s="'"+s+"'"}x+=" wo: { type: "+y.nodeName+", id: "+s+", name: '"+y.nodeName+"', initXml: '"+t+"'} --><!-- /ko -->";var v=l.utils.html.parseXml("<root>"+w(x)+"</root>");while(v.childNodes.length){var u=v.childNodes[0];u.parentNode.removeChild(u);y.parentNode.insertBefore(u,y)}y.parentNode.removeChild(y)}};p.getId=function(t){for(var r=0,s=t.attributes.length;r<s;r++){if(t.attributes[r].nodeName==="id"){return t.attributes[r].value}}return null};p.prototype.wipeoutRewrite=function(t,s){var v=new XMLSerializer();var w=l.utils.html.parseXml("<root>"+t.textContent+"</root>");var u=[];for(var r=0;r<w.childNodes.length;r++){if(w.childNodes[r].nodeType===1){p.wipeoutRewrite(w.childNodes[r],s)}u.push(v.serializeToString(w.childNodes[r]))}t.textContent=u.join("")};p.prototype.renderTemplateSource=function(v,r,t){if(!(r.$data instanceof l.base.view)){return[]}var s=v.data("precompiled");if(!s){s=new l.template.htmlBuilder(v.text());v.data("precompiled",s)}var u;ko.dependentObservable(function(){u=s.render(r)},this).dispose();return u};if(e){var q=function(r){p.prototype[r]=function(){ko.templateEngine.prototype[r].apply(this,arguments)}};q("isTemplateRewritten");q("makeTemplateSource");q("renderTemplate")}p.newScriptId=(function(){var r=Math.floor(Math.random()*10000);return function(){return(++r).toString()}})();p.xmlCache={};p.scriptCache={};p.openCodeTag="<!-- wipeout_code: {";p.closeCodeTag="} -->";p.scriptHasBeenReWritten=RegExp(p.openCodeTag.replace("{","{")+"[0-9]+"+p.closeCodeTag.replace("}","}"));p.instance=new p();return p});d("wipeout.template.htmlBuilder",function(){var m=function m(n){this.preRendered=[];this.generatePreRender(n)};m.prototype.render=function(n){var o=[];var t=[];for(var q=0,r=this.preRendered.length;q<r;q++){if(this.preRendered[q] instanceof Function){var s=this.preRendered[q](n);t.push(s)}else{t.push(this.preRendered[q])}}var p=l.utils.html.createElements(t.join(""));f(m.getTemplateIds({childNodes:p}),function(v,u){n.$data.templateItems[u]=v});if(n.$data instanceof l.base.view){n.$data.onInitialized()}return p};m.prototype.generatePreRender=function(s){var t=l.utils.html.parseXml("<root>"+s+"</root>");var r=l.template.htmlBuilder.generateTemplate(t);var p=l.template.engine.openCodeTag;var n=l.template.engine.closeCodeTag;this.preRendered.length=0;var q,o;while((q=r.indexOf(p))!==-1){this.preRendered.push(r.substr(0,q));r=r.substr(q);o=r.indexOf(n);if(o===-1){throw"Invalid wipeout_code tag."}this.preRendered.push((function(u){return l.template.engine.scriptCache[u]})(r.substr(p.length,o-p.length)));r=r.substr(o+n.length)}this.preRendered.push(r)};m.getTemplateIds=function(n){var o={};f(n.childNodes,function(r){if(r.nodeType===1){for(var p=0,q=r.attributes.length;p<q;p++){if(r.attributes[p].nodeName==="id"){o[r.attributes[p].nodeValue]=r;break}}f(m.getTemplateIds(r),function(s,t){o[t]=s})}});return o};m.generateTemplate=function(p){var n=[];var o=new XMLSerializer();f(p.childNodes,function(r){if(r.nodeType==1){var q=l.utils.html.parseXml(o.serializeToString(r));while(q.childNodes.length){q.removeChild(q.childNodes[0])}var s=l.utils.html.createElement(o.serializeToString(q));s.innerHTML=l.template.htmlBuilder.generateTemplate(r);n.push(l.utils.html.outerHTML(s))}else{if(r.nodeType===3){n.push(r.data)}else{n.push(o.serializeToString(r))}}});return n.join("")};return m});d("wipeout.utils.bindingDomManipulationWorker",function(){var m=l.utils.domManipulationWorkerBase.extend(function m(){this._super()});m.prototype.finish=function(){f(l.bindings.bindingBase.registered,function(n){if(n.checkHasMoved()&&this._mutations.indexOf(n.element)===-1){this._mutations.push(n.element)}},this);this._super()};return m});d("wipeout.utils.call",function(){var m=l.base.object.extend(function m(){this._super()});m.prototype.call=function(q){if(!q){throw"Could not find an object to call function on."}var o=[];var n=null;var p=function(){var s=q;var t=null;if(o.length>0){for(var u=0,v=o.length-1;u<v&&s;u++){s=ko.utils.unwrapObservable(s[o[u]])}if(!s){var w="Could not find the object "+o[u-1]}if(!s[o[u]]){throw'Could not find function :"'+o[u]+'" on this object.'}t=s[o[u]]}else{if(q.constructor!==Function){throw"Cannot call an object like a function"}t=q}if(n){var r=l.utils.obj.copyArray(n);f(arguments,function(x){r.push(x)});return t.apply(s,r)}else{return t.apply(s,arguments)}};p.dot=function(r){o.push(r);return p};p.args=function(){n=l.utils.obj.copyArray(arguments);return p};return p};m.create=function(){var n=new l.utils.call();return function(o){return n.call(o)}};return m});d("wipeout.utils.domData",function(){var n="__wipeout_domData";function m(){}function o(p){if(!p){throw"Invalid html element"}return p[n]=p[n]||{}}m.get=function(p,q){return arguments.length>1?o(p)[q]:o(p)};m.set=function(p,q,r){return o(p)[q]=r};m.clear=function(p,q){if(q){delete o(p)[q]}else{delete p[n]}};return m});d("wipeout.utils.find",function(){var m=l.base.object.extend(function m(n){this._super();this.bindingContext=n});m.prototype.find=function(q,n){var r={};if(n){for(var p in n){r[p]=n[p]}}n=r;if(!n.$number){n.$number=0}if(q&&q.constructor===Function){n.$instanceOf=q}else{if(q&&q.constructor!==String){for(var p in q){n[p]=q[p]}}else{n.$ancestry=l.utils.obj.trim(q)}}if(!n.$number&&n.$n){n.$number=n.$n}if(!n.$instanceOf&&n.$i){n.$instanceOf=n.$i}if(!n.$instanceOf&&n.$instanceof){n.$instanceOf=n.$instanceof}if(!n.$ancestry&&n.$a){n.$ancestry=n.$a}if(!n.$type&&n.$t){n.$type=n.$t}var o=n.$m||n.$model;delete n.$m;delete n.$model;delete n.$n;delete n.$instanceof;delete n.$i;delete n.$a;delete n.$t;return this._find(n,o)};m.prototype._find=function(p,r){if(!this.bindingContext||!this.bindingContext.$parentContext){return null}var q=r?function(u){return u&&u.$data instanceof wo.view?u.$data.model():null}:function(u){return u?u.$data:null};var o,n=this.bindingContext;for(var t=p.$number;t>=0&&n;t--){var s=0;n=n.$parentContext;while(!l.utils.find.is(o=q(n),p,s)&&n){n=n.$parentContext;s++}}return o};m.create=function(n){var o=new l.utils.find(n);return function(q,p){return o.find(q,p)}};m.regex={ancestors:/^(great)*(grand){0,1}parent$/,great:/great/g,grand:/grand/g};m.$type=function(n,p,o){return n&&n.constructor===p};m.$ancestry=function(n,q,p){q=(q||"").toLowerCase();if(q.indexOf("greatparent")!==-1){return false}var r=0;var o=q.match(l.utils.find.regex.great);if(o){r+=o.length}o=q.match(l.utils.find.regex.grand);if(o){r+=o.length}return r===p};m.$instanceOf=function(n,p,o){if(!n||!p||p.constructor!==Function){return false}return n instanceof p};m.is=function(q,n,p){if(!q){return false}for(var o in n){if(o==="$number"){continue}if(o[0]==="$"){if(!l.utils.find[o](q,n[o],p)){return false}}else{if(ko.utils.unwrapObservable(n[o])!==ko.utils.unwrapObservable(q[o])){return false}}}return true};return m});d("wipeout.utils.findAndCall",function(){var n=l.utils.call.extend(function m(o){this._super();this.find=o});n.prototype.call=function(p,o){return this._super(this.find(p,o))};n.create=function(p){var o=new l.utils.findAndCall(p);return function(r,q){return o.call(r,q)}};return n});d("wipeout.utils.html",function(){var A=function(I){if(!I){return null}if(I.constructor===HTMLHtmlElement){throw"Cannot serialize a Html element using outerHTML"}var J=I.nodeType===1?(E[I.tagName.toLowerCase()]||"div"):"div";var H=document.createElement(J);H.appendChild(I.cloneNode(true));return H.innerHTML};var G=/[a-zA-Z0-9]/;var v=function(J){J=J.replace(/^\s+|\s+$/g,"");if(!J||J[0]!=="<"){throw"Invalid html tag"}J=J.substring(1).replace(/^\s+|\s+$/g,"");for(var H=0,I=J.length;H<I;H++){if(!G.test(J[H])){break}}return J.substring(0,H)};var F=/<\!--[^>]*-->/g;var u=function(H){H=H.replace(F,"").replace(/^\s+|\s+$/g,"");var I=0;if((I=H.indexOf("<"))===-1){return null}return v(H.substring(I))};var E={area:"map",base:"head",basefont:"head",body:"html",caption:"table",col:"colgroup",colgroup:"table",command:"menu",frame:"frameset",frameset:"html",head:"html",keygen:"form",li:"ul",optgroup:"select",option:"select",rp:"rt",rt:"ruby",source:"audio",tbody:"table",td:"tr",tfoot:"table",th:"tr",thead:"table",tr:"tbody"};var m={html:true,basefont:true,base:true,body:true,frame:true,frameset:true,head:true};function s(L,I){for(var J=0,K=L.childNodes.length;J<K;J++){var H=L.childNodes[J];if(H.nodeType===1&&l.utils.obj.trimToLower(H.tagName)===l.utils.obj.trimToLower(I)){return H}}}var y={audio:true,col:true,colgroup:true,frameset:true,head:true,rp:true,rt:true,ruby:true,select:true,style:true,table:true,tbody:true,tfooy:true,thead:true,title:true,tr:true};var D={keygen:"select"};var o=function(I){var L=l.utils.obj.trimToLower(v(I));if(m[L]){throw'Cannot create an instance of the "'+L+'" tag.'}var K=E[L]||"div";if(ko.utils.ieVersion&&y[K]){return s(o("<"+K+">"+I+"</"+K+">"),L)}var J=document.createElement(K);J.innerHTML=I;function H(P){if(!P){return null}for(var N=0,O=J.childNodes.length;N<O;N++){if(J.childNodes[N].nodeType===1&&J.childNodes[N].tagName.toLowerCase()===P){var M=J.childNodes[N];J.removeChild(M);return M}}return null}return H(L)||H(D[L])};var p=function(I){if(I==null){return[]}var L=u(I)||"div";var K=E[v("<"+L+"/>")]||"div";I="<"+L+"></"+L+">"+I+"<"+L+"></"+L+">";var H=document.createElement(K);H.innerHTML=I;var J=[];while(H.firstChild){J.push(H.firstChild);H.removeChild(H.firstChild)}J.splice(0,1);J.splice(J.length-1,1);return J};var t=function(J){var H=[];if(l.utils.ko.isVirtual(J)){var N=l.utils.ko.parentElement(J);for(var K=0,L=N.childNodes.length;K<L;K++){if(N.childNodes[K]===J){break}}K++;for(var L=N.childNodes.length;K<L;K++){H.push(N.childNodes[K])}}else{H=J.childNodes}var M=[];var I=0;for(var K=0,L=H.length;K<L;K++){if(l.utils.ko.isVirtualClosing(H[K])){I--;if(I<0){return M}continue}if(I>0){continue}M.push(H[K]);if(l.utils.ko.isVirtual(H[K])){I++}}return M};var w=function(H){var J=l.utils.domData.get(H,l.bindings.wipeout.utils.wipeoutKey);if(J){return J}var I=l.utils.ko.parentElement(H);if(I){return w(I)}return null};var q=function(H){return o("<span>Loading template</span>")};var z=function(H){l.template.asyncLoader.instance.load(H)};var n=function(K){var H=l.utils.domData.get(K,l.bindings.bindingBase.dataKey);var J=false;f(H,function(L){J|=L.bindingMeta.controlsDescendantBindings});if(!J){var I=ko.virtualElements.firstChild(K);while(I){n(I);I=ko.virtualElements.nextSibling(I)}}f(H,function(L){L.dispose()});l.utils.domData.clear(K,l.bindings.bindingBase.dataKey);ko.cleanNode(K)};var x=function x(H){l.utils.htmlAsync(function(I){H();I()})};try{var B=new DOMParser().parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(r){}var C=function(H){var I=new DOMParser().parseFromString(H,"application/xml");if(I.getElementsByTagNameNS(B,"parsererror").length){throw"Invalid xml template:\n"+new XMLSerializer().serializeToString(I.firstChild)}return I.documentElement};x.parseXml=C;x.cleanNode=n;x.cannotCreateTags=m;x.createTemplatePlaceholder=q;x.specialTags=E;x.getFirstTagName=u;x.getTagName=v;x.getAllChildren=t;x.outerHTML=A;x.createElement=o;x.createElements=p;x.getViewModel=w;return x});d("wipeout.utils.htmlAsync",function(){var m=(function(){var o=[];var q=[];var s=null;function r(){if(s||!o.length){return}s=window.MutationObserver?new l.utils.mutationObserverDomManipulationWorker():new l.utils.bindingDomManipulationWorker();var t=function(){if(t===null){return}t=null;setTimeout(function(){p()},1)};o.splice(0,1)[0](t);setTimeout(function(){if(!t){return}if(!l.settings.suppressWarnings){console.error("Cleanup callback for async move method was not called. Cleanup has been automatically called, which may cause undesired behaviour.")}t()},l.settings.htmlAsyncTimeout>0?l.settings.htmlAsyncTimeout:10000)}function p(){s.finish();s=null;r()}return{add:function(t){o.push(t);r()}}}());var n=function n(o){if(!(o instanceof Function)){throw"Invalid move functionality"}m.add(o)};return n});d("wipeout.utils.ko",function(){var m=function m(){};m.version=function(){if(!ko||!ko.version){return null}var s=ko.version.split(".");for(var q=0,r=s.length;q<r;q++){s[q]=parseInt(s[q])}return s};m.peek=function(q){if(ko.isObservable(q)){return q.peek()}else{return q}};m.array={diff:{added:"added",deleted:"deleted",retained:"retained"}};m.parentElement=function(s){var r=0;var q=s.previousSibling;while(q){if(m.isVirtual(q)){if(r<0){r++}else{return q}}else{if(m.isVirtualClosing(q)){r--}}q=q.previousSibling}return s.parentNode};var n=document&&document.createComment("test").text==="<!--test-->";var p=n?/^<!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*-->$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/;var o=n?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/;m.isVirtual=function(q){return q&&(q.nodeType==8)&&(n?q.text:q.nodeValue).match(p)};m.isVirtualClosing=function(q){return q&&(q.nodeType==8)&&(n?q.text:q.nodeValue).match(o)};m.getClosingTag=function(r){if(!m.isVirtual(r)){throw"Invalid virtual element"}var q=1;while(r&&q>0){r=r.nextSibling;if(m.isVirtual(r)){q++}if(m.isVirtualClosing(r)){q--}}if(!r){throw"Could not find closing tag for element."}return r};m.enumerateOverChildren=function(r,q){r=ko.virtualElements.firstChild(r);while(r){q(r);r=ko.virtualElements.nextSibling(r)}};return m});d("wipeout.utils.mutationObserverDomManipulationWorker",function(){var m=l.utils.domManipulationWorkerBase.extend(function m(){this._super();var n=this;this._observer=new MutationObserver(function(o){n.appendRemovedNodes(o)});this._observer.observe(document.body,{childList:true,subtree:true})});m.prototype.appendRemovedNodes=function(n){f(n,function(o){f(o.removedNodes,function(p){if(this._mutations.indexOf(p)===-1){this._mutations.push(p)}},this)},this)};m.prototype.finish=function(){this._observer.disconnect();delete this._observer;this._super()};return m});window.wipeout=l;window.wo={};f(l.base,function(n,m){window.wo[m]=n});f(l.utils,function(n,m){window.wo[m]=n});var e=wo.DEBUG=false})();