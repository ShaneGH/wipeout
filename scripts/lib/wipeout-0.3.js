(function(){var wpfko={};var enumerate=function(enumerate,action,context){context=context||window;if(enumerate==null){return}if(enumerate instanceof Array||enumerate instanceof HTMLCollection||enumerate instanceof NodeList||enumerate instanceof NamedNodeMap){for(var i=0,ii=enumerate.length;i<ii;i++){action.call(context,enumerate[i],i)}}else{for(var i in enumerate){action.call(context,enumerate[i],i)}}};var enumerateDesc=function(enumerate,action,context){context=context||window;if(enumerate==null){return}if(enumerate instanceof Array||enumerate instanceof HTMLCollection||enumerate instanceof NodeList||enumerate instanceof NamedNodeMap){for(var i=enumerate.length-1;i>=0;i--){action.call(context,enumerate[i],i)}}else{var props=[];for(var i in enumerate){props.push(i)}for(var i=props.length-1;i>=0;i--){action.call(context,enumerate[props[i]],props[i])}}};var Binding=function(bindingName,allowVirtual,accessorFunction){var cls=Class("wpfko.bindings."+bindingName,accessorFunction);ko.bindingHandlers[bindingName]={init:cls.init,update:cls.update};if(allowVirtual){ko.virtualElements.allowedBindings[bindingName]=true}};var Class=function(classFullName,accessorFunction){classFullName=classFullName.split(".");var namespace=classFullName.splice(0,classFullName.length-1);var tmp={};tmp[classFullName[classFullName.length-1]]=accessorFunction();Extend(namespace.join("."),tmp);return tmp[classFullName[classFullName.length-1]]};var Extend=function(namespace,extendWith){namespace=namespace.split(".");if(namespace[0]!=="wpfko"){throw'Root must be "wpfko".'}namespace.splice(0,1);var current=wpfko;enumerate(namespace,function(nsPart){current=current[nsPart]||(current[nsPart]={})});if(extendWith&&extendWith instanceof Function){extendWith=extendWith()}enumerate(extendWith,function(item,i){current[i]=item})};var _trimString=/^\s+|\s+$/g;var trim=function(string){return string?string.replace(_trimString,""):string};var trimToLower=function(string){return string?trim(string).toLowerCase():string};var parseBool=function(input){if(input==null){return false}input=trimToLower(input);return input&&input!=="false"&&input!=="0"};Class("wpfko.utils.obj",function(){var createObject=function(constructorString,context){if(!context){context=window}var constructor=constructorString.split(".");for(var i=0,ii=constructor.length;i<ii;i++){context=context[constructor[i]];if(!context){throw'Cannot create object "'+constructorString+'"'}}if(context instanceof Function){return new context()}else{throw constructorString+" is not a valid function."}};var copyArray=function(input){var output=[];for(var i=0,ii=input.length;i<ii;i++){output.push(input[i])}return output};return{parseBool:parseBool,trimToLower:trimToLower,trim:trim,enumerate:enumerate,enumerateDesc:enumerateDesc,createObject:createObject,copyArray:copyArray}});Class("wpfko.util.obj",function(){return wpfko.utils.obj});Class("wpfko.base.object",function(){var object=function(){};var cachedSuperMethods={parents:[],children:[]};object.clearVirtualCache=function(forMethod){if(!forMethod){cachedSuperMethods.parents.length=0;cachedSuperMethods.children.length=0;return}for(var i=0,ii=cachedSuperMethods.children.length;i<ii;i++){if(cachedSuperMethods.children[i]===forMethod||cachedSuperMethods.parents[i]===forMethod){cachedSuperMethods.children.splice(i,1);cachedSuperMethods.parents.splice(i,1)}}};object.useVirtualCache=true;object.prototype._super=function(){var cached=null;if(object.useVirtualCache){var superIndex=cachedSuperMethods.children.indexOf(arguments.callee.caller);if(superIndex!==-1){cached=cachedSuperMethods.parents[superIndex]}}if(!cached){var inheritanceTree=[];var current=this.constructor.prototype;while(current){inheritanceTree.push(current);current=Object.getPrototypeOf(current)}inheritanceTree.reverse();for(var i=0,ii=inheritanceTree.length;i<ii;i++){if(inheritanceTree[i]===arguments.callee.caller.prototype){cached=inheritanceTree[i-1].constructor}else{for(var method in inheritanceTree[i]){if(inheritanceTree[i][method]===arguments.callee.caller){for(var j=i-1;j>=0;j--){if(inheritanceTree[j][method]!==arguments.callee.caller){cached=inheritanceTree[j][method];break}}}if(cached){break}}}if(cached){if(object.useVirtualCache){cachedSuperMethods.children.push(arguments.callee.caller);cachedSuperMethods.parents.push(cached)}break}}if(!cached){throw"Could not find method in parent class"}}return cached.apply(this,arguments)};var validFunctionCharacters=/^[a-zA-Z_][a-zA-Z_]*$/;object.extend=function(childClass,className){for(var p in this){if(this.hasOwnProperty(p)&&this[p]&&this[p].constructor===Function){childClass[p]=this[p]}}if(className){if(!validFunctionCharacters.test(className)){throw"Invalid class name. The class name is for debug purposes and can contain alphanumeric characters only"}eval("            function "+className+"() { this.constructor = childClass; }            "+className+".prototype = this.prototype;            childClass.prototype = new "+className+"();")}else{function prototypeTracker(){this.constructor=childClass}prototypeTracker.prototype=this.prototype;childClass.prototype=new prototypeTracker()}return childClass};return object});Class("wpfko.base.visual",function(){var visual=wpfko.base.object.extend(function(templateId){this._super();this.woInvisible=this.constructor.woInvisibleDefault;this.__createdByWipeout=false;this.templateItems={};this.renderedChildren=[];this._rootHtmlElement=null;this._routedEventSubscriptions=[];this.templateId=ko.observable(templateId||visual.getDefaultTemplateId());this.__woBag={disposables:{}}},"visual");visual.woInvisibleDefault=false;visual.prototype.disposeOf=function(key){if(this.__woBag.disposables[key]){this.__woBag.disposables[key]();delete this.__woBag.disposables[key]}};visual.prototype.disposeOfAll=function(){for(var i in this.__woBag.disposables){this.disposeOf(i)}};visual.prototype.registerDisposable=(function(){var i=0;return function(disposeFunction){if(!disposeFunction||disposeFunction.constructor!==Function){throw"The dispose function must be a Function"}var id=(++i).toString();this.__woBag.disposables[id]=disposeFunction;return id}})();visual.prototype.unTemplate=function(){enumerate(this.renderedChildren.splice(0,this.renderedChildren.length),function(child){if(child instanceof visual){if(child.__createdByWipeout){child.dispose()}else{child.unRender()}}});enumerate(this.templateItems,function(item,i){delete this.templateItems[i]},this);if(this._rootHtmlElement){ko.virtualElements.emptyNode(this._rootHtmlElement)}};visual.prototype.unRender=function(){this.onUnrender();this.unTemplate();if(this._rootHtmlElement){ko.utils.domData.set(this._rootHtmlElement,wpfko.bindings.wpfko.utils.wpfkoKey,undefined);delete this._rootHtmlElement}};visual.prototype.dispose=function(){this.unRender();for(var i in this){if(ko.isObservable(this[i])&&this[i].dispose instanceof Function){this[i].dispose()}}enumerate(this._routedEventSubscriptions.splice(0,this._routedEventSubscriptions.length),function(event){event.dispose()})};visual.getParentElement=function(element){var depth=0;var current=element.previousSibling;while(current){if(wpfko.utils.ko.virtualElements.isVirtualClosing(current)){depth--}if(wpfko.utils.ko.virtualElements.isVirtual(current)){if(depth===0){return current}depth++}current=current.previousSibling}return element.parentElement};visual.prototype.getParents=function(){var current=this;var parents=[];while(current){parents.push(current);current=current.getParent()}return parents};visual.prototype.getParent=function(){var nextTarget;var current=visual.getParentElement(this._rootHtmlElement);while(current){if(nextTarget=ko.utils.domData.get(current,wpfko.bindings.wpfko.utils.wpfkoKey)){return nextTarget}current=visual.getParentElement(current)}};visual.prototype.unRegisterRoutedEvent=function(routedEvent,callback,callbackContext){for(var i=0,ii=this._routedEventSubscriptions.length;i<ii;i++){if(this._routedEventSubscriptions[i].routedEvent===routedEvent){this._routedEventSubscriptions[i].event.unRegister(callback,context);return}}};visual.prototype.registerRoutedEvent=function(routedEvent,callback,callbackContext){var rev;for(var i=0,ii=this._routedEventSubscriptions.length;i<ii;i++){if(this._routedEventSubscriptions[i].routedEvent===routedEvent){rev=this._routedEventSubscriptions[i];break}}if(!rev){rev=new wpfko.base.routedEventRegistration(routedEvent);this._routedEventSubscriptions.push(rev)}rev.event.register(callback,callbackContext)};visual.prototype.triggerRoutedEvent=function(routedEvent,eventArgs){if(!(eventArgs instanceof wpfko.base.routedEventArgs)){eventArgs=new wpfko.base.routedEventArgs(eventArgs,this)}for(var i=0,ii=this._routedEventSubscriptions.length;i<ii;i++){if(eventArgs.handled){return}if(this._routedEventSubscriptions[i].routedEvent===routedEvent){this._routedEventSubscriptions[i].event.trigger(eventArgs)}}if(!eventArgs.handled){var nextTarget=this.getParent();if(nextTarget){nextTarget.triggerRoutedEvent(routedEvent,eventArgs)}}};visual.prototype.rootHtmlChanged=function(oldValue,newValue){};visual.prototype.onUnrender=function(){};visual.prototype.applicationInitialized=function(){};visual.getDefaultTemplateId=(function(){var templateId=null;return function(){if(!templateId){templateId=wpfko.base.contentControl.createAnonymousTemplate("<span>No template has been specified</span>")}return templateId}})();visual.getBlankTemplateId=(function(){var templateId=null;return function(){if(!templateId){templateId=wpfko.base.contentControl.createAnonymousTemplate("")}return templateId}})();visual.visualGraph=function(rootElement,displayFunction){if(!rootElement){return[]}displayFunction=displayFunction||function(){return typeof arguments[0]};var output=[];wpfko.utils.obj.enumerate(wpfko.utils.html.getAllChildren(rootElement),function(child){wpfko.utils.obj.enumerate(visual.visualGraph(child),output.push,output)});var vm=ko.utils.domData.get(rootElement,wpfko.bindings.wpfko.utils.wpfkoKey);if(vm){return[{viewModel:vm,display:displayFunction(vm),children:output}]}return output};visual.reservedTags=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","head","header","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"];return visual});Class("wpfko.base.view",function(){var modelRoutedEventKey="wo.view.modelRoutedEvents";var view=wpfko.base.visual.extend(function(templateId,model){this._super(templateId);this.model=ko.observable(model||null);var model=null;this.registerDisposable(this.model.subscribe(function(newVal){try{this.modelChanged(model,newVal)}finally{model=newVal}},this).dispose);var _this=this;this._bindings={}},"view");var setObservable=function(obj,property,value){if(ko.isObservable(obj[property])){obj[property](ko.utils.unwrapObservable(value))}else{obj[property]=ko.utils.unwrapObservable(value)}};view.prototype.disposeOfBinding=function(propertyName){if(this._bindings[propertyName]){this._bindings[propertyName].dispose();delete this._bindings[propertyName]}};view.prototype.dispose=function(){this._super();if(this.__woBag[modelRoutedEventKey]){this.__woBag[modelRoutedEventKey].dispose();delete this.__woBag[modelRoutedEventKey]}for(var i in this._bindings){this.disposeOfBinding(i)}};view.prototype.onInitialized=function(){};view.prototype.bind=function(property,valueAccessor,twoWay){if(twoWay&&(!ko.isObservable(this[property])||!ko.isObservable(valueAccessor()))){throw"Two way bindings must be between 2 observables"}this.disposeOfBinding(property);var toBind=ko.dependentObservable({read:function(){return ko.utils.unwrapObservable(valueAccessor())},write:twoWay?function(){var va=valueAccessor();if(va){va(arguments[0])}}:undefined});setObservable(this,property,toBind.peek());var subscription1=toBind.subscribe(function(newVal){setObservable(this,property,newVal)},this);var subscription2=twoWay?this[property].subscribe(function(newVal){setObservable({x:toBind},"x",newVal)},this):null;this._bindings[property]={dispose:function(){if(subscription1){subscription1.dispose();subscription1=null}if(subscription2){subscription2.dispose();subscription2=null}if(toBind){toBind.dispose();toBind=null}}}};view.elementHasModelBinding=function(element){for(var i=0,ii=element.attributes.length;i<ii;i++){if(element.attributes[i].nodeName==="model"||element.attributes[i].nodeName==="model-tw"){return true}}for(var i=0,ii=element.childNodes.length;i<ii;i++){if(element.childNodes[i].nodeType===1&&element.childNodes[i].nodeName==="model"){return true}}return false};view.reservedPropertyNames=["constructor","constructor-tw","id","id-tw"];view.prototype.initialize=function(propertiesXml,parentBindingContext){if(this._initialized){throw"Cannot call initialize item twice"}this._initialized=true;if(!propertiesXml){return}var prop=propertiesXml.getAttribute("woInvisible");if(prop){this.woInvisible=parseBool(prop)}if(!view.elementHasModelBinding(propertiesXml)&&wpfko.utils.ko.peek(this.model)==null){this.bind("model",parentBindingContext.$data.model)}var bindingContext=this.woInvisible?parentBindingContext:parentBindingContext.createChildContext(this);enumerate(propertiesXml.attributes,function(attr){if(view.reservedPropertyNames.indexOf(attr.nodeName)!==-1){return}var name=attr.nodeName,setter="";if(name.indexOf("-tw")===attr.nodeName.length-3){name=name.substr(0,name.length-3);setter=",\n\t\t\tfunction(val) {\n\t\t\t\tif(!ko.isObservable("+attr.value+"))\n\t\t\t\t\tthrow 'Two way bindings must be between 2 observables';\n\t\t\t\t"+attr.value+"(val);\n\t\t\t}"}try{bindingContext.__$woCurrent=this;wpfko.template.engine.createJavaScriptEvaluatorFunction("(function() {\n\t\t\t__$woCurrent.bind('"+name+"', function() {\n\t\t\t\treturn "+attr.value+";\n\t\t\t}"+setter+");\n\n\t\t\treturn '';\n\t\t})()")(bindingContext)}finally{delete bindingContext.__$woCurrent}},this);enumerate(propertiesXml.childNodes,function(child,i){if(child.nodeType!==1||view.reservedPropertyNames.indexOf(child.nodeName)!==-1){return}var type="string";for(var j=0,jj=child.attributes.length;j<jj;j++){if(child.attributes[j].nodeName==="constructor"&&child.attributes[j].nodeValue){type=child.attributes[j].nodeValue;break}}if(view.objectParser[trimToLower(type)]){var innerHTML=[];var ser=ser||new XMLSerializer();for(var j=0,jj=child.childNodes.length;j<jj;j++){innerHTML.push(ser.serializeToString(child.childNodes[j]))}var val=view.objectParser[trimToLower(type)](innerHTML.join(""));if(ko.isObservable(this[child.nodeName])){this[child.nodeName](val)}else{this[child.nodeName]=val}}else{var val=wpfko.utils.obj.createObject(type);if(val instanceof wpfko.base.view){val.__createdByWipeout=true;val.initialize(child,bindingContext)}if(ko.isObservable(this[child.nodeName])){this[child.nodeName](val)}else{this[child.nodeName]=val}}},this)};view.objectParser={json:function(value){return JSON.parse(value)},string:function(value){return value},bool:function(value){var tmp=trimToLower(value);return tmp?tmp!=="false"&&tmp!=="0":false},"int":function(value){return parseInt(trim(value))},"float":function(value){return parseFloat(trim(value))},regexp:function(value){return new RegExp(trim(value))},date:function(value){return new Date(trim(value))}};view.prototype.modelChanged=function(oldValue,newValue){this.disposeOf(this.__woBag[modelRoutedEventKey]);if(newValue instanceof wpfko.base.routedEventModel){this.__woBag[modelRoutedEventKey]=this.registerDisposable(newValue.__triggerRoutedEventOnVM.register(this.onModelRoutedEvent,this).dispose)}};view.prototype.onModelRoutedEvent=function(eventArgs){if(!(eventArgs.routedEvent instanceof wpfko.base.routedEvent)){throw"Invaid routed event"}this.triggerRoutedEvent(eventArgs.routedEvent,eventArgs.eventArgs)};return view});Class("wpfko.base.contentControl",function(){var contentControl=wpfko.base.view.extend(function(templateId){this._super(templateId||wpfko.base.visual.getBlankTemplateId());this.template=contentControl.createTemplatePropertyFor(this.templateId,this)},"contentControl");contentControl.createTemplatePropertyFor=function(templateIdObservable,owner){var output=ko.dependentObservable({read:function(){var script=document.getElementById(templateIdObservable());return script?script.textContent:""},write:function(newValue){templateIdObservable(wpfko.base.contentControl.createAnonymousTemplate(newValue))},owner:owner});if(owner instanceof wpfko.base.visual){owner.registerDisposable(output.dispose)}return output};var dataTemplateHash="data-templatehash";var tmp=(function(){var templateArea=null;var i=Math.floor(Math.random()*1000000000);var lazyCreateTemplateArea=function(){if(!templateArea){templateArea=wpfko.utils.html.createElement("<div style='display: none'></div>");document.body.appendChild(templateArea)}};return{create:function(templateString,forceCreate){lazyCreateTemplateArea();templateString=trim(templateString);var hash=contentControl.hashCode(templateString).toString();if(!forceCreate){for(var j=0,jj=templateArea.childNodes.length;j<jj;j++){if(templateArea.childNodes[j].nodeType===1&&templateArea.childNodes[j].nodeName==="SCRIPT"&&templateArea.childNodes[j].id&&templateArea.childNodes[j].attributes[dataTemplateHash]&&templateArea.childNodes[j].attributes[dataTemplateHash].nodeValue===hash&&templateArea.childNodes[j].innerHTML===templateString){return templateArea.childNodes[j].id}}}var id="AnonymousTemplate"+(++i);templateArea.innerHTML+='<script type="text/xml" id="'+id+'" '+dataTemplateHash+'="'+hash+'">'+templateString+"</script>";return id},del:function(templateId){lazyCreateTemplateArea();for(var j=0;j<templateArea.childNodes.length;j++){if(templateArea.childNodes[j].nodeType===1&&templateArea.childNodes[j].nodeName==="SCRIPT"&&templateArea.childNodes[j].id===templateId){templateArea.removeChild(templateArea.childNodes[j]);j--}}}}})();contentControl.createAnonymousTemplate=tmp.create;contentControl.deleteAnonymousTemplate=tmp.del;contentControl.hashCode=function(str){var hash=0;for(var i=0,ii=str.length;i<ii;i++){var ch=str.charCodeAt(i);hash=((hash<<5)-hash)+ch;hash=hash&hash}return hash};return contentControl});var wpfko=wpfko||{};wpfko.base=wpfko.base||{};Class("wpfko.base.event",function(){var event=function(){this._registrations=[]};event.prototype.trigger=function(eventArgs){for(var i=0,ii=this._registrations.length;i<ii;i++){if(eventArgs instanceof wpfko.base.routedEventArgs&&eventArgs.handled){return}this._registrations[i].callback.call(this._registrations[i].context,eventArgs)}};event.prototype.unRegister=function(callback,context){context=context==null?window:context;for(var i=0,ii=this._registrations.length;i<ii;i++){if(this._registrations[i].callback===callback&&this._registrations[i].context===context){this._registrations.splice(i,1);i--}}};event.prototype.dispose=function(){this._registrations.length=0};event.prototype.register=function(callback,context){if(!(callback instanceof Function)){throw"Invalid event callback"}var reg=this._registrations;var evnt={callback:callback,context:context==null?window:context,dispose:function(){var index=reg.indexOf(evnt);if(index>=0){reg.splice(index,1)}}};this._registrations.push(evnt);return{callback:evnt.callback,context:evnt.context,dispose:evnt.dispose}};return event});Class("wpfko.base.if",function(){var sc=true;var staticConstructor=function(){if(!sc){return}sc=false;_if.blankTemplateId=wpfko.base.contentControl.createAnonymousTemplate("",true)};var _if=wpfko.base.contentControl.extend(function(){staticConstructor();this._super.apply(this,arguments);this.condition=ko.observable();this.elseTemplateId=ko.observable(_if.blankTemplateId);this.registerDisposable(this.elseTemplateId.subscribe(this.elseTemplateChanged,this).dispose);this.elseTemplate=wpfko.base.contentControl.createTemplatePropertyFor(this.elseTemplateId,this);this.__cachedTemplateId=this.templateId();this.registerDisposable(this.condition.subscribe(this.onConditionChanged,this).dispose);this.registerDisposable(this.templateId.subscribe(this.copyTemplateId,this).dispose);this.copyTemplateId(this.templateId())},"_if");_if.woInvisibleDefault=true;_if.prototype.elseTemplateChanged=function(newVal){if(!this.condition()){this.templateId(newVal)}};_if.prototype.onConditionChanged=function(newVal){if(this.__oldConditionVal&&!newVal){this.templateId(this.elseTemplateId())}else{if(!this.__oldConditionVal&&newVal){this.templateId(this.__cachedTemplateId)}}this.__oldConditionVal=!!newVal};_if.prototype.copyTemplateId=function(templateId){if(templateId!==this.elseTemplateId()){this.__cachedTemplateId=templateId}if(!this.condition()&&templateId!==this.elseTemplateId()){this.templateId(this.elseTemplateId())}};return _if});Class("wpfko.base.itemsControl",function(){var deafaultTemplateId;var staticConstructor=function(){if(deafaultTemplateId){return}deafaultTemplateId=wpfko.base.contentControl.createAnonymousTemplate("<div data-bind='itemsControl: null'></div>")};var itemsControl=wpfko.base.contentControl.extend(function(templateId,itemTemplateId){staticConstructor();this._super(templateId||deafaultTemplateId);this.itemTemplateId=ko.observable(itemTemplateId);this.itemTemplate=wpfko.base.contentControl.createTemplatePropertyFor(this.itemTemplateId,this);this.itemSource=ko.observableArray([]);this.items=ko.observableArray([]);if(wpfko.utils.ko.version()[0]<3){itemsControl.subscribeV2.call(this)}else{itemsControl.subscribeV3.call(this)}this.registerDisposable(this.items.subscribe(this.syncModelsAndViewModels,this).dispose);var itemTemplateId=this.itemTemplateId.peek();this.registerDisposable(this.itemTemplateId.subscribe(function(newValue){if(itemTemplateId!==newValue){try{this.reDrawItems()}finally{itemTemplateId=newValue}}},this).dispose)},"itemsControl");itemsControl.subscribeV2=function(){var initialItemSource=this.itemSource.peek();this.registerDisposable(this.itemSource.subscribe(function(){try{if(this.modelsAndViewModelsAreSynched()){return}this.itemSourceChanged(ko.utils.compareArrays(initialItemSource,arguments[0]||[]))}finally{initialItemSource=wpfko.utils.obj.copyArray(arguments[0]||[])}},this).dispose);var initialItems=this.items.peek();this.registerDisposable(this.items.subscribe(function(){try{this.itemsChanged(ko.utils.compareArrays(initialItems,arguments[0]||[]))}finally{initialItems=wpfko.utils.obj.copyArray(arguments[0]||[])}},this).dispose)};itemsControl.subscribeV3=function(){this.registerDisposable(this.itemSource.subscribe(this.itemSourceChanged,this,"arrayChange").dispose);this.registerDisposable(this.items.subscribe(this.itemsChanged,this,"arrayChange").dispose)};itemsControl.prototype.syncModelsAndViewModels=function(){var changed=false,modelNull=false;var models=this.itemSource();if(models==null){modelNull=true;models=[]}var viewModels=this.items();if(models.length!==viewModels.length){changed=true;models.length=viewModels.length}for(var i=0,ii=viewModels.length;i<ii;i++){if(viewModels[i].model()!==models[i]){models[i]=viewModels[i].model();changed=true}}if(changed){if(modelNull){this.itemSource(models)}else{this.itemSource.valueHasMutated()}}};itemsControl.prototype.modelsAndViewModelsAreSynched=function(){var model=this.itemSource()||[];var viewModel=this.items()||[];if(model.length!==viewModel.length){return false}for(var i=0,ii=model.length;i<ii;i++){if(model[i]!==viewModel[i].model()){return false}}return true};itemsControl.prototype.itemsChanged=function(changes){enumerate(changes,function(change){if(change.status===wpfko.utils.ko.array.diff.deleted&&change.moved==null){this.itemDeleted(change.value)}else{if(change.status===wpfko.utils.ko.array.diff.added&&change.moved==null){this.itemRendered(change.value)}}},this)};itemsControl.prototype.itemSourceChanged=function(changes){var items=this.items();var del=[],add=[],move={},delPadIndex=0;for(var i=0,ii=changes.length;i<ii;i++){if(changes[i].status===wpfko.utils.ko.array.diff.retained){continue}else{if(changes[i].status===wpfko.utils.ko.array.diff.deleted){del.push((function(change){return function(){var removed=items.splice(change.index+delPadIndex,1)[0];if(change.moved!=null){move[change.moved+"."+change.index]=removed}delPadIndex--}})(changes[i]))}else{if(changes[i].status===wpfko.utils.ko.array.diff.added){add.push((function(change){return function(){var added=change.moved!=null?move[change.index+"."+change.moved]:this._createItem(change.value);items.splice(change.index,0,added)}})(changes[i]))}else{throw"Unsupported status"}}}}for(i=0,ii=del.length;i<ii;i++){del[i].call(this)}for(i=0,ii=add.length;i<ii;i++){add[i].call(this)}this.items.valueHasMutated()};itemsControl.prototype.itemRendered=function(item){};itemsControl.prototype.itemDeleted=function(item){var renderedChild=this.renderedChildren.indexOf(item);if(renderedChild!==-1){this.renderedChildren.splice(renderedChild,1)}item.dispose()};itemsControl.prototype._createItem=function(model){var item=this.createItem(model);item.__createdByWipeout=true;return item};itemsControl.prototype.createItem=function(model){return new wpfko.base.view(this.itemTemplateId(),model)};itemsControl.prototype.reDrawItems=function(){var models=this.itemSource()||[];var values=this.items();values.length=models.length;for(var i=0,ii=models.length;i<ii;i++){values[i]=this._createItem(models[i])}this.items.valueHasMutated()};return itemsControl});Class("wpfko.base.routedEvent",function(){var routedEvent=function(){};routedEvent.prototype.trigger=function(triggerOnVisual,eventArgs){triggerOnVisual.triggerRoutedEvent(this,new wpfko.base.routedEventArgs(eventArgs,triggerOnVisual))};routedEvent.prototype.unRegister=function(callback,triggerOnVisual,context){triggerOnVisual.unRegisterRoutedEvent(this,callback,context)};routedEvent.prototype.register=function(callback,triggerOnVisual,context){triggerOnVisual.registerRoutedEvent(this,callback,context)};return routedEvent});Class("wpfko.base.routedEventArgs",function(){var routedEventArgs=function(eventArgs,originator){this.handled=false;this.data=eventArgs;this.originator=originator};return routedEventArgs});Class("wpfko.base.routedEventRegistration",function(){var routedEventRegistration=function(routedEvent){this.routedEvent=routedEvent;this.event=new wpfko.base.event()};routedEventRegistration.prototype.dispose=function(){this.event.dispose()};return routedEventRegistration});Class("wpfko.base.routedEventModel",function(){var routedEventModel=wpfko.base.object.extend(function(){this.__triggerRoutedEventOnVM=new wo.event()});routedEventModel.prototype.triggerRoutedEvent=function(routedEvent,eventArgs){this.__triggerRoutedEventOnVM.trigger({routedEvent:routedEvent,eventArgs:eventArgs})};return routedEventModel});Binding("itemsControl",true,function(){var itemsControlTemplate="";var itemsTemplate=null;var staticConstructor=function(){if(itemsTemplate){return}var tmp="<!-- ko ic-render: $data";if(DEBUG){tmp+=", wipeout-type: 'items[' + wpfko.util.ko.peek($index) + ']'"}tmp+=" --><!-- /ko -->";itemsTemplate=wpfko.base.contentControl.createAnonymousTemplate(tmp)};var init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var ic=wpfko.utils.ko.peek(viewModel);if(ic&&!(ic instanceof wpfko.base.itemsControl)){throw"This binding can only be used on an itemsControl"}staticConstructor();return ko.bindingHandlers.template.init.call(this,element,utils.createAccessor(viewModel),allBindingsAccessor,viewModel,bindingContext)};var update=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var ic=wpfko.utils.ko.peek(viewModel);if(ic&&!(ic instanceof wpfko.base.itemsControl)){throw"This binding can only be used on an itemsControl"}return ko.bindingHandlers.template.update.call(this,element,utils.createAccessor(viewModel),allBindingsAccessor,viewModel,bindingContext)};var utils={createAccessor:function(vm){vm=wpfko.utils.ko.peek(vm);return function(){return{name:itemsTemplate,foreach:vm.items,templateEngine:wpfko.template.engine.instance}}}};return{init:init,update:update,utils:utils}});Binding("ic-render",true,function(){var init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){return wpfko.bindings.render.init.call(this,element,valueAccessor,allBindingsAccessor,bindingContext.$parent,bindingContext.$parentContext)};var update=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){return wpfko.bindings.render.update.call(this,element,valueAccessor,allBindingsAccessor,bindingContext.$parent,bindingContext.$parentContext)};return{init:init,update:update}});Binding("render",true,function(){var init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){return ko.bindingHandlers.template.init.call(this,element,wpfko.bindings.render.utils.createValueAccessor(valueAccessor),allBindingsAccessor,viewModel,bindingContext)};var update=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var child=wpfko.utils.ko.peek(wpfko.utils.ko.peek(valueAccessor()));if((viewModel&&!(viewModel instanceof wpfko.base.visual))||(child&&!(child instanceof wpfko.base.visual))){throw"This binding can only be used to render a wo.visual within the context of a wo.visual"}if(child&&viewModel&&child===viewModel){throw"A wo.visual cannot be a child of itself."}if(child&&child._rootHtmlElement){throw"This visual has already been rendered. Call its unRender() function before rendering again."}var _this=this;var templateChanged=function(){if(child){child.unTemplate()}ko.bindingHandlers.template.update.call(_this,element,wpfko.bindings.render.utils.createValueAccessor(valueAccessor),allBindingsAccessor,child,bindingContext);var bindings=allBindingsAccessor();if(bindings["wipeout-type"]){wpfko.bindings["wipeout-type"].utils.comment(element,bindings["wipeout-type"])}};var previous=ko.utils.domData.get(element,wpfko.bindings.wpfko.utils.wpfkoKey);if(previous instanceof wpfko.base.visual){if(previous.__createdByWipeout){previous.dispose()}else{previous.unRender()}}if(child){ko.utils.domData.set(element,wpfko.bindings.wpfko.utils.wpfkoKey,child);child._rootHtmlElement=element;if(viewModel){viewModel.renderedChildren.push(child)}child.templateId.subscribe(templateChanged)}templateChanged()};var createValueAccessor=function(oldValueAccessor){return function(){var child=oldValueAccessor();var _child=ko.utils.unwrapObservable(child);var output={templateEngine:wpfko.template.engine.instance,name:_child?_child.templateId.peek():"",afterRender:_child?function(nodes,context){var old=_child.nodes||[];_child.nodes=nodes;_child.rootHtmlChanged(old,nodes)}:undefined};if(child&&!child.woInvisible){output.data=child||{}}return output}};return{init:init,update:update,utils:{createValueAccessor:createValueAccessor}}});Binding("wipeout-type",true,function(){return{init:function(){},utils:{comment:function(element,text){text=wpfko.utils.ko.peek(text);if(element.nodeType===1){if(element.childNodes.length){element.insertBefore(document.createComment(text),element.childNodes[0])}else{element.appendChild(document.createComment(text))}}else{if(element.parentElement){if(element.nextSibling){element.parentElement.insertBefore(document.createComment(text),element.nextSibling)}else{element.parentElement.append(document.createComment(text))}}}}}}});Binding("wo",true,function(){var init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var vals=wpfko.template.engine.scriptCache[valueAccessor()](bindingContext);if(vals.id){var current=bindingContext;while(current.$data.woInvisible){current=current.$parentContext}current.$data.templateItems[vals.id]=vals.vm}var init=wpfko.bindings.render.init.call(this,element,function(){return vals.vm},allBindingsAccessor,viewModel,bindingContext);wpfko.bindings.render.update.call(this,element,function(){return vals.vm},allBindingsAccessor,viewModel,bindingContext);return init};return{init:init}});Binding("wpfko",true,function(){var init=function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){if(ko.utils.domData.get(element,wpfko.bindings.wpfko.utils.wpfkoKey)){throw"This element is already bound to another model"}var type=valueAccessor();if(!type){throw"Invalid view type"}var view=new type();if(!(view instanceof wpfko.base.view)){throw"Invalid view type"}view.model(viewModel);var output=ko.bindingHandlers.render.init.call(this,element,createValueAccessor(view),allBindingsAccessor,null,bindingContext);ko.bindingHandlers.render.update.call(this,element,createValueAccessor(view),allBindingsAccessor,null,bindingContext);view.applicationInitialized();return output};var createValueAccessor=function(view){return function(){return view}};return{init:init,utils:{createValueAccessor:createValueAccessor,wpfkoKey:"__wpfko"}}});Class("wpfko.template.engine",function(){var engine=function(){};engine.prototype=new ko.templateEngine();engine.createJavaScriptEvaluatorFunction=function(script){return new Function("bindingContext","with(bindingContext) {\n\twith($data) {\n\t\treturn "+script+";\n\t}\n}")};engine.createJavaScriptEvaluatorBlock=function(script){var scriptId=engine.newScriptId();if(script instanceof Function){engine.scriptCache[scriptId]=script}else{engine.scriptCache[scriptId]=engine.createJavaScriptEvaluatorFunction(script)}return engine.openCodeTag+scriptId+engine.closeCodeTag};engine.prototype.createJavaScriptEvaluatorBlock=function(script){return engine.createJavaScriptEvaluatorBlock(script)};engine.prototype.rewriteTemplate=function(template,rewriterCallback,templateDocument){var script=document.getElementById(template);if(script instanceof HTMLElement){if(!engine.scriptHasBeenReWritten.test(script.textContent)){ko.templateEngine.prototype.rewriteTemplate.call(this,template,rewriterCallback,templateDocument)}else{this.makeTemplateSource(template,templateDocument).data("isRewritten",true)}this.wipeoutRewrite(script,rewriterCallback)}else{ko.templateEngine.prototype.rewriteTemplate.call(this,template,rewriterCallback,templateDocument)}};engine.wipeoutRewrite=function(xmlElement,rewriterCallback){if(wpfko.base.visual.reservedTags.indexOf(xmlElement.nodeName)!==-1){for(var i=0;i<xmlElement.childNodes.length;i++){if(xmlElement.childNodes[i].nodeType===1){engine.wipeoutRewrite(xmlElement.childNodes[i],rewriterCallback)}}}else{var newScriptId=engine.newScriptId();engine.scriptCache[newScriptId]=function(parentBindingContext){var vm=wpfko.utils.obj.createObject(xmlElement.nodeName);if(!(vm instanceof wpfko.base.view)){throw"Only wo.view elements can be created in this way"}vm.__createdByWipeout=true;vm.initialize(xmlElement,parentBindingContext);return{vm:vm,id:engine.getId(xmlElement)}};var tags="<!-- ko";if(DEBUG){tags+=" wipeout-type: '"+xmlElement.nodeName+"',"}tags+=" wo: "+newScriptId+" --><!-- /ko -->";var nodes=new DOMParser().parseFromString("<root>"+rewriterCallback(tags)+"</root>","application/xml").documentElement;while(nodes.childNodes.length){var node=nodes.childNodes[0];node.parentElement.removeChild(node);xmlElement.parentElement.insertBefore(node,xmlElement)}xmlElement.parentElement.removeChild(xmlElement)}};engine.getId=function(xmlElement){for(var i=0,ii=xmlElement.attributes.length;i<ii;i++){if(xmlElement.attributes[i].nodeName==="id"){return xmlElement.attributes[i].value}}return null};engine.prototype.wipeoutRewrite=function(script,rewriterCallback){var ser=new XMLSerializer();xmlTemplate=new DOMParser().parseFromString("<root>"+script.textContent+"</root>","application/xml").documentElement;if(xmlTemplate.firstChild&&xmlTemplate.firstChild.nodeName==="parsererror"){throw"Invalid xml template:\n"+ser.serializeToString(xmlTemplate.firstChild)}var scriptContent=[];for(var i=0;i<xmlTemplate.childNodes.length;i++){if(xmlTemplate.childNodes[i].nodeType===1){engine.wipeoutRewrite(xmlTemplate.childNodes[i],rewriterCallback)}scriptContent.push(ser.serializeToString(xmlTemplate.childNodes[i]))}script.textContent=scriptContent.join("")};engine.prototype.renderTemplateSource=function(templateSource,bindingContext,options){if(!(bindingContext.$data instanceof wpfko.base.view)){return[]}var cached=templateSource.data("precompiled");if(!cached){cached=new wpfko.template.htmlBuilder(templateSource.text());templateSource.data("precompiled",cached)}var output;ko.dependentObservable(function(){output=cached.render(bindingContext)},this).dispose();return output};if(DEBUG){var override=function(toOverride){engine.prototype[toOverride]=function(){ko.templateEngine.prototype[toOverride].apply(this,arguments)}};override("isTemplateRewritten");override("makeTemplateSource");override("renderTemplate")}engine.newScriptId=(function(){var i=Math.floor(Math.random()*10000);return function(){return(++i).toString()}})();engine.scriptCache={};engine.openCodeTag="<!-- wpfko_code: {";engine.closeCodeTag="} -->";engine.scriptHasBeenReWritten=RegExp(engine.openCodeTag.replace("{","{")+"[0-9]+"+engine.closeCodeTag.replace("}","}"));engine.instance=new engine();return engine});Class("wpfko.template.htmlBuilder",function(){var htmlBuilder=function(xmlTemplate){this.preRendered=[];this.generatePreRender(xmlTemplate)};htmlBuilder.prototype.render=function(bindingContext){var contexts=[];var returnVal=[];for(var i=0,ii=this.preRendered.length;i<ii;i++){if(this.preRendered[i] instanceof Function){var rendered=this.preRendered[i](bindingContext);returnVal.push(rendered)}else{returnVal.push(this.preRendered[i])}}var html=wpfko.utils.html.createElements(returnVal.join(""));enumerate(htmlBuilder.getTemplateIds({childNodes:html}),function(item,id){bindingContext.$data.templateItems[id]=item});if(bindingContext.$data instanceof wpfko.base.view){bindingContext.$data.onInitialized()}return html};htmlBuilder.prototype.generatePreRender=function(templateString){var xmlTemplate=new DOMParser().parseFromString("<root>"+templateString+"</root>","application/xml").documentElement;if(xmlTemplate.firstChild&&xmlTemplate.firstChild.nodeName==="parsererror"){var ser=new XMLSerializer();throw"Invalid xml template:\n"+ser.serializeToString(xmlTemplate.firstChild)}var open=wpfko.template.engine.openCodeTag;var close=wpfko.template.engine.closeCodeTag;var template=wpfko.template.htmlBuilder.generateTemplate(xmlTemplate);this.preRendered.length=0;var startTag,endTag;while((startTag=template.indexOf(open))!==-1){this.preRendered.push(template.substr(0,startTag));template=template.substr(startTag);endTag=template.indexOf(close);if(endTag===-1){throw"Invalid wpfko_code tag."}this.preRendered.push((function(scriptId){return function(bindingContext){return wpfko.template.engine.scriptCache[scriptId](bindingContext)}})(template.substr(open.length,endTag-open.length)));template=template.substr(endTag+close.length)}this.preRendered.push(template)};htmlBuilder.getTemplateIds=function(element){var ids={};enumerate(element.childNodes,function(node){if(node.nodeType===1){for(var j=0,jj=node.attributes.length;j<jj;j++){if(node.attributes[j].nodeName==="id"){ids[node.attributes[j].nodeValue]=node;break}}enumerate(htmlBuilder.getTemplateIds(node),function(element,id){ids[id]=element})}});return ids};htmlBuilder.generateTemplate=function(xmlTemplate){var result=[];var ser=new XMLSerializer();enumerate(xmlTemplate.childNodes,function(child){if(child.nodeType==1){var ch=new DOMParser().parseFromString(ser.serializeToString(child),"application/xml").documentElement;while(ch.childNodes.length){ch.removeChild(ch.childNodes[0])}var html=wpfko.utils.html.createElement(ser.serializeToString(ch));html.innerHTML=wpfko.template.htmlBuilder.generateTemplate(child);result.push(wpfko.utils.html.outerHTML(html))}else{if(child.nodeType===3){result.push(child.data)}else{result.push(ser.serializeToString(child))}}});return result.join("")};return htmlBuilder});Class("wpfko.utils.html",function(){var outerHTML=function(element){if(!element){return null}if(element.constructor===HTMLHtmlElement){throw"Cannot serialize a Html element using outerHTML"}var tagName=element.nodeType===1?(specialTags[element.tagName.toLowerCase()]||"div"):"div";var div=document.createElement(tagName);div.innerHTML=element.outerHTML;return div.innerHTML};var validHtmlCharacter=/[a-zA-Z0-9]/;var getTagName=function(openingTag){openingTag=openingTag.replace(/^\s+|\s+$/g,"");if(!openingTag||openingTag[0]!=="<"){throw"Invalid html tag"}openingTag=openingTag.substring(1).replace(/^\s+|\s+$/g,"");for(var i=0,ii=openingTag.length;i<ii;i++){if(!validHtmlCharacter.test(openingTag[i])){break}}return openingTag.substring(0,i)};var stripHtmlComments=/<\!--[^>]*-->/g;var getFirstTagName=function(htmlContent){htmlContent=htmlContent.replace(stripHtmlComments,"").replace(/^\s+|\s+$/g,"");var i=0;if((i=htmlContent.indexOf("<"))===-1){return null}return getTagName(htmlContent.substring(i))};var specialTags={area:"map",base:"head",basefont:"head",body:"html",caption:"table",col:"colgroup",colgroup:"table",command:"menu",frame:"frameset",frameset:"html",head:"html",li:"ul",tbody:"table",td:"tr",tfoot:"table",th:"tr",thead:"table",tr:"tbody"};var createElement=function(htmlString){if(!htmlString){return null}var parent=document.createElement(specialTags[getTagName(htmlString)]||"div");parent.innerHTML=htmlString;var element=parent.firstChild;parent.removeChild(element);return element};var createElements=function(htmlString){if(htmlString==null){return[]}var sibling=getFirstTagName(htmlString)||"div";var parent=specialTags[getTagName("<"+sibling+"/>")]||"div";htmlString="<"+sibling+"></"+sibling+">"+htmlString+"<"+sibling+"></"+sibling+">";var div=document.createElement(parent);div.innerHTML=htmlString;var output=[];while(div.firstChild){output.push(div.firstChild);div.removeChild(div.firstChild)}output.splice(0,1);output.splice(output.length-1,1);return output};var getAllChildren=function(element){var children=[];if(wpfko.utils.ko.virtualElements.isVirtual(element)){var parent=wpfko.utils.ko.virtualElements.parentElement(element);for(var i=0,ii=parent.childNodes.length;i<ii;i++){if(parent.childNodes[i]===element){break}}i++;for(var ii=parent.childNodes.length;i<ii;i++){children.push(parent.childNodes[i])}}else{children=element.childNodes}var output=[];var depth=0;for(var i=0,ii=children.length;i<ii;i++){if(wpfko.utils.ko.virtualElements.isVirtualClosing(children[i])){depth--;if(depth<0){return output}continue}if(depth>0){continue}output.push(children[i]);if(wpfko.utils.ko.virtualElements.isVirtual(children[i])){depth++}}return output};var getViewModel=function(forHtmlNode){return ko.utils.domData.get(forHtmlNode,wpfko.bindings.wpfko.utils.wpfkoKey)};return{specialTags:specialTags,getFirstTagName:getFirstTagName,getTagName:getTagName,getAllChildren:getAllChildren,outerHTML:outerHTML,createElement:createElement,createElements:createElements,getViewModel:getViewModel}});Class("wpfko.util.html",function(){return wpfko.utils.html});Class("wpfko.utils.ko",function(){var _ko={};_ko.version=function(){if(!ko||!ko.version){return null}var version=ko.version.split(".");for(var i=0,ii=version.length;i<ii;i++){version[i]=parseInt(version[i])}return version};_ko.peek=function(input){if(ko.isObservable(input)){return input.peek()}else{return input}};_ko.array={diff:{added:"added",deleted:"deleted",retained:"retained"}};_ko.isObservableArray=function(test){return ko.isObservable(test)&&test.push&&test.push.constructor===Function};_ko.virtualElements={parentElement:function(node){var current=node.previousSibling;while(current){if(_ko.virtualElements.isVirtual(current)){return current}current=current.previousSibling}return node.parentNode},isVirtual:function(node){return node.nodeType===8&&node.nodeValue.replace(/^\s+/,"").indexOf("ko")===0},isVirtualClosing:function(node){return node.nodeType===8&&trim(node.nodeValue)==="/ko"}};return _ko});Class("wpfko.util.ko",function(){return wpfko.utils.ko});window.wo={};enumerate(wpfko.base,function(item,i){window.wo[i]=item});enumerate(wpfko.utils,function(item,i){window.wo[i]=item});var DEBUG=wo.DEBUG=false})();