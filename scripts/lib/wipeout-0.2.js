(function(){var f={};var c=function(j,g,h){h=h||window;if(j==null){return}if(j instanceof Array){for(var k=0,l=j.length;k<l;k++){g.call(h,j[k],k)}}else{for(var k in j){g.call(h,j[k],k)}}};var d=function(j,g,h){h=h||window;if(j==null){return}if(j instanceof Array){for(var k=j.length-1;k>=0;k--){g.call(h,j[k],k)}}else{var l=[];for(var k in j){l.push(k)}for(var k=l.length-1;k>=0;k--){g.call(h,j[l[k]],l[k])}}};var a=function(i,h,g){var j=b("wpfko.bindings."+i,g);ko.bindingHandlers[i]={init:j.init,update:j.update};if(h){ko.virtualElements.allowedBindings[i]=true}};var b=function(h,g){h=h.split(".");var i=h.splice(0,h.length-1);var j={};j[h[h.length-1]]=g();e(i.join("."),j);return j[h[h.length-1]]};var e=function(i,h){i=i.split(".");if(i[0]!=="wpfko"){throw'Root must be "wpfko".'}i.splice(0,1);var g=f;c(i,function(j){g=g[j]||(g[j]={})});if(h&&h instanceof Function){h=h()}c(h,function(k,j){g[j]=k})};b("wpfko.util.obj",function(){var h=function(k,l){if(!l){l=window}var j=k.split(".");for(var m=0,n=j.length;m<n;m++){l=l[j[m]];if(!l){throw'Cannot create object "'+k+'"'}}if(l instanceof Function){return new l()}else{throw k+" is not a valid function."}};var g=function(l){var m=[];for(var j=0,k=l.length;j<k;j++){m.push(l[j])}return m};return{enumerate:c,enumerateDesc:d,createObject:h,copyArray:g}});b("wpfko.base.object",function(){var h=function(){};var g={parents:[],children:[]};h.clearVirtualCache=function(j){if(!j){g.parents.length=0;g.children.length=0;return}for(var k=0,l=g.children.length;k<l;k++){if(g.children[k]===j||g.parents[k]===j){g.children.splice(k,1);g.parents.splice(k,1)}}};h.useVirtualCache=true;h.prototype._super=function(){var k=null;if(h.useVirtualCache){var r=g.children.indexOf(arguments.callee.caller);if(r!==-1){k=g.parents[r]}}if(!k){var o=[];var l=this.constructor.prototype;while(l){o.push(l);l=Object.getPrototypeOf(l)}o.reverse();for(var m=0,n=o.length;m<n;m++){for(var q in o[m]){if(o[m][q]===arguments.callee.caller){for(var p=m-1;p>=0;p--){if(o[p][q]!==arguments.callee.caller){k=o[p][q];if(h.useVirtualCache){g.children.push(arguments.callee.caller);g.parents.push(k)}break}}break}}}if(!k){throw"Could not find method in parent class"}}return k.apply(this,arguments)};h.extend=function(i){for(var j in this){if(this.hasOwnProperty(j)&&this[j]&&this[j].constructor===Function){i[j]=this[j]}}function k(){this.constructor=i}k.prototype=this.prototype;i.prototype=new k();return i};return h});b("wpfko.base.visual",function(){var g=f.base.object.extend(function(h){this._super();this.templateItems={};this.renderedChildren=[];this._rootHtmlElement=null;this._routedEventSubscriptions=[];this.templateId=ko.observable(h||g.getDefaultTemplateId())});g._afterRendered=function(i,h){var j=h.nodes||[];h.nodes=i;h.rootHtmlChanged(j,i)};g.prototype.dispose=function(){for(var h in this){if(ko.isObservable(this[h])&&this[h].dispose instanceof Function){this[h].dispose()}}for(var h in this.templateItems){if(this.templateItems[h] instanceof g){this.templateItems[h].dispose()}}for(var h=0,j=this.renderedChildren.length;h<j;h++){if(this.renderedChildren[h] instanceof g){this.renderedChildren[h].dispose()}}this.renderedChildren.length=0;this._rootHtmlElement=null;for(var h=0,j=this._routedEventSubscriptions.length;h<j;h++){this._routedEventSubscriptions[h].event.dispose()}this._routedEventSubscriptions.length=0};g.getParentElement=function(j){var i=0;var h=j.previousSibling;while(h){if(f.util.ko.virtualElements.isVirtualClosing(h)){i--}if(f.util.ko.virtualElements.isVirtual(h)){if(i===0){return h}i++}h=h.previousSibling}return j.parentElement};g.prototype.getParents=function(){var h=this;var i=[];while(h){i.push(h);h=h.getParent()}return i};g.prototype.getParent=function(){var i;var h=g.getParentElement(this._rootHtmlElement);while(h){if(i=ko.utils.domData.get(h,f.bindings.wpfko.utils.wpfkoKey)){return i}h=g.getParentElement(h)}};g.prototype.unRegisterRoutedEvent=function(m,h,j){for(var k=0,l=this._routedEventSubscriptions.length;k<l;k++){if(this._routedEventSubscriptions[k].routedEvent===m){this._routedEventSubscriptions[k].event.unRegister(h,context);return}}};g.prototype.registerRoutedEvent=function(n,h,j){var m;for(var k=0,l=this._routedEventSubscriptions.length;k<l;k++){if(this._routedEventSubscriptions[k].routedEvent===n){m=this._routedEventSubscriptions[k];break}}if(!m){m=new f.base.routedEventRegistration(n);this._routedEventSubscriptions.push(m)}m.event.register(h,j)};g.prototype.triggerRoutedEvent=function(m,h){if(!(h instanceof f.base.routedEventArgs)){h=new f.base.routedEventArgs(h,this)}for(var j=0,k=this._routedEventSubscriptions.length;j<k;j++){if(h.handled){return}if(this._routedEventSubscriptions[j].routedEvent===m){this._routedEventSubscriptions[j].event.trigger(h)}}if(!h.handled){var l=this.getParent();if(l){l.triggerRoutedEvent(m,h)}}};g.prototype.rootHtmlChanged=function(i,h){};g.getDefaultTemplateId=(function(){var h=null;return function(){if(!h){h=f.base.contentControl.createAnonymousTemplate("<span>No template has been specified</span>")}return h}})();g.getBlankTemplateId=(function(){var h=null;return function(){if(!h){h=f.base.contentControl.createAnonymousTemplate("")}return h}})();g.visualGraph=function(j,h){if(!j){return[]}h=h||function(){return typeof arguments[0]};var i=[];f.util.obj.enumerate(f.util.html.getAllChildren(j),function(l){f.util.obj.enumerate(g.visualGraph(l),i.push,i)});var k=ko.utils.domData.get(j,f.bindings.wpfko.utils.wpfkoKey);if(k){return[{viewModel:k,display:h(k),children:i}]}return i};g.reservedTags=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","head","header","h1","h2","h3","h4","h5","h6","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","map","mark","menu","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strike","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"];return g});b("wpfko.base.view",function(){var i=f.base.visual.extend(function(k,j){this._super(k);this.model=ko.observable(j||null);var j=null;this.model.subscribe(function(l){try{this.modelChanged(j,l)}finally{j=l}},this);this._bindings={}});var g=function(n,j,k){for(var l=0,m=n.length;l<m;l++){j.call(k,n[l],l)}};var h=function(j,k,l){if(ko.isObservable(j[k])){j[k](ko.utils.unwrapObservable(l))}else{j[k]=ko.utils.unwrapObservable(l)}};i.prototype.onInitialized=function(){};i.prototype.dispose=function(){this._super();for(var j in this._bindings){this._bindings[j].dispose()}};i.prototype.bind=function(j,o,n){if(n&&(!ko.isObservable(this[j])||!ko.isObservable(o()))){throw"Two way bindings must be between 2 observables"}if(this._bindings[j]){this._bindings[j].dispose();delete this._bindings[j]}var m=ko.dependentObservable({read:function(){return ko.utils.unwrapObservable(o())},write:n?function(){var p=o();if(p){p(arguments[0])}}:undefined});h(this,j,m.peek());var k=m.subscribe(function(p){h(this,j,p)},this);var l=n?this[j].subscribe(function(p){h({x:m},"x",p)},this):null;this._bindings[j]={dispose:function(){if(k){k.dispose();k=null}if(l){l.dispose();l=null}if(m){m.dispose();m=null}}}};i.reservedPropertyNames=["constructor","constructor-tw","id","id-tw"];i.prototype.initialize=function(k,j){if(this._initialized){throw"Cannot call initialize item twice"}this._initialized=true;if(!k){return}if(!f.template.htmlBuilder.elementHasModelBinding(k)&&f.util.ko.peek(this.model)==null){this.bind("model",j.$parent.model)}g(k.attributes,function(l){if(i.reservedPropertyNames.indexOf(l.nodeName)!==-1){return}var m=l.nodeName,n="";if(m.indexOf("-tw")===l.nodeName.length-3){m=m.substr(0,m.length-3);n=",\n\t\t\tfunction(val) {\n\t\t\t\tif(!ko.isObservable("+l.value+"))\n\t\t\t\t\tthrow 'Two way bindings must be between 2 observables';\n\t\t\t\t"+l.value+"(val);\n\t\t\t}"}f.template.engine.createJavaScriptEvaluatorFunction("(function() {\n\t\t\t$data.bind('"+m+"', function() {\n\t\t\t\treturn "+l.value+";\n\t\t\t}"+n+");\n\n\t\t\treturn '';\n\t\t})()")(j)});g(k.childNodes,function(l,m){if(l.nodeType!==1){return}var r="string";for(var o=0,p=l.attributes.length;o<p;o++){if(l.attributes[o].nodeName==="constructor"&&l.attributes[o].nodeValue){r=l.attributes[o].nodeValue;break}}if(i.objectParser[r.replace(/^\s+|\s+$/g,"").toLowerCase()]){var n=[];var q=q||new XMLSerializer();for(var o=0,p=l.childNodes.length;o<p;o++){n.push(q.serializeToString(l.childNodes[o]))}var s=i.objectParser[r.replace(/^\s+|\s+$/g,"").toLowerCase()](n.join(""));if(ko.isObservable(this[l.nodeName])){this[l.nodeName](s)}else{this[l.nodeName]=s}}else{var s=f.util.obj.createObject(r);s.initialize(l,j.createChildContext(s));if(ko.isObservable(this[l.nodeName])){this[l.nodeName](s)}else{this[l.nodeName]=s}}},this)};i.objectParser={json:function(j){return JSON.parse(j)},string:function(j){return j},bool:function(k){var j=k.replace(/^\s+|\s+$/g,"").toLowerCase();return j?j!=="false"&&j!=="0":false},"int":function(j){return parseInt(j.replace(/^\s+|\s+$/g,""))},"float":function(j){return parseFloat(j.replace(/^\s+|\s+$/g,""))},regexp:function(j){return new RegExp(j.replace(/^\s+|\s+$/g,""))},date:function(j){return new Date(j.replace(/^\s+|\s+$/g,""))}};i.prototype.modelChanged=function(k,j){};return i});b("wpfko.base.contentControl",function(){var g=f.base.view.extend(function(i){this._super(i||f.base.visual.getBlankTemplateId());this.template=g.createTemplatePropertyFor(this.templateId,this)});g.createTemplatePropertyFor=function(j,i){return ko.dependentObservable({read:function(){var k=document.getElementById(j());return k?k.textContent:""},write:function(k){j(f.base.contentControl.createAnonymousTemplate(k))},owner:i})};var h="data-templatehash";g.createAnonymousTemplate=(function(){var k=null;var j=Math.floor(Math.random()*1000000000);return function(o){if(!k){k=f.util.html.createElement("<div style='display: none'></div>");document.body.appendChild(k)}o=o.replace(/^\s+|\s+$/g,"");var i=g.hashCode(o).toString();for(var m=0,n=k.childNodes.length;m<n;m++){if(k.childNodes[m].nodeType===1&&k.childNodes[m].nodeName==="SCRIPT"&&k.childNodes[m].id&&k.childNodes[m].attributes[h]&&k.childNodes[m].attributes[h].nodeValue===i&&k.childNodes[m].innerHTML===o){return k.childNodes[m].id}}var l="AnonymousTemplate"+(++j);k.innerHTML+='<script type="text/xml" id="'+l+'" '+h+'="'+i+'">'+o+"</script>";return l}})();g.hashCode=function(n){var k=0;for(var l=0,m=n.length;l<m;l++){var j=n.charCodeAt(l);k=((k<<5)-k)+j;k=k&k}return k};return g});var f=f||{};f.base=f.base||{};b("wpfko.base.event",function(){var g=function(){this._registrations=[]};g.prototype.trigger=function(h){for(var j=0,k=this._registrations.length;j<k;j++){if(h instanceof f.base.routedEventArgs&&h.handled){return}this._registrations[j].callback.call(this._registrations[j].context,h)}};g.prototype.unRegister=function(h,j){j=j==null?window:j;for(var k=0,l=this._registrations.length;k<l;k++){if(this._registrations[k].callback===h&&this._registrations[k].context===j){this._registrations.splice(k,1);k--}}};g.prototype.dispose=function(){this._registrations.length=0};g.prototype.register=function(h,i){if(!(h instanceof Function)){throw"Invalid event callback"}var k=this._registrations;var j={callback:h,context:i==null?window:i,dispose:function(){var l=k.indexOf(j);if(l>=0){k.splice(l,1)}}};this._registrations.push(j);return{callback:j.callback,context:j.context,dispose:j.dispose}};return g});b("wpfko.base.itemsControl",function(){var g;var i=function(){if(g){return}g=f.base.contentControl.createAnonymousTemplate("<div data-bind='itemsControl: null'></div>")};var h=f.base.contentControl.extend(function(k,j){i();this._super(k||g);this.itemTemplateId=ko.observable(j);this.itemTemplate=f.base.contentControl.createTemplatePropertyFor(this.itemTemplateId,this);this.itemSource=ko.observableArray([]);this.items=ko.observableArray([]);if(f.util.ko.version()[0]<3){h.subscribeV2.call(this)}else{h.subscribeV3.call(this)}this.items.subscribe(this.syncModelsAndViewModels,this);var j=this.itemTemplateId.peek();this.itemTemplateId.subscribe(function(l){if(j!==l){try{this.reDrawItems()}finally{j=l}}},this)});h.subscribeV2=function(){var j=this.itemSource.peek();this.itemSource.subscribe(function(){try{if(this.modelsAndViewModelsAreSynched()){return}this.itemsChanged(ko.utils.compareArrays(j,arguments[0]||[]))}finally{j=f.util.obj.copyArray(arguments[0]||[])}},this)};h.subscribeV3=function(){this.itemSource.subscribe(this.itemsChanged,this,"arrayChange")};h.prototype.syncModelsAndViewModels=function(){var j=false,m=false;var n=this.itemSource();if(n==null){m=true;n=[]}var o=this.items();if(n.length!==o.length){j=true;n.length=o.length}for(var k=0,l=o.length;k<l;k++){if(o[k].model()!==n[k]){n[k]=o[k].model();j=true}}if(j){if(m){this.itemSource(n)}else{this.itemSource.valueHasMutated()}}};h.prototype.modelsAndViewModelsAreSynched=function(){var l=this.itemSource()||[];var m=this.items()||[];if(l.length!==m.length){return false}for(var j=0,k=l.length;j<k;j++){if(l[j]!==m[j].model()){return false}}return true};h.prototype.itemsChanged=function(k){var p=this.items();var l=[],j=[],q={},m=0;for(var n=0,o=k.length;n<o;n++){if(k[n].status===f.util.ko.array.diff.retained){continue}else{if(k[n].status===f.util.ko.array.diff.deleted){l.push((function(r){return function(){var s=p.splice(r.index+m,1)[0];if(r.moved!=null){q[r.moved+"."+r.index]=s}m--}})(k[n]))}else{if(k[n].status===f.util.ko.array.diff.added){j.push((function(r){return function(){var s=r.moved!=null?q[r.index+"."+r.moved]:this.createItem(r.value);p.splice(r.index,0,s)}})(k[n]))}else{throw"Unsupported status"}}}}for(n=0,o=l.length;n<o;n++){l[n].call(this)}for(n=0,o=j.length;n<o;n++){j[n].call(this)}this.items.valueHasMutated()};h.prototype.createItem=function(j){return new f.base.view(this.itemTemplateId(),j)};h.prototype.reDrawItems=function(){var l=this.itemSource()||[];var m=this.items();m.length=l.length;for(var j=0,k=l.length;j<k;j++){m[j]=this.createItem(l[j])}this.items.valueHasMutated()};return h});b("wpfko.base.routedEvent",function(){var g=function(){};g.prototype.trigger=function(i,h){i.triggerRoutedEvent(this,new f.base.routedEventArgs(h,i))};g.prototype.unRegister=function(h,j,i){j.unRegisterRoutedEvent(this,h,i)};g.prototype.register=function(h,j,i){j.registerRoutedEvent(this,h,i)};return g});b("wpfko.base.routedEventArgs",function(){var g=function(h,i){this.handled=false;this.data=h;this.originator=i};return g});b("wpfko.base.routedEventRegistration",function(){var g=function(h){this.routedEvent=h;this.event=new f.base.event()};return g});a("itemsControl",true,function(){var g=function(l,m,j,n,k){if(!(n instanceof f.base.itemsControl)){throw"This binding can only be used within the context of a wo.itemsControl"}ko.virtualElements.emptyNode(l);if(f.util.ko.version()[0]<3){i.subscribeV2(l,n,k)}else{i.subscribeV3(l,n,k)}h(l,n,k)(ko.utils.compareArrays([],n.items.peek()))};var h=function(k,l,j){return function(n){var o=[],m=[],s={},p=0;for(var q=0,r=n.length;q<r;q++){if(n[q].status===f.util.ko.array.diff.retained){continue}else{if(n[q].status===f.util.ko.array.diff.deleted){o.push((function(t){return function(){if(t.moved!=null){s[t.moved+"."+t.index]={vm:t.value,elements:t.value._rootHtmlElement.__wpfko.allElements()}}else{ko.virtualElements.emptyNode(t.value._rootHtmlElement)}var u=t.value._rootHtmlElement.__wpfko.allElements();for(var v=0,w=u.length;v<w;v++){u[v].parentNode.removeChild(u[v])}if(t.moved==null){t.value.dispose()}p--}})(n[q]))}else{if(n[q].status===f.util.ko.array.diff.added){m.push((function(t){return function(){var x=l.items.indexOf(t.value);if(t.moved!=null){var y=s[t.index+"."+t.moved];if(x===0){for(var z=y.elements.length-1;z>=0;z--){ko.virtualElements.prepend(k,y.elements[z])}}else{var v=l.items.peek()[x-1];for(var z=y.elements.length-1;z>=0;z--){v._rootHtmlElement.__wpfko.insertAfter(y.elements[z])}}}else{var w=f.util.html.createWpfkoComment();if(x===0){ko.virtualElements.prepend(k,w.close);ko.virtualElements.prepend(k,w.open)}else{l.items.peek()[x-1]._rootHtmlElement.__wpfko.insertAfter(w.close);l.items.peek()[x-1]._rootHtmlElement.__wpfko.insertAfter(w.open)}var u=(function(A){return function(){return t.value}})(q);f.bindings.render.init(w.open,u,u,l,j);f.bindings.render.update(w.open,u,u,l,j)}}})(n[q]))}else{throw"Unsupported status"}}}}for(q=0,r=o.length;q<r;q++){o[q].call(this)}for(q=0,r=m.length;q<r;q++){m[q].call(this)}}};var i={subscribeV2:function(k,n,j){var m=f.util.obj.copyArray(n.items.peek());var l=i.itemsChanged(k,n,j);n.items.subscribe(function(){try{var o=ko.utils.compareArrays(m,arguments[0]||[]);l(o)}finally{m=f.util.obj.copyArray(n.items.peek())}})},subscribeV3:function(k,l,j){l.items.subscribe(i.itemsChanged(k,l,j),window,"arrayChange")},itemsChanged:h};return{init:g,utils:i}});a("render",true,function(){var h=function(l,m,j,n,k){return ko.bindingHandlers.template.init.call(this,l,f.bindings.render.utils.createValueAccessor(m),j,m(),k)};var i=function(n,p,k,q,l){var m=f.util.ko.peek(p());if((q&&!(q instanceof f.base.visual))||(m&&!(m instanceof f.base.visual))){throw"This binding can only be used to render a wo.visual within the context of a wo.visual"}var j=this;var o=function(){ko.bindingHandlers.template.update.call(j,n,f.bindings.render.utils.createValueAccessor(p),k,m,l)};if(m){if(m._rootHtmlElement){throw"This visual has already been rendered"}ko.utils.domData.set(n,f.bindings.wpfko.utils.wpfkoKey,m);m._rootHtmlElement=n;if(q){q.renderedChildren.push(m)}m.templateId.subscribe(o)}o()};var g=function(j){return function(){var l=j();var k=ko.utils.unwrapObservable(l);return{name:k?k.templateId.peek():"",data:l||{},afterRender:k?f.base.visual._afterRendered:undefined}}};return{init:h,update:i,utils:{createValueAccessor:g}}});a("wpfko",true,function(){var h=function(k,n,i,p,j){if(ko.utils.domData.get(k,f.bindings.wpfko.utils.wpfkoKey)){throw"This element is already bound to another model"}var m=n();if(!m){throw"Invalid view type"}var o=new m();if(!(o instanceof f.base.view)){throw"Invalid view type"}o.model(p);var l=ko.bindingHandlers.render.init.call(this,k,g(o),i,null,j);ko.bindingHandlers.render.update.call(this,k,g(o),i,null,j);return l};var g=function(i){return function(){return i}};return{init:h,utils:{createValueAccessor:g,wpfkoKey:"__wpfko"}}});b("wpfko.template.engine",function(){var g=function(){};g.prototype=new ko.templateEngine();g.createJavaScriptEvaluatorFunction=function(h){return new Function("bindingContext","with(bindingContext) {\n\twith($data) {\n\t\treturn "+h+";\n\t}\n}")};g.createJavaScriptEvaluatorBlock=function(h){var i=g.newScriptId();if(h instanceof Function){g.scriptCache[i]=h}else{g.scriptCache[i]=g.createJavaScriptEvaluatorFunction(h)}return g.openCodeTag+i+g.closeCodeTag};g.prototype.createJavaScriptEvaluatorBlock=function(h){return g.createJavaScriptEvaluatorBlock(h)};g.prototype.isTemplateRewritten=function(i,j){if(i&&i.constructor===String){var h=document.getElementById(i);if(g.scriptHasBeenReWritten.test(h.textContent)){this.makeTemplateSource(i,j).data("isRewritten",true)}}return ko.templateEngine.prototype.isTemplateRewritten.apply(this,arguments)};g.prototype.renderTemplateSource=function(l,h,j){if(!(h.$data instanceof f.base.view)){return[]}var i=l.data("precompiled");if(!i){i=new f.template.xmlTemplate(l.text());l.data("precompiled",i)}var k;ko.dependentObservable(function(){i.rebuild(h);k=i.render(h)},this).dispose();return k};g.newScriptId=(function(){var h=Math.floor(Math.random()*10000);return function(){return(++h).toString()}})();g.scriptCache={};g.openCodeTag="<!-- wpfko_code: {";g.closeCodeTag="} -->";g.scriptHasBeenReWritten=RegExp(g.openCodeTag.replace("{","{")+"[0-9]+"+g.closeCodeTag.replace("}","}"));ko.setTemplateEngine(new g());return g});b("wpfko.template.htmlBuilder",function(){var h=function(i){this.render=h.generateRender(i)};var g=function(n,j,k){for(var l=0,m=n.length;l<m;l++){j.call(k,n[l],l)}};h.elementHasModelBinding=function(j){for(var k=0,l=j.attributes.length;k<l;k++){if(j.attributes[k].nodeName==="model"||j.attributes[k].nodeName==="model-tw"){return true}}for(var k=0,l=j.childNodes.length;k<l;k++){if(j.childNodes[k].nodeType===1&&j.childNodes[k].nodeName==="model"){return true}}return false};h.constructorExists=function(j){j=j.split(".");var k=window;for(var l=0,m=j.length;l<m;l++){k=k[j[l]];if(!k){return false}}return k instanceof Function};h.generateRender=function(p){var l=f.template.engine.openCodeTag;var i=f.template.engine.closeCodeTag;var o=f.template.htmlBuilder.generateTemplate(p);var n,j;var m=[];while((n=o.indexOf(l))!==-1){m.push(o.substr(0,n));o=o.substr(n);j=o.indexOf(i);if(j===-1){throw"Invalid wpfko_code tag."}m.push((function(q){return function(r){return f.template.engine.scriptCache[q](r)}})(o.substr(l.length,j-l.length)));o=o.substr(j+i.length)}m.push(o);var k=m.length;return function(q){var r=[];var u=[];for(var s=0;s<k;s++){if(m[s] instanceof Function){var t=m[s](q);if(t instanceof f.template.switchBindingContext){if(t.bindingContext){r.push(q);q=t.bindingContext}else{q=r.pop()}}else{u.push(t)}}else{u.push(m[s])}}return f.util.html.createElements(u.join(""))}};h.renderFromMemo=function(i){return ko.memoization.memoize(function(m){var k=document.createComment(" ko ");var l=document.createComment(" /ko ");var n=f.util.ko.virtualElements.parentElement(m);ko.virtualElements.insertAfter(n,k,m);ko.virtualElements.insertAfter(n,l,k);var j=function(){return i.$data};f.bindings.render.init(k,j,j,f.util.ko.peek(i.$parentContext.$data),i.$parentContext);f.bindings.render.update(k,j,j,f.util.ko.peek(i.$parentContext.$data),i.$parentContext)})};h.emptySwitchBindingContext=function(i){return new f.template.switchBindingContext()};h.switchBindingContextToTemplateItem=function(i){return function(j){return new f.template.switchBindingContext(j.createChildContext(j.$data.templateItems[i]))}};h.generateTemplate=function(l,i){if(i){i+="."}else{i=""}var j=[];var k=new XMLSerializer();g(l.childNodes,function(n,p){if(f.template.xmlTemplate.isCustomElement(n)){var q=f.template.xmlTemplate.getId(n)||(i+p);j.push(f.template.engine.createJavaScriptEvaluatorBlock(h.switchBindingContextToTemplateItem(q)));j.push(f.template.engine.createJavaScriptEvaluatorBlock(h.renderFromMemo));j.push(f.template.engine.createJavaScriptEvaluatorBlock(h.emptySwitchBindingContext))}else{if(n.nodeType==1){var m=new DOMParser().parseFromString(k.serializeToString(n),"application/xml").documentElement;while(m.childNodes.length){m.removeChild(m.childNodes[0])}var o=f.util.html.createElement(k.serializeToString(m));o.innerHTML=f.template.htmlBuilder.generateTemplate(n,i+p);j.push(f.util.html.outerHTML(o))}else{if(n.nodeType===3){j.push(n.data)}else{j.push(k.serializeToString(n))}}}});return j.join("")};return h});b("wpfko.template.switchBindingContext",function(){return function(g){this.bindingContext=g}});b("wpfko.template.viewModelBuilder",function(){var h=function(i){this._builders=[];this.elementsWithId=[];this._addBuilders(i)};h.prototype.addReferencedElements=function(j,i){g(this.elementsWithId,function(l){var k={childNodes:i};g(l.split("."),function(n,m){k=k.childNodes[parseInt(n)]});if(!k.id){throw"Unexpected exception, could not find element id"}j.templateItems[k.id]=k})};h.prototype._addBuilders=function(j,i){if(i){i+="."}else{i=""}g(j.childNodes,function(k,l){if(f.template.xmlTemplate.isCustomElement(k)){var m=f.template.xmlTemplate.getId(k)||(i+l);this._builders.push(function(n){n.$data.templateItems[m]=f.util.obj.createObject(k.nodeName);n.$data.templateItems[m].initialize(k,n.createChildContext(n.$data.templateItems[m]))})}else{if(k.nodeType==1){if(f.template.xmlTemplate.getId(k)){this.elementsWithId.push(i+l)}this._addBuilders(k,i+l)}}},this)};h.prototype.rebuild=function(j){for(var k in j.$data.templateItems){if(j.$data.templateItems[k] instanceof f.base.visual){j.$data.templateItems[k].dispose()}delete j.$data.templateItems[k]}for(var k=0,l=this._builders.length;k<l;k++){this._builders[k](j)}};var g=function(n,j,k){for(var l=0,m=n.length;l<m;l++){j.call(k,n[l],l)}};return h});b("wpfko.template.xmlTemplate",function(){var g=function(i){i=new DOMParser().parseFromString("<root>"+i+"</root>","application/xml").documentElement;if(i.firstChild&&i.firstChild.nodeName==="parsererror"){var h=new XMLSerializer();throw"Invalid xml template:\n"+h.serializeToString(i.firstChild)}this.viewModelBuilder=new f.template.viewModelBuilder(i);this.htmlBuilder=new f.template.htmlBuilder(i)};g.isCustomElement=function(h){return h.nodeType==1&&f.base.visual.reservedTags.indexOf(h.nodeName.toLowerCase())===-1};g.getId=function(k){for(var h=0,j=k.attributes.length;h<j;h++){if(k.attributes[h].nodeName==="id"){return k.attributes[h].value}}return null};g.prototype.render=function(h){var i=this.htmlBuilder.render(h);this.viewModelBuilder.addReferencedElements(h.$data,i);if(h.$data instanceof f.base.view){h.$data.onInitialized()}return i};g.prototype.rebuild=function(h){this.viewModelBuilder.rebuild(h)};return g});b("wpfko.util.html",function(){var m=function(r){if(!r){return null}var s=r.nodeType===1?(n[r.tagName.toLowerCase()]||"div"):"div";var q=document.createElement(s);q.innerHTML=r.outerHTML;return q.innerHTML};var g=function(r){if(!r){return null}var s=document.createElement(n[l(r)]||"div");s.innerHTML=r;var q=s.firstChild;s.removeChild(q);return q};var p=/[a-zA-Z0-9]/;var l=function(s){s=s.replace(/^\s+|\s+$/g,"");if(!s||s[0]!=="<"){throw"Invalid html tag"}s=s.substring(1).replace(/^\s+|\s+$/g,"");for(var q=0,r=s.length;q<r;q++){if(!p.test(s[q])){break}}return s.substring(0,q)};var o=/<\!--[^>]*-->/g;var k=function(q){q=q.replace(o,"").replace(/^\s+|\s+$/g,"");var r=0;if((r=q.indexOf("<"))===-1){return null}return l(q.substring(r))};var n={td:"tr",th:"tr",tr:"tbody",col:"colgroup",colgroup:"table",tbody:"table",thead:"table",li:"ul"};var h=function(r){if(r==null){return[]}var u=k(r)||"div";var t=n[l("<"+u+"/>")]||"div";r="<"+u+"></"+u+">"+r+"<"+u+"></"+u+">";var q=document.createElement(t);q.innerHTML=r;var s=[];while(q.firstChild){s.push(q.firstChild);q.removeChild(q.firstChild)}s.splice(0,1);s.splice(s.length-1,1);return s};var i=function(){var r=document.createComment(" ko ");var q=document.createComment(" /ko ");r.__wpfko={open:r,close:q,"delete":function(){var s=r.__wpfko.allElements();for(var t=0,u=s.length;t<u;t++){s[t].parentNode.removeChild(s[t])}},allElements:function(){var t=[];var s=r;while(true){t.push(s);if(s===q){break}s=s.nextSibling}return t},insertAfter:function(s){return q.nextSibling?q.parentNode.insertBefore(s,q.nextSibling):q.parentNode.appendChild(s)}};return r.__wpfko};var j=function(s){var q=[];if(f.util.ko.virtualElements.isVirtual(s)){var w=f.util.ko.virtualElements.parentElement(s);for(var t=0,u=w.childNodes.length;t<u;t++){if(w.childNodes[t]===s){break}}t++;for(var u=w.childNodes.length;t<u;t++){q.push(w.childNodes[t])}}else{q=s.childNodes}var v=[];var r=0;for(var t=0,u=q.length;t<u;t++){if(f.util.ko.virtualElements.isVirtualClosing(q[t])){r--;if(r<0){return v}continue}if(r>0){continue}v.push(q[t]);if(f.util.ko.virtualElements.isVirtual(q[t])){r++}}return v};return{specialTags:n,getFirstTagName:k,getTagName:l,getAllChildren:j,outerHTML:m,createElement:g,createElements:h,createWpfkoComment:i}});b("wpfko.util.ko",function(){var g={};g.version=function(){if(!ko||!ko.version){return null}var k=ko.version.split(".");for(var h=0,j=k.length;h<j;h++){k[h]=parseInt(k[h])}return k};g.peek=function(h){if(ko.isObservable(h)){return h.peek()}else{return h}};g.array={diff:{added:"added",deleted:"deleted",retained:"retained"}};g.isObservableArray=function(h){return ko.isObservable(h)&&h.push&&h.push.constructor===Function};g.virtualElements={parentElement:function(i){var h=i.previousSibling;while(h){if(g.virtualElements.isVirtual(h)){return h}h=h.previousSibling}return i.parentNode},isVirtual:function(h){return h.nodeType===8&&h.nodeValue.replace(/^\s+/,"").indexOf("ko")===0},isVirtualClosing:function(h){return h.nodeType===8&&h.nodeValue.replace(/^\s+|\s+$/g,"")==="/ko"},elementWithChildren:function(j){if(!j){return[]}if(!g.virtualElements.isVirtual(j)){return[j]}var k=[j];var i=1;var h=j.nextSibling;while(i>0){k.push(h);if(g.virtualElements.isVirtualClosing(h)){i--}else{if(g.virtualElements.isVirtual(h)){i++}}h=h.nextSibling}return k}};return g});window.wo=f.base})();